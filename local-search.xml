<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æˆ‘çš„è½¯ä»¶æ”¶è—é›†</title>
    <link href="/2024/11/26/software-collection/"/>
    <url>/2024/11/26/software-collection/</url>
    
    <content type="html"><![CDATA[<p>é™ˆåˆ—ä¸€äº›æˆ‘å¾ˆå–œæ¬¢çš„ PC ç«¯è½¯ä»¶ ğŸ¥°</p><hr><h3 id="Scoop"><a href="#Scoop" class="headerlink" title="Scoop"></a>Scoop</h3><ul><li>A command-line installer for Windows.</li><li>é“¾æ¥ï¼š<a href="https://scoop.sh/">å®˜æ–¹ä»‹ç»</a> | <a href="https://github.com/ScoopInstaller/Install?tab=readme-ov-file#advanced-installation">å®‰è£…è¯´æ˜</a> | <a href="https://github.com/ScoopInstaller/Scoop/wiki">Wiki</a></li><li>å¹³å°ï¼šä»… Windowsï¼Œå®ƒç”±çº¯ PowerShell å®ç°</li><li>è¯„ä»·ï¼š<ul><li>ç®€æ˜“çš„è½¯ä»¶å®‰è£…å·¥å…·ï¼Œå°½ç®¡å®ƒåŠŸèƒ½éå¸¸ç®€å•ï¼Œä½†è¿˜æ˜¯è¶³å¤Ÿå¥½ç”¨äº†</li><li>â€œå¥½ç”¨â€ä½“ç°åœ¨ï¼šä¸ç”¨åœ¨å®‰è£…ç¨‹åºé‡Œç‚¹æ¥ç‚¹å»ï¼Œä¸ç”¨æ“å¿ƒå®‰è£…ä½ç½®ï¼Œä¸éœ€è¦æ“çºµ PATH ç¯å¢ƒå˜é‡ï¼Œå®‰è£…å¸è½½éƒ½å¾ˆå¹²å‡€ï¼Œçº¯å‘½ä»¤è¡Œè§£å†³æ‰€æœ‰é—®é¢˜</li><li>æ ¼å¤–é€‚åˆç”¨æ¥ å®‰è£…&#x2F;å¸è½½&#x2F;æ›´æ–° Windows ç³»ç»Ÿä¸‹çš„ CLI ç¨‹åºæˆ–è€… portable åº”ç”¨ï¼Œä¾‹å¦‚ Git</li><li>å°ç¼ºç‚¹æ˜¯å¿…é¡»èƒ½é¡ºç•…è®¿é—® GitHubï¼Œå¯èƒ½ä¸é€‚åˆé GitHub ç”¨æˆ·ä½¿ç”¨</li></ul></li></ul><h3 id="Clash-Verge-Rev"><a href="#Clash-Verge-Rev" class="headerlink" title="Clash Verge Rev"></a>Clash Verge Rev</h3><ul><li>A Clash Meta GUI based on Tauri.</li><li>é“¾æ¥ï¼š<a href="https://www.clashverge.dev/index.html">å®˜æ–¹æ–‡æ¡£</a> | <a href="https://github.com/clash-verge-rev/clash-verge-rev/releases/latest">GitHub Release ä¸‹è½½</a></li><li>å¹³å°ï¼šWindows &#x2F; Linux &#x2F; MacOS</li><li>è¯„ä»·ï¼šé«˜çŸ¥ååº¦çš„ Clash for Windows æ›¿ä»£å“ï¼Œæ²¡æœ‰å®ƒæ´»ä¸äº†</li></ul><h3 id="Obsidian"><a href="#Obsidian" class="headerlink" title="Obsidian"></a>Obsidian</h3><ul><li>The private and flexible writing app that adapts to the wayÂ youÂ think.</li><li>é“¾æ¥ï¼š<a href="https://obsidian.md/">å®˜æ–¹ä»‹ç»</a> | <a href="https://help.obsidian.md/Home">å®˜æ–¹æ•™ç¨‹ä¸­è‹±</a> | <a href="https://forum-zh.obsidian.md/">ä¸­æ–‡è®ºå›</a></li><li>å¹³å°ï¼šPC &#x2F; ç§»åŠ¨ç«¯å…¨å¹³å°</li><li>è¯„ä»·ï¼š<ul><li>é›†é«˜æ€§èƒ½ã€é«˜å®šåˆ¶åŒ–ã€éšç§å®‰å…¨ä¸ºä¸€ä½“çš„ç¬”è®°å·¥å…·ï¼Œå®ƒå‡ ä¹å¯ä»¥æˆä¸ºä»»ä½•ä½ æƒ³çš„æ ·å­</li><li>Obsidian æ˜¯æˆ‘è¯»ç ”ä¹‹åæ‰å¼€å§‹ä½¿ç”¨çš„ï¼ŒçœŸçš„éå¸¸åæ‚”å®ƒæ²¡æœ‰åœ¨æˆ‘è¯»æœ¬ç§‘æˆ–è€…é«˜ä¸­çš„æ—¶å€™ç”¨å®ƒï¼Œå› ä¸ºå®ƒä¼šæˆä¸ºäººç±»åœ¨æ•°å­—ä¸–ç•Œé‡Œç”Ÿæ´»æ–¹å¼çš„ä¸€éƒ¨åˆ†</li></ul></li></ul><h3 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h3><ul><li>A truly minimal markdown editor.</li><li>è¯„ä»·ï¼šæ›¾ç»æ˜¯ä¸€æ¬¾éå¸¸äº®çœ¼çš„æ‰€è§å³æ‰€å¾— markdown ç¼–è¾‘å™¨ï¼Œç°åœ¨å·²ç»åŸºæœ¬è¢« Obsidian &#x2F; VSCode ä»£æ›¿äº†ã€‚ä»¥å‰ç”¨äº†å‡ å¹´ï¼Œè¿˜æ°ªé‡‘æ”¯æŒäº†ï¼Œç°åœ¨ç•™ç€å½“ <code>.md</code> æ–‡ä»¶çš„é»˜è®¤æ‰“å¼€åº”ç”¨</li></ul><h3 id="Windows-Terminal"><a href="#Windows-Terminal" class="headerlink" title="Windows Terminal"></a>Windows Terminal</h3><ul><li>å¾®è½¯çš„æ–°ä¸€ä»£ç»ˆç«¯å·¥å…·</li><li>é“¾æ¥ï¼š<a href="https://learn.microsoft.com/zh-cn/windows/terminal/">å®˜æ–¹ä»‹ç»</a></li><li>å¹³å°ï¼šä»… Windows</li><li>è¯„ä»·ï¼š<ul><li>å¦‚æœè¯´ Ubuntu çš„è‡ªå¸¦ç»ˆç«¯ä¸‘çš„è¿˜èƒ½æ¥å—ï¼Œé‚£ä¹ˆ Windows è‡ªå¸¦çš„å‘½ä»¤æç¤ºç¬¦ç»ˆç«¯æ˜¯çœŸçš„ä¸‘åˆ°è¾£çœ¼ç› â€”â€” å¾®è½¯çš„è¿™æ¬¾ç»ˆç«¯ç¡®å®éå¸¸ä»¤äººæ»¡æ„ï¼Œè½»é‡åŒ–ã€å¯å®šåˆ¶ã€çº¯ JSON é…ç½®ï¼Œä¹Ÿå¯ä»¥æ»¡è¶³ä¸€äº› SSH å®¢æˆ·ç«¯éœ€æ±‚</li><li>å¯ä»¥æ ¹æ®å¾®è½¯æ–‡æ¡£çš„æ•™ç¨‹ï¼ŒæŠŠ Windows Terminal è®¾ç½®æˆç³»ç»Ÿé»˜è®¤ç»ˆç«¯ï¼Œè¿™æ ·å°±å¯ä»¥æ°¸ä¹…å‘Šåˆ«è¾£çœ¼ç›çš„å‘½ä»¤æç¤ºç¬¦äº†</li></ul></li></ul><h3 id="Tabby-Terminal"><a href="#Tabby-Terminal" class="headerlink" title="Tabby Terminal"></a>Tabby Terminal</h3><ul><li>A terminal for the modern age.</li><li>é“¾æ¥ï¼š<a href="https://tabby.sh/">å®˜æ–¹ä»‹ç»</a> | <a href="https://github.com/Eugeny/tabby">GitHub é¡¹ç›®</a></li><li>å¹³å°ï¼šWindows &#x2F; Linux &#x2F; MacOS</li><li>è¯„ä»·ï¼š<ul><li>åŸºäº Electron&#x2F;Typescript çš„è·¨å¹³å°ç»ˆç«¯ï¼Œæ¯” Windows Terminal æ›´ç°ä»£ã€åŠŸèƒ½æ›´ä¸°å¯Œï¼Œä¹ŸåŒæ ·å¼€æº</li><li>å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒæ¯” Windows Terminal çš„ä¼˜åŠ¿åœ¨äºå¤šäº† SSH client æ”¯æŒå’Œç®€æ˜“çš„ SFTPï¼Œå®šåˆ¶åŒ–è‡ªç”±åº¦ä¹Ÿæ›´é«˜ï¼Œè¿˜æœ‰ä¸€ä¸ªtoggle-window çš„å…¨å±€å¿«æ·é”®éå¸¸æ–¹ä¾¿</li><li>åŠ£åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¯•ç«Ÿæ˜¯ Electronï¼Œç£ç›˜å’Œå†…å­˜å¼€é”€ç¡®å®è¿œé«˜äº Windows Terminal</li></ul></li></ul><h3 id="Zotero"><a href="#Zotero" class="headerlink" title="Zotero"></a>Zotero</h3><ul><li>A free, easy-to-use tool to help you collect, organize, annotate, cite, and share research.</li><li>é“¾æ¥ï¼š<a href="https://www.zotero.org/">å®˜æ–¹ä»‹ç»</a> | <a href="https://www.zotero.org/download/connectors">æµè§ˆå™¨æ’ä»¶</a></li><li>å¹³å°ï¼šWindows &#x2F; Linux &#x2F; MacOS</li><li>è¯„ä»·ï¼š<ul><li>æ–‡çŒ®å·¥å…·ï¼Œé…åˆæµè§ˆå™¨ä¸€é”®ä¿å­˜ï¼Œä¸€é”®å¯¼å‡º BibTeX æ–‡çŒ®åˆ—è¡¨ï¼Œéå¸¸ä¸æ»‘</li><li>å¯ä»¥é…åˆ WebDAV äº‘åŒæ­¥ <del>å°±å¯ä»¥åœ¨ä¸åŒè®¾å¤‡éšæ—¶çœ‹æ–‡çŒ®</del></li></ul></li></ul><h3 id="VS-Code"><a href="#VS-Code" class="headerlink" title="VS Code"></a>VS Code</h3><ul><li>æœ€å¼ºä»£ç ç¼–è¾‘å™¨ &#x2F; IDE ï¼Œæ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„ï¼Œé™¤äº†å„ç±»å¼€å‘å·¥ä½œï¼Œè¿˜å¯ä»¥ç”¨æ¥å†™ markdown, latex</li></ul><h3 id="Nutstore-åšæœäº‘"><a href="#Nutstore-åšæœäº‘" class="headerlink" title="Nutstore åšæœäº‘"></a>Nutstore åšæœäº‘</h3><ul><li>å›½å†…ç”¨ç€æ–¹ä¾¿çœå¿ƒä¸”ä¸ç”¨èŠ±é’±çš„<strong>åŒæ­¥ç›˜</strong>ï¼Œæä¾› WebDAV</li><li>å®ƒçš„ WebDAV åŠŸèƒ½é…åˆ Zotero ä¹‹ç±»çš„åº”ç”¨ï¼Œèƒ½å®ç°è‡ªåŠ¨äº‘åŒæ­¥</li><li>å…è´¹ç‰ˆçœŸçš„å¤ªå¤Ÿç”¨äº†ï¼Œä¸æ»‘çœå¿ƒ</li></ul><h3 id="ä¸€äº›æµè§ˆå™¨æ’ä»¶"><a href="#ä¸€äº›æµè§ˆå™¨æ’ä»¶" class="headerlink" title="ä¸€äº›æµè§ˆå™¨æ’ä»¶"></a>ä¸€äº›æµè§ˆå™¨æ’ä»¶</h3><ul><li><p>ä¸ºä»€ä¹ˆä½ ä»¬å°±æ˜¯ä¸èƒ½åŠ ä¸ªç©ºæ ¼å‘¢ï¼Ÿ</p><ul><li>è‡ªåŠ¨åœ¨ç½‘é¡µä¸­æ‰€æœ‰çš„ä¸­æ–‡å­—å’ŒåŠå½¢çš„è‹±æ–‡ã€æ•°å­—ã€ç¬¦å·ä¹‹é—´æ’å…¥ç©ºç™½</li><li>é“¾æ¥ï¼š<a href="https://chromewebstore.google.com/detail/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%A0%E4%BB%AC%E5%B0%B1%E6%98%AF%E4%B8%8D%E8%83%BD%E5%8A%A0%E4%B8%AA%E7%A9%BA%E6%A0%BC%E5%91%A2%EF%BC%9F/paphcfdffjnbcgkokihcdjliihicmbpd">Chrome æ’ä»¶</a> | <a href="https://github.com/vinta/pangu.js">GitHub ä»“åº“ pangu.js</a></li><li>æ²¡é”™ï¼Œè¿™ä¸ªæ’ä»¶çš„åå­—å°±å«â€œä¸ºä»€ä¹ˆä½ ä»¬å°±æ˜¯ä¸èƒ½åŠ ä¸ªç©ºæ ¼å‘¢ï¼Ÿâ€ã€‚æ‡‚çš„äººè‡ªç„¶æ‡‚ï¼Œä¸æ‡‚çš„ä¹Ÿæ²¡å¿…è¦å“ˆå“ˆå“ˆï¼Œå–œæ¬¢ä½œè€…çš„ä¸ªæ€§~<blockquote><p><em>æ±‰å­¦å®¶ç§°è¿™ä¸ªç©ºç™½å­—å…ƒä¸ºã€Œç›˜å¤ä¹‹ç™½ã€ï¼Œå› ä¸ºå®ƒåŠˆå¼€äº†å…¨å½¢å­—å’ŒåŠå½¢å­—ä¹‹é—´çš„æ··æ²Œã€‚å¦æœ‰ç ”ç©¶æ˜¾ç¤ºï¼Œæ‰“å­—çš„æ—¶å€™ä¸å–œæ¬¢åœ¨ä¸­æ–‡å’Œè‹±æ–‡ä¹‹é—´åŠ ç©ºæ ¼çš„äººï¼Œæ„Ÿæƒ…è·¯éƒ½èµ°å¾—å¾ˆè¾›è‹¦ï¼Œæœ‰ä¸ƒæˆçš„æ¯”ä¾‹ä¼šåœ¨ 34 å²çš„æ—¶å€™è·Ÿè‡ªå·±ä¸çˆ±çš„äººç»“å©šï¼Œè€Œå…¶ä½™ä¸‰æˆçš„äººæœ€ååªèƒ½æŠŠé—äº§ç•™ç»™è‡ªå·±çš„çŒ«ã€‚æ¯•ç«Ÿçˆ±æƒ…è·Ÿä¹¦å†™éƒ½éœ€è¦é€‚æ—¶åœ°ç•™ç™½ã€‚</em></p></blockquote></li></ul></li><li><p>SwitchyOmega</p><ul><li>é“¾æ¥ï¼š<a href="https://chromewebstore.google.com/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif">Chrome æ’ä»¶</a> | <a href="https://github.com/FelisCatus/SwitchyOmega/">GitHub ä»“åº“</a></li><li>è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨é¡µé¢çš„ä»£ç†è®¾ç½®å·¥å…·ã€‚å®ƒå…è®¸ä½ æ§åˆ¶ä¸åŒç½‘é¡µä½¿ç”¨ä½•ç§ç½‘ç»œä»£ç†ã€‚ä½ å¯èƒ½æƒ³é—®è¿™å’Œ Clash rules æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå®ƒçš„åŒºåˆ«åœ¨äºè®©æµè§ˆå™¨ä¸»åŠ¨è®¿é—®æŸä¸ªä½ æŒ‡å®šçš„ä»£ç†åœ°å€ï¼Œè€Œä¸æ˜¯è®© Clash ä½œä¸ºä½ çš„ç³»ç»Ÿä»£ç†å¹¶å†³å®šæ¯ä¸ªè¿æ¥ã€‚</li><li>æ¯”å¦‚å½“ä½ å¸Œæœ›æŸäº›ç½‘ç«™èµ°ä»£ç†ï¼Œè€ŒæŸäº›ç½‘ç«™ç›´è¿æ—¶ï¼Œè¿™ä¸ªæ’ä»¶è®¾ç½®èµ·æ¥å°±éå¸¸æ–¹ä¾¿</li><li>ä¸è¿‡è¯´åˆ°åº•ï¼Œæ˜¯å¦ä½¿ç”¨ç³»ç»Ÿä»£ç†ä¹Ÿåªæ˜¯ä¸ªäººåå¥½ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢æ§åˆ¶çš„ç»†ä¸€ç‚¹</li></ul></li></ul><h3 id="ä¸€äº›å­—ä½“-é…è‰²"><a href="#ä¸€äº›å­—ä½“-é…è‰²" class="headerlink" title="ä¸€äº›å­—ä½“ &amp; é…è‰²"></a>ä¸€äº›å­—ä½“ &amp; é…è‰²</h3><ul><li><strong>Nerd Fonts</strong><ul><li>é“¾æ¥ï¼š<a href="https://www.nerdfonts.com/">å®˜ç½‘</a></li><li>å¸¦å›¾æ ‡å­—å½¢ã€è¿å­—çš„å­—ä½“é›†ï¼ŒIDE &#x2F; terminal ä¸“ç”¨ï¼Œå¼€å‘è€…å¿…å¤‡ã€‚æˆ‘å–œæ¬¢è¿™ä¸¤ä¸ªå­—ä½“ï¼š</li><li>Cascadia Code åŸæœ¬æ˜¯å¾®è½¯ä¸»æ¨çš„å­—ä½“ï¼Œè¢« Nerd Fonts å¢å¼ºåæ›´å¥½ç”¨äº†</li><li>Fira Code çœŸçš„å¾ˆå¥½çœ‹â€¦â€¦</li></ul></li><li><strong>DejaVu Math TeX Gyre</strong><ul><li>é“¾æ¥ï¼š<a href="https://github.com/dejavu-fonts/dejavu-fonts">GitHub é¡¹ç›®</a></li><li>è¿™æ˜¯ä¸€æ¬¾è‹±æ–‡è¡¬çº¿å­—ä½“ã€‚å®ƒçš„å­—æ¯ç›¸å¯¹æ›´é¥±æ»¡ï¼ˆå¤§æ¦‚å°±æ˜¯æ¯”å…¶ä»–å­—ä½“æ›´å®½ä¸€äº›ï¼‰ï¼Œæˆ‘è§‰å¾—å®ƒçš„ä¸»è¦ä¼˜ç‚¹å°±æ˜¯æ˜“äºé˜…è¯»</li></ul></li><li><strong>One Dark Pro</strong><ul><li>æˆ‘çš„ IDE æ¯”è¾ƒå–œæ¬¢çš„é¢œè‰²ä¸»é¢˜ï¼Œå¯ä»¥ç®—æ˜¯å¯¹æ¯”åº¦æ¯”è¾ƒé«˜çš„ä¸€æ¬¾äº†ï¼Œé¢œè‰²å¾ˆé²œè‰³è€Œä¸”èƒŒæ™¯è¶³å¤Ÿæ·±ï¼Œè§†è§‰æ•ˆæœå¾ˆå¥½</li></ul></li><li><strong>Catppuccin</strong><ul><li>é“¾æ¥ï¼š<a href="https://catppuccin.com/">å®˜ç½‘</a></li><li>GitHub ä¸Šæ”¶è· 15k stars çš„é…è‰²æ–¹æ¡ˆï¼Œè‰²å½©é²œæ´»ä¸”æŸ”å’Œï¼Œå¯¹æ¯”åº¦é€‚ä¸­</li><li>å¯ä»¥ç”¨äºè®¾è®¡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé¢œè‰²ä¸»é¢˜ä½¿ç”¨</li><li>ç³»åˆ—é‡Œçš„ Latte æ˜¯ light themeï¼Œè€Œ Mocha æ˜¯ dark themeï¼Œå¦å¤–å¦ä¸ªæ˜¯ Mocha çš„ä½å¯¹æ¯”åº¦å˜ä½“ï¼Œå¯ä»¥å…ˆä» Latte å’Œ Mocha é‡Œé¢é€‰</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¤§æ‰¹é‡è°ƒç”¨ LLM æœåŠ¡å®æˆ˜ï¼šä»¥åˆ†ç±»ä»»åŠ¡ä¸ºä¾‹</title>
    <link href="/2024/11/20/llm-service-batch-request/"/>
    <url>/2024/11/20/llm-service-batch-request/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€é¡¹éœ€è¦ LLM å®Œæˆçš„ä»»åŠ¡å’Œä¸€æ‰¹æ•°æ®ï¼Œå¸Œæœ›é€šè¿‡è°ƒç”¨ API çš„æ–¹å¼è·å¾— LLM è¾“å‡ºæ¥å¤„ç†è¿™æ‰¹ä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œä»¥åˆ†ç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œå¯¹æ¯ä¸€ä¸ªæ ·æœ¬ï¼Œéœ€è¦æ ¹æ®æç¤ºè¯æ¨¡ç‰ˆæ„å»ºæç¤ºè¯ï¼Œç„¶åå‘é€ä¸€ä¸ªè¯·æ±‚ç»™ OpenAI ç­‰ LLM æœåŠ¡æä¾›æ–¹ï¼Œå†è§£æè¾“å‡ºå¾—åˆ°åˆ†ç±»ç»“æœã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼éå¸¸ç®€å•ç›´è§‚ï¼Œä½†åœ¨å®è·µä¸­å¯èƒ½ä¼šé¢å¯¹è¯¸å¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨æ•°é‡è¾ƒå¤§æ—¶ï¼ˆæ¯”å¦‚ 10 ä¸‡ä»¥ä¸Šæ ·æœ¬é‡ï¼Œå…¨éƒ¨è¯·æ±‚æ€»é‡è¶…è¿‡ 10 million tokensï¼‰â€¦</p><ol><li><strong>å¦‚ä½•è·å¾—ç™¾åˆ†ç™¾å¯é çš„è¾“å‡ºç»“æœï¼Ÿ</strong> ä»»åŠ¡éœ€è¦è§£æç”Ÿæˆçš„æ–‡æœ¬ï¼Œå¾—åˆ°åˆ†ç±»æ ‡ç­¾ã€‚LLM ä¸ä¸€å®šæ€»ä¼šéµå¾ªæŒ‡ä»¤ï¼Œè€Œä¸”å¯èƒ½è¿˜è¦è€ƒè™‘ COT ç”Ÿæˆã€æ¨¡å‹æ‹’ç­”ç­‰æƒ…å†µï¼Œçº¯æ–‡æœ¬è§£ææ˜¾å¾—ä¸å¤Ÿå¯é ã€‚</li><li><strong>å¦‚ä½•å®ç°å¹¶å‘ï¼Ÿ</strong> å¯¹äºå•ä¸ªç”Ÿæˆä»»åŠ¡ï¼ŒLLM çš„å“åº”é€Ÿåº¦æ˜¯å¾ˆéš¾æå‡çš„ï¼Œæ‰€ä»¥å‡ ä¸‡æ ·æœ¬é¡ºåºæ‰§è¡Œçš„æ—¶é—´å¼€é”€å¯èƒ½ä¼šéå¸¸å¤§ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ— è®ºæ˜¯ OpenAI ç­‰ API æœåŠ¡å•†è¿˜æ˜¯æœ¬åœ°éƒ¨ç½²çš„ LLM æ¨ç†ï¼Œéƒ½æ”¯æŒå¹¶å‘å¤„ç†ï¼Œä¸”æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨å®¢æˆ·ç«¯å®ç°ä¼˜é›…çš„å¹¶å‘è¯·æ±‚é€»è¾‘ã€‚</li><li><strong>å¦‚ä½•ç¼“å­˜è°ƒç”¨ç»“æœé¿å…æµªè´¹ API è´¹ç”¨ï¼Ÿ</strong> å¤§æ‰¹é‡è°ƒç”¨ API ä¼šäº§ç”Ÿä¸è²çš„å¼€é”€ã€‚æˆ‘ä»¬å¯èƒ½ä¼šä¸­æ–­ä»»åŠ¡å¤„ç†é—®é¢˜ã€è°ƒæ•´å®ç°ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›å·²ç»è¯·æ±‚è¿‡çš„å†…å®¹â€œæµªè´¹æ‰â€ï¼Œæ‰€ä»¥æŠŠæ¯æ¬¡è¯·æ±‚çš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œä¸ä»…èƒ½æé«˜é‡å¤æ‰§è¡Œæ—¶çš„é€Ÿåº¦ï¼Œè¿˜èƒ½é¿å…æµªè´¹ token è´¹ç”¨ã€‚</li><li><strong>å¦‚ä½•å¤„ç†å„ç±»å¼‚å¸¸ï¼Ÿ</strong> è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿå„ç§é”™è¯¯ï¼Œä»æœ€å¸¸è§çš„ç½‘ç»œé”™è¯¯ï¼Œåˆ°è¯·æ±‚æ„å»ºå’Œç»“æœè§£æï¼Œéƒ½æœ‰å¯èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚æˆ‘ä»¬ä¸å¸Œæœ›æ‰¹é‡æ‰§è¡Œè¢«ä»»ä½•é”™è¯¯ä¸­æ–­ï¼Œæ‰€ä»¥éœ€è¦å……åˆ†è€ƒè™‘å¯èƒ½ä¼šå‡ºç°çš„å¼‚å¸¸ç±»å‹å¹¶åŠ ä»¥å¤„ç†ã€‚</li></ol><p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæœ¬æ–‡è®¨è®ºä¸€äº›ç®€å•æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶é™„ä¸Š Python å®ç°ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>æˆ‘ä»¬ä½¿ç”¨ LangChain æ¥ç®€åŒ–ä¸€äº›åŠŸèƒ½çš„å®ç°ã€‚æˆ‘ä»¬çš„ä»»åŠ¡åªæ¶‰åŠå•æ¬¡ LLM è°ƒç”¨ï¼Œæ‰€ä»¥æ‰‹å·¥å®ç°ç›¸å…³é€»è¾‘ä¹Ÿæ˜¯ä¸éš¾çš„ï¼Œç”¨ LangChain ä»…ä»…æ˜¯èµ·åˆ°ç¼©å‡ä»£ç é‡çš„æ•ˆæœã€‚å½“ç„¶å¦‚æœæœ‰æ›´å¤æ‚çš„ä»»åŠ¡é€»è¾‘ï¼Œç›¸ä¿¡ LangChain ä¹Ÿèƒ½å¸®åˆ°å¾ˆå¤šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install langchain langchain-openai langchain-community<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableLambda<br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> AIMessage<br><span class="hljs-keyword">from</span> langchain_community.cache <span class="hljs-keyword">import</span> SQLiteCache<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‡è®¾æ•°æ®æ˜¯ JSON Lines æ ¼å¼ï¼Œæ¯ä¸€è¡Œåˆ†åˆ«ä»£è¡¨ä¸€ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½ç”±å›ºå®šæ ¼å¼çš„ JSON å¯¹è±¡æè¿°ï¼Œéå¸¸çµæ´»æ˜“ç”¨ã€‚åŒæ—¶ï¼Œç›¸æ¯”äº JSONï¼Œæ¯ä¸ªæ–‡æœ¬è¡Œä¸€ä¸ªæ ·æœ¬ä¹Ÿå¯ä»¥é¿å…ä¸€æ¬¡è¯»å…¥å…¨éƒ¨æ–‡ä»¶åˆ°å†…å­˜ï¼ŒIO å ç”¨æ—¶é—´ã€‚</p><p>å¤§æ¨¡å‹æœåŠ¡æ–¹é¢ï¼Œæˆ‘ä»¬é‡‡ç”¨æœ€å…¸å‹çš„ OpenAI API æ ¼å¼ï¼Œå› ä¸ºè®¸å¤šå›½å†…å‚å•†éƒ½ä¼šä¸ä¹‹å…¼å®¹ã€‚</p><h2 id="ç»“æ„åŒ–è¾“å‡º"><a href="#ç»“æ„åŒ–è¾“å‡º" class="headerlink" title="ç»“æ„åŒ–è¾“å‡º"></a>ç»“æ„åŒ–è¾“å‡º</h2><p>é¦–å…ˆï¼Œå¼•å¯¼å¤§æ¨¡å‹ç”Ÿæˆç»“æ„åŒ–è¾“å‡ºèƒ½è®©æˆ‘ä»¬çš„ä»»åŠ¡æ›´åŠ å¯é ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯è®© LLM è¾“å‡º JSON æ–‡æœ¬ï¼Œç„¶åå†è§£æå‡º JSON å¯¹è±¡çš„å­—æ®µå¾—åˆ°ç­”æ¡ˆã€‚</p><p>ä»Šå¹´å…«æœˆï¼ŒOpenAI å‘å¸ƒäº† structured outputs ç‰¹æ€§ï¼Œå…è®¸å¼€å‘è€…æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œæ¨¡å‹ä¼šç™¾åˆ†æ¯”å¯é åœ°æŒ‰ JSON schema è¾“å‡ºç»“æœ <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://openai.com/index/introducing-structured-outputs-in-the-api/">[1]</span></a></sup>ã€‚ä¸è¿‡è€ƒè™‘åˆ°ä¸æ˜¯æ‰€æœ‰å¹³å°éƒ½æ”¯æŒ json schemaï¼Œæˆ‘ä»¬è¿™æ¬¡å°±åªä½¿ç”¨æ™®é€šçš„ JSON è¾“å‡ºã€‚é¦–å…ˆï¼Œåœ¨æç¤ºè¯éƒ¨åˆ†æä¾›æŒ‡ä»¤å’Œç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">## Response Format</span><br><br>Your response should be in JSON format, containing fields: <span class="hljs-code">`reasoning_steps`</span>, steps that analyze provided content and lead to a classification conclusion, and <span class="hljs-code">`category`</span>, must be one of the candidate categories. The steps should be concise and accurate as much as you can. Here is an example of the desired format:<br><br>&#123;&#123;<br>  &quot;reasoning<span class="hljs-emphasis">_steps&quot;: [</span><br><span class="hljs-emphasis">    &quot;first...&quot;,</span><br><span class="hljs-emphasis">    &quot;then...&quot;</span><br><span class="hljs-emphasis">  ],</span><br><span class="hljs-emphasis">  &quot;category&quot;: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span></span><br><span class="hljs-emphasis">&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¼•å¯¼æ¨¡å‹å…ˆç”Ÿæˆä¸€ç³»åˆ— â€œæ¨ç†æ­¥éª¤â€ï¼Œç„¶åå†ç”Ÿæˆæ ‡ç­¾å­—æ®µ â€œcategoryâ€ ï¼Œè¿™æ˜¯åˆ©ç”¨äº†æ€ç»´é“¾æŠ€å·§æé«˜å‡†ç¡®æ€§ã€‚</p><p>ä½¿ç”¨ LangChain åˆ›å»ºä¸€ä¸ª LLM æŠ½è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">llm = ChatOpenAI(<br>model=<span class="hljs-string">&quot;...&quot;</span>,<br>api_key=<span class="hljs-string">&quot;...&quot;</span>,<br>base_url=<span class="hljs-string">&quot;...&quot;</span>,<br>temperature=<span class="hljs-number">0.0</span>,<br>top_p=<span class="hljs-number">0.001</span>,<br>).bind(response_format=&#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;json_object&quot;</span>&#125;)<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæç¤ºè¯æ¨¡ç‰ˆå¯¹è±¡ã€‚æˆ‘ä»¬æŠŠæç¤ºè¯æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶æ–¹ä¾¿ç¼–è¾‘ï¼Œæ³¨æ„æ–‡æœ¬ä¸­çš„ <code>&#123;field&#125;</code> æ˜¯å¯è¢«æ›¿æ¢çš„æ¨¡ç‰ˆå ä½ç¬¦ï¼Œè¦æƒ³ä½¿ç”¨çœŸæ­£çš„èŠ±æ‹¬å·éœ€è¦ä½¿ç”¨ä¸¤ä¸ªèŠ±æ‹¬å·æ¥è½¬ä¹‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br>prompt = Path(<span class="hljs-string">&quot;./prompt.md&quot;</span>).read_text()<br>prompt_template = ChatPromptTemplate.from_messages([<br>(<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;You are a helpful assistant.&quot;</span>),<br>(<span class="hljs-string">&quot;user&quot;</span>, prompt),<br>])<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬éœ€è¦ç¼–å†™å¤„ç†è¾“å‡ºçš„é€»è¾‘ã€‚LangChain å¯¹è±¡ <code>ChatOpenAI</code> è°ƒç”¨ <code>invoke()</code> ä¼šè¿”å›ä¸€ä¸ª <code>AIMessage</code> å¯¹è±¡ï¼Œæœ€ç®€å•çš„å¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_response</span>(<span class="hljs-params">response: AIMessage</span>) -&gt; <span class="hljs-built_in">dict</span>:<br>    parsed = json.loads(response.content)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;category&quot;</span>: parsed[<span class="hljs-string">&quot;category&quot;</span>]&#125;<br><br>chain = prompt_template | llm | RunnableLambda(parse_response)<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸€ä¸ª chainï¼Œå®ƒä¼šæŠŠè¾“å…¥ä¼ ç»™æç¤ºè¯æ¨¡ç‰ˆï¼Œç”Ÿæˆæç¤ºè¯åè°ƒç”¨ LLMï¼Œç„¶åå†è°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ <code>parse_response</code> æ–¹æ³•ï¼Œè§£æ JSON å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªå­—å…¸ä»£è¡¨è¾“å‡ºã€‚</p><p>è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å– LLM å¯¹è¯¥ç±»åˆ«çš„æ¦‚ç‡ï¼ˆè™½ç„¶è¿™æœ‰åˆ«äºæœºå™¨å­¦ä¹ ä¸­çš„ç±»åˆ«æ¦‚ç‡ï¼‰ï¼Œè¿™å¯ä»¥é€šè¿‡ logprob å­—æ®µå®ç° <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://python.langchain.com/docs/how_to/logprobs/">[2]</span></a></sup>ã€‚ç”±äºå¤§æ¨¡å‹ä¼šæŒ‰æ ¼å¼è¾“å‡º <code>&quot;category&quot;: &quot;&lt;label&gt;&quot;</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ© <code>&quot;category&quot;: &quot;</code> å‰ç¼€æ¥æ‰¾åˆ° <code>&lt;label&gt;</code> åºåˆ—ä¸­çš„çš„ç¬¬ä¸€ä¸ª tokenï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">llm = ChatOpenAI(<br>    ...<br>    logprobs=<span class="hljs-literal">True</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_target_token</span>(<span class="hljs-params">token_list: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>]</span>):<br>pattern = [<span class="hljs-string">&#x27; &quot;&#x27;</span>, <span class="hljs-string">&#x27;category&#x27;</span>, <span class="hljs-string">&#x27;&quot;:&#x27;</span>, <span class="hljs-string">&#x27; &quot;&#x27;</span>]<br>pattern_length = <span class="hljs-built_in">len</span>(pattern)<br><span class="hljs-comment"># Loop through the token list with a sliding window</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(token_list) - pattern_length):<br>current_tokens = [token_dict[<span class="hljs-string">&#x27;token&#x27;</span>] <span class="hljs-keyword">for</span> token_dict <span class="hljs-keyword">in</span> token_list[i:i + pattern_length]]<br><span class="hljs-keyword">if</span> current_tokens == pattern:<br><span class="hljs-keyword">if</span> i + pattern_length &lt; <span class="hljs-built_in">len</span>(token_list):<br><span class="hljs-keyword">return</span> token_list[i + pattern_length]<br><span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_response</span>(<span class="hljs-params">response: AIMessage</span>) -&gt; <span class="hljs-built_in">dict</span>:<br>res = find_target_token(response.response_metadata[<span class="hljs-string">&quot;logprobs&quot;</span>][<span class="hljs-string">&quot;content&quot;</span>])<br>answer_logprob = <span class="hljs-built_in">float</span>(res[<span class="hljs-string">&quot;logprob&quot;</span>]) <span class="hljs-keyword">if</span> res <span class="hljs-keyword">else</span> -<span class="hljs-number">0.0</span><br>answer_prob = math.exp(answer_logprob)<br>...<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†è§£æ JSON ç»“æ„åŒ–è¾“å‡ºï¼Œè·å–ç±»åˆ«æ ‡ç­¾ + ç±»åˆ«æ¦‚ç‡ã€‚</p><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><p>é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯è¾“å‡ºè§£æéƒ¨åˆ†çš„å¼‚å¸¸æƒ…å†µã€‚å½“è¾“å‡ºè§£æéƒ¨åˆ†å‡ºç°ä»»ä½•é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬è®°å½•è¯¥é—®é¢˜ï¼Œç„¶åè¿”å›è§£æå‰çš„åŸå§‹æ¶ˆæ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_response</span>(<span class="hljs-params">response: AIMessage</span>) -&gt; <span class="hljs-built_in">dict</span>:<br><span class="hljs-keyword">try</span>:<br>res = find_target_token(response.response_metadata[<span class="hljs-string">&quot;logprobs&quot;</span>][<span class="hljs-string">&quot;content&quot;</span>])<br>answer_logprob = <span class="hljs-built_in">float</span>(res[<span class="hljs-string">&quot;logprob&quot;</span>]) <span class="hljs-keyword">if</span> res <span class="hljs-keyword">else</span> -<span class="hljs-number">0.0</span><br>answer_prob = math.exp(answer_logprob)<br>parsed = json.loads(response.content)<br>steps = <span class="hljs-string">&quot;\n&quot;</span>.join(parsed[<span class="hljs-string">&quot;reasoning_steps&quot;</span>])<br>answer = <span class="hljs-built_in">str</span>(parsed[<span class="hljs-string">&quot;category&quot;</span>])<br><span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;category:&quot;</span>: answer, <span class="hljs-string">&quot;prob&quot;</span>: answer_prob, <span class="hljs-string">&quot;steps&quot;</span>: steps&#125;<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>logger.warning(<span class="hljs-string">f&quot;LLM response parsing error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;category:&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;raw&quot;</span>: response.content&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œç¨‹åºä¸ä¼šå› ä¸ºæ¨¡å‹è¾“å‡ºéƒ¨åˆ†çš„é—®é¢˜è€Œä¸­æ–­ï¼Œåç»­ä¹Ÿå¯ä»¥è¿½æº¯è¿™äº›æ„å¤–æƒ…å†µã€‚</p><p>å¯¹äº API ç›¸å…³çš„å¼‚å¸¸ï¼Œä¾‹å¦‚ç½‘ç»œé—®é¢˜ã€rate limit é—®é¢˜ç­‰ï¼Œå®é™…ä¸Š LangChain æä¾›äº†ç›¸å…³é€»è¾‘ï¼Œå®ƒé»˜è®¤ä¼šåœ¨ç½‘ç»œé—®é¢˜å‘ç”Ÿæ—¶è¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°å¯ä»¥é€šè¿‡ <code>BaseChatOpenAI.max_retries</code> å‚æ•°æ§åˆ¶ <sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://python.langchain.com/docs/concepts/chat_models/#standard-parameters">[3]</span></a></sup>ã€‚è€Œé€Ÿç‡é™åˆ¶å¤„ç†è¡Œä¸ºå¯ä»¥é€šè¿‡æŒ‡å®š <code>rate_limiter</code> æ¥æ§åˆ¶ <sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://python.langchain.com/docs/how_to/chat_model_rate_limiting/">[4]</span></a></sup>ã€‚</p><p>åœ¨å¤„ç†å¼‚å¸¸æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬éš¾å…ä¼šé‡æ–°è¿è¡Œï¼Œå½“æ•°æ®é‡å¤§æ—¶ï¼Œè°ƒç”¨ LLM çš„è´¹ç”¨å°±æ˜¾å¾—æµªè´¹ä¸èµ·äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ API è°ƒç”¨å¤„å¢åŠ ä¸€å±‚ç¼“å­˜ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ‰¹é‡ä»»åŠ¡å¯ä»¥éšæ—¶ä¸­æ–­è°ƒè¯•ï¼Œä¸ç”¨æ‹…å¿ƒä»»ä½•æµªè´¹ã€‚æ‰€å¹¸çš„æ˜¯ LangChain å·²ç»æä¾›äº†ç›¸å…³åŠŸèƒ½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">llm_response_cache_dir = Path(<span class="hljs-string">&quot;.langchain.db&quot;</span>).as_posix()<br>llm_cache = SQLiteCache(database_path=llm_response_cache_dir)<br>llm = ChatOpenAI(<br>    ...<br>    cache=llm_cache,<br>)<br></code></pre></td></tr></table></figure><p>è¿™æ®µ <code>llm_cache</code> åšçš„äº‹æƒ…å®é™…ä¸Šæ˜¯æŠŠæ¯ä¸€æ¬¡é¢å‘ LLM API çš„è¯·æ±‚å†…å®¹å’Œç»“æœéƒ½åšé”®å€¼å¯¹ç¼“å­˜ï¼Œå½“å‘ç°å®Œå…¨ç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œç›´æ¥è¿”å›ç»“æœï¼Œä¸èµ°ç½‘ç»œ APIï¼Œä»è€Œå®ç°èŠ‚çœæ—¶é—´å’Œè´¹ç”¨çš„æ•ˆæœã€‚ç¼“å­˜ä½¿ç”¨ä¸€ä¸ªæœ¬åœ° sqlite æ–‡ä»¶å®ç°ã€‚</p><p>æœ€åï¼Œå½“çœŸæ­£æ‰§è¡Œå¤§æ‰¹é‡ä»»åŠ¡ï¼Œä¸å¸Œæœ›è¢«ä»»ä½•å¼‚å¸¸ä¸­æ–­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€ä¸Šå±‚ä»£ç åŠ ä¸€å±‚æ•è·ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    result = chain.invoke(inputs)<br>    <span class="hljs-keyword">return</span> &#123;**result, **inputs&#125;<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    logger.exception(<span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-built_in">str</span>(e), **inputs&#125;<br></code></pre></td></tr></table></figure><h2 id="åŸºäºåç¨‹çš„å¹¶å‘è¯·æ±‚"><a href="#åŸºäºåç¨‹çš„å¹¶å‘è¯·æ±‚" class="headerlink" title="åŸºäºåç¨‹çš„å¹¶å‘è¯·æ±‚"></a>åŸºäºåç¨‹çš„å¹¶å‘è¯·æ±‚</h2><p>å‡è®¾å·²ç»å®šä¹‰å¥½ <code>chain</code> å¯¹è±¡ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ‰§è¡Œèµ·æ¥æ˜¯è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">tasks: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>]<br>results = <span class="hljs-built_in">list</span>()<br><span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> tasks:<br>    result = chain.invoke(task)<br>    results.append(result)<br></code></pre></td></tr></table></figure><p>è¿™ç§ä¸²è¡Œæ–¹å¼ä¼šæŒ¨ä¸ªæ‰§è¡Œç­‰å¾…æœåŠ¡ç«¯ç”Ÿæˆï¼Œè€Œ LLM çš„ç”Ÿæˆé€Ÿåº¦æ˜¯å¾ˆæ…¢çš„ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒOpenAI æä¾›äº† Batches APIï¼Œä½†æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬å¸Œæœ›å¿«é€Ÿå¾—åˆ°ç»“æœï¼Œæˆ–è€…éƒ¨ç½²æœåŠ¡ä¸æ”¯æŒ Batch è°ƒç”¨å½¢å¼ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éå¸¸éœ€è¦è‡ªè¡Œå®ç°å¹¶å‘è¯·æ±‚ã€‚</p><p>å†™å¹¶å‘ï¼ŒPython åç¨‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¸œè¥¿ï¼Œå®ç°çš„æ—¶å€™è¿˜è¦è€ƒè™‘å‡ ä¸ªç‚¹ï¼š</p><ol><li>æ•°æ®é‡å¯èƒ½ä¼šéå¸¸å¤§ï¼Œé¿å…ä¸€æ¬¡æ€§æŠŠæ•´ä¸ªæ•°æ®é›†éƒ½åˆ›å»ºå‡ºåç¨‹</li><li>è™½ç„¶ LangChain å·²ç»å¸®æˆ‘ä»¬å¤„ç†äº† rate limitsï¼Œä½†å¹¶å‘æ•°éœ€è¦è‡ªå·±åšæ§åˆ¶</li><li>æ€ä¹ˆæ”¶é›†åç¨‹ç»“æœåšè¿›åº¦æ¡æ˜¾ç¤ºï¼Œæ¯•ç«Ÿæ²¡è¿›åº¦æ¡è¿˜æ˜¯ä¸æ”¾å¿ƒ</li></ol><p>æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œé¦–å…ˆæŠŠ chain é€»è¾‘å†™æˆå¼‚æ­¥å‡½æ•°ï¼Œä½¿ç”¨å…¶å¼‚æ­¥æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_task</span>(<span class="hljs-params">task: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:<br>    <span class="hljs-keyword">try</span>:<br>        result = <span class="hljs-keyword">await</span> chain.ainvoke(task)<br>        <span class="hljs-keyword">return</span> &#123;**input_dict, **result,&#125;<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        logger.exception(<span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> &#123;**input_dict, <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-built_in">str</span>(e),&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„è¾“å…¥ç›´æ¥å¯¹åº”æˆ‘ä»¬çš„ JSON è¾“å…¥å¯¹è±¡ï¼Œè¾“å‡ºä¹Ÿæ˜¯å­—å…¸æ ¼å¼ï¼Œéå¸¸çµæ´»ã€‚å¹¶ä¸”è¿™ä¸ªå¼‚æ­¥å‡½æ•°ä¿è¯ä¸ä¼šæŠ›å¼‚å¸¸ï¼ˆå‡è®¾æˆ‘ä»¬é¢„æ–™åˆ°çš„å¼‚å¸¸å¤„ç†éƒ½å·²ç»å†™è¿› <code>chain</code> é‡Œé¢äº†ï¼‰ã€‚</p><p>ç„¶åï¼Œè¾“å…¥éƒ¨åˆ†è¦åˆ†å—è¿›è¡Œï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬æŠŠæ–‡ä»¶è¯»å–å†™æˆä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œé¿å…è¿‡å¤§çš„å†…å­˜å¼€é”€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file_in_chunks</span>(<span class="hljs-params">filepath: <span class="hljs-built_in">str</span>, chunk_size: <span class="hljs-built_in">int</span></span>):<br>    current_batch = []<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> file:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file:<br>            current_batch.append(line.rstrip(<span class="hljs-string">&#x27;\n&#x27;</span>))<br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_batch) &gt;= chunk_size:<br>                <span class="hljs-keyword">yield</span> current_batch<br>                current_batch = []<br>        <br>        <span class="hljs-comment"># Don&#x27;t forget the last partial batch</span><br>        <span class="hljs-keyword">if</span> current_batch:<br>            <span class="hljs-keyword">yield</span> current_batch<br></code></pre></td></tr></table></figure><p>è°ƒç”¨è¿™ä¸ªç”Ÿæˆå™¨æ—¶ï¼Œæˆ‘ä»¬åœ¨å¾ªç¯å†…éƒ¨åš JSON è§£æè½¬å­—å…¸æ ¼å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> read_file_in_chunks(filepath, <span class="hljs-number">1000</span>):<br>    task_dicts = [json.loads(json_text) <span class="hljs-keyword">for</span> json_text <span class="hljs-keyword">in</span> chunk]<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œå¯¹äºè¿™ä¸€ç»„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€æ‰¹åç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å®šä¹‰çš„ <code>run_task</code>ï¼Œåˆ›å»ºä¹‹åä½¿ç”¨ <code>gather()</code> æ¥å¹¶å‘æ‰§è¡Œåç¨‹ã€‚ä¾‹å¦‚è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">results = <span class="hljs-keyword">await</span> asyncio.gather(*[run_task(d) <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> task_dicts])<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ§åˆ¶å¹¶å‘æ•°ï¼Œå¾ˆæ˜¾ç„¶è¿™è¿˜ä¸å¤Ÿã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æœºåˆ¶æ¥æ§åˆ¶åŒä¸€æ—¶åˆ»èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œçš„åç¨‹æ•°ç›®ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦åœ¨ <code>run_task</code> å¤–é¢å¥—ä¸€å±‚å¼‚æ­¥å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">semaphore = asyncio.Semaphore(max_concurrency)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">do</span>(<span class="hljs-params">data</span>):<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> semaphore:<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> run_task(data)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°äº† <code>Semaphore</code> å¯¹è±¡çš„ context manager è¯­æ³•ï¼Œåœ¨è¿›å‡ºè¯¥ with å—æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œè·å– &#x2F; é‡Šæ”¾æ“ä½œã€‚åœ¨ <code>gather()</code> è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰ <code>do()</code> åç¨‹éƒ½è¢«å¯åŠ¨ï¼Œä½†åªæœ‰ <code>max_concurrency</code> ä¸ªèƒ½å¤Ÿè¿›å…¥ <code>with</code> å—ï¼Œå…¶ä»–æ‰€æœ‰éƒ½ä¼šå¡åœ¨ <code>with</code> å…¥å£ç­‰å¾…ä¿¡å·é‡é‡Šæ”¾ï¼Œå¦‚æ­¤å®ç°è¯·æ±‚å¹¶å‘æ•°çš„æ§åˆ¶ã€‚</p><p>è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå®ç°è¿›åº¦æ˜¾ç¤ºã€‚æˆ‘ä»¬ä½¿ç”¨æ¥è‡ª <code>rich</code> åº“çš„ <code>rich.progress.Progress</code> å¯¹è±¡ï¼Œåœ¨ç»ˆç«¯å®æ—¶æ˜¾ç¤ºè¿›åº¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠè¿›åº¦æ›´æ–°æ”¾åœ¨ <code>run_task()</code> è¿”å›ç»“æœçš„ä½ç½®ä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">progress_bar = progress.Progress()<br><span class="hljs-keyword">with</span> progress_bar:<br>task_id = progress_bar.add_task()<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">do</span>(<span class="hljs-params">data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> semaphore:<br>result = <span class="hljs-keyword">await</span> run_task(data)<br>progress_bar.advance(task_id)<br><span class="hljs-keyword">return</span> result<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å®Œå…¨ä¸ç”¨æ‹…å¿ƒ <code>progress_bar</code> å¯¹è±¡äº§ç”Ÿäº‰ç”¨ã€‚</p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><p>å¾ˆå¤šåŠŸèƒ½éƒ½æœ‰ç°æœ‰åº“æ¥å®ç°äº†ï¼Œæ‰€ä»¥æœ€ç»ˆä»£ç é‡å¾ˆå°ï¼Œåªæœ‰ 100 å¤šè¡Œï¼Œå¯ä»¥å®ç°æˆ‘ä»¬å¼€å¤´æåˆ°çš„å„ç§åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger<br><span class="hljs-keyword">from</span> rich <span class="hljs-keyword">import</span> progress<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableLambda<br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> AIMessage<br><span class="hljs-keyword">from</span> langchain_community.cache <span class="hljs-keyword">import</span> SQLiteCache<br><br><br>progress_bar_columns = [<br>    progress.SpinnerColumn(),<br>    progress.TextColumn(<span class="hljs-string">&quot;[bold blue]&#123;task.description&#125;&quot;</span>),<br>    progress.TextColumn(<span class="hljs-string">&quot;[bold blue]&#123;task.fields[filename]&#125;&quot;</span>),<br>    progress.BarColumn(),<br>    progress.MofNCompleteColumn(),<br>    progress.TaskProgressColumn(),<br>    progress.TimeElapsedColumn(),<br>    progress.TimeRemainingColumn(),<br>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_chain</span>(<span class="hljs-params"></span><br><span class="hljs-params">        use_llm_cache: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>,</span><br><span class="hljs-params">        request_logprobs: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>,</span><br><span class="hljs-params">        </span>):<br>    <span class="hljs-keyword">if</span> use_llm_cache:<br>        llm_response_cache_dir = Path(<span class="hljs-string">&quot;.langchain.db&quot;</span>).as_posix()<br>        llm_cache = SQLiteCache(database_path=llm_response_cache_dir)<br>    <span class="hljs-keyword">else</span>:<br>        llm_cache = <span class="hljs-literal">False</span><br><br>    llm = ChatOpenAI(<br>        model=<span class="hljs-string">&quot;xxx&quot;</span>,<br>        api_key=<span class="hljs-string">&quot;xxx&quot;</span>,<br>        base_url=<span class="hljs-string">&quot;xxx&quot;</span>,<br>        temperature=<span class="hljs-number">0.0</span>,<br>        top_p=<span class="hljs-number">0.001</span>,<br>        max_tokens=<span class="hljs-number">500</span>,<br>        logprobs=request_logprobs,<br>        cache=llm_cache,<br>        streaming=<span class="hljs-literal">False</span>,<br>    ).bind(response_format=&#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;json_object&quot;</span>&#125;)<br><br>    prompt = Path(<span class="hljs-string">&quot;./prompt.md&quot;</span>).read_text()<br>    prompt_template = ChatPromptTemplate.from_messages([<br>        (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;You are a helpful assistant.&quot;</span>),<br>        (<span class="hljs-string">&quot;user&quot;</span>, prompt),<br>    ])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_target_token</span>(<span class="hljs-params">token_list: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>]</span>):<br>        pattern = [<span class="hljs-string">&#x27; &quot;&#x27;</span>, <span class="hljs-string">&#x27;category&#x27;</span>, <span class="hljs-string">&#x27;&quot;:&#x27;</span>, <span class="hljs-string">&#x27; &quot;&#x27;</span>]<br>        pattern_length = <span class="hljs-built_in">len</span>(pattern)<br>        <span class="hljs-comment"># Loop through the token list with a sliding window</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(token_list) - pattern_length):<br>            current_tokens = [token_dict[<span class="hljs-string">&#x27;token&#x27;</span>] <span class="hljs-keyword">for</span> token_dict <span class="hljs-keyword">in</span> token_list[i:i + pattern_length]]<br>            <span class="hljs-keyword">if</span> current_tokens == pattern:<br>                <span class="hljs-keyword">if</span> i + pattern_length &lt; <span class="hljs-built_in">len</span>(token_list):<br>                    <span class="hljs-keyword">return</span> token_list[i + pattern_length]<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_response</span>(<span class="hljs-params">response: AIMessage</span>) -&gt; <span class="hljs-built_in">dict</span>:<br>        <span class="hljs-keyword">try</span>:<br>            res = find_target_token(response.response_metadata[<span class="hljs-string">&quot;logprobs&quot;</span>][<span class="hljs-string">&quot;content&quot;</span>])<br>            answer_logprob = <span class="hljs-built_in">float</span>(res[<span class="hljs-string">&quot;logprob&quot;</span>]) <span class="hljs-keyword">if</span> res <span class="hljs-keyword">else</span> -<span class="hljs-number">0.0</span><br>            answer_prob = math.exp(answer_logprob)<br>            parsed = json.loads(response.content)<br>            steps = <span class="hljs-string">&quot;\n&quot;</span>.join(parsed[<span class="hljs-string">&quot;reasoning_steps&quot;</span>])<br>            answer = <span class="hljs-built_in">str</span>(parsed[<span class="hljs-string">&quot;category&quot;</span>])<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;category:&quot;</span>: answer, <span class="hljs-string">&quot;prob&quot;</span>: answer_prob, <span class="hljs-string">&quot;steps&quot;</span>: steps&#125;<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            logger.warning(<span class="hljs-string">f&quot;LLM response parsing error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;category:&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;raw&quot;</span>: response.content&#125;<br>    <br>    <span class="hljs-keyword">return</span> prompt_template | llm | RunnableLambda(parse_response)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_task</span>(<span class="hljs-params">chain, task: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:<br>    <span class="hljs-keyword">try</span>:<br>        result = <span class="hljs-keyword">await</span> chain.ainvoke(task)<br>        <span class="hljs-keyword">return</span> &#123;**task, **result,&#125;<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        logger.exception(<span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> &#123;**task, <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-built_in">str</span>(e),&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file_in_chunks</span>(<span class="hljs-params">filepath: <span class="hljs-built_in">str</span>, chunk_size: <span class="hljs-built_in">int</span></span>):<br>    current_batch = []<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> file:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file:<br>            current_batch.append(line.rstrip(<span class="hljs-string">&#x27;\n&#x27;</span>))<br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_batch) &gt;= chunk_size:<br>                <span class="hljs-keyword">yield</span> current_batch<br>                current_batch = []<br>        <br>        <span class="hljs-comment"># Don&#x27;t forget the last partial batch</span><br>        <span class="hljs-keyword">if</span> current_batch:<br>            <span class="hljs-keyword">yield</span> current_batch<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_tasks_parallel</span>(<span class="hljs-params">filepath: <span class="hljs-built_in">str</span>, max_concurrency: <span class="hljs-built_in">int</span>, chunk_size: <span class="hljs-built_in">int</span></span>):<br>    chain = build_chain()<br>    total_lines = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">&#x27;r&#x27;</span>))<br>    semaphore = asyncio.Semaphore(max_concurrency)<br>    progress_bar = progress.Progress(*progress_bar_columns)<br>    <span class="hljs-keyword">with</span> progress_bar:<br>        task_id = progress_bar.add_task(<br>            description=<span class="hljs-string">&quot;Processing&quot;</span>,<br>            total=total_lines,<br>            filename=Path(filepath).name,<br>        )<br>        <br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">do</span>(<span class="hljs-params">chain, data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:<br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> semaphore:<br>                result = <span class="hljs-keyword">await</span> run_task(data)<br>                progress_bar.advance(task_id)<br>                <span class="hljs-keyword">return</span> result<br>        <br>        <span class="hljs-comment"># --- ä¸»å¾ªç¯ ---</span><br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> read_file_in_chunks(filepath, chunk_size):<br>            task_dicts = [json.loads(json_text) <span class="hljs-keyword">for</span> json_text <span class="hljs-keyword">in</span> chunk]<br>            results = <span class="hljs-keyword">await</span> asyncio.gather(*[do(chain, d) <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> task_dicts])<br>            <span class="hljs-comment"># ä¿å­˜ç»“æœ</span><br>            ...<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">await</span> process_tasks_parallel(<span class="hljs-string">&quot;./dataset.jsonl&quot;</span>, <span class="hljs-number">64</span>, <span class="hljs-number">1000</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    asyncio.run(main())<br><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://openai.com/index/introducing-structured-outputs-in-the-api/">https://openai.com/index/introducing-structured-outputs-in-the-api/</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://python.langchain.com/docs/how_to/logprobs/">https://python.langchain.com/docs/how_to/logprobs/</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://python.langchain.com/docs/concepts/chat_models/#standard-parameters">https://python.langchain.com/docs/concepts/chat_models/#standard-parameters</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://python.langchain.com/docs/how_to/chat_model_rate_limiting/">https://python.langchain.com/docs/how_to/chat_model_rate_limiting/</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>LLM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CVE to CWE Root Cause Mapping Guidance (åŒè¯­å¯¹ç…§)</title>
    <link href="/2024/07/02/cve-to-cwe-root-cause-mapping-guidance/"/>
    <url>/2024/07/02/cve-to-cwe-root-cause-mapping-guidance/</url>
    
    <content type="html"><![CDATA[<h1 id="CVE-to-CWE-Root-Cause-Mapping-Guidance-æ¼æ´åˆ°å¼±ç‚¹çš„æ ¹æœ¬åŸå› æ˜ å°„æŒ‡å—"><a href="#CVE-to-CWE-Root-Cause-Mapping-Guidance-æ¼æ´åˆ°å¼±ç‚¹çš„æ ¹æœ¬åŸå› æ˜ å°„æŒ‡å—" class="headerlink" title="CVE to CWE Root Cause Mapping Guidance æ¼æ´åˆ°å¼±ç‚¹çš„æ ¹æœ¬åŸå› æ˜ å°„æŒ‡å—"></a>CVE to CWE Root Cause Mapping Guidance æ¼æ´åˆ°å¼±ç‚¹çš„æ ¹æœ¬åŸå› æ˜ å°„æŒ‡å—</h1><p>Original page: <a href="https://cwe.mitre.org/documents/cwe_usage/guidance.html">https://cwe.mitre.org/documents/cwe_usage/guidance.html</a></p><p><strong>Document Version:</strong>Â Â 1.1Â <em>(Released 3&#x2F;22&#x2F;2024)</em></p><p>This guidance is intended to helpÂ <a href="https://www.cve.org/PartnerInformation/Partner#CNA">CVE Numbering Authorities (CNAs)</a>Â and those who produce or analyzeÂ <a href="https://www.cve.org/About/Process#CVERecordLifecycle">CVE Records</a>Â to better identify and disclose the root causes of vulnerabilities . It is also likely to be helpful to those who are analyzing vulnerabilities that are not tracked by the CVE Program.</p><p>æ–‡æ¡£ç‰ˆæœ¬ï¼š1.1 (äº 2024 å¹´ 3 æœˆ 22 æ—¥ å‘å¸ƒ)</p><p>æœ¬æŒ‡å—æ—¨åœ¨å¸®åŠ© CVE ç¼–å·æˆæƒæœºæ„ (CNA) å’Œé‚£äº›åˆ¶ä½œæˆ–åˆ†æ CVE è®°å½•çš„äººå‘˜æ›´å¥½åœ°è¯†åˆ«å’ŒæŠ«éœ²æ¼æ´çš„æ ¹æœ¬åŸå› ã€‚å¯¹äºåˆ†æä¸åœ¨ CVE è®¡åˆ’è¿½è¸ªèŒƒå›´å†…çš„æ¼æ´çš„äººå‘˜æ¥è¯´ï¼Œæœ¬æŒ‡å—ä¹Ÿå¯èƒ½æœ‰æ‰€å¸®åŠ©ã€‚</p><h2 id="What-is-Root-Cause-Mapping"><a href="#What-is-Root-Cause-Mapping" class="headerlink" title="What is Root Cause Mapping?"></a>What is Root Cause Mapping?</h2><p>Root cause mapping is the identification of the underlying cause(s) of a vulnerability. This is best done by correlating CVE Records and&#x2F;or bug or vulnerability tickets with CWE entries. Today, this is not done accurately at scale by the vulnerability management ecosystem.</p><p>æ ¹æœ¬åŸå› æ˜ å°„æ˜¯æŒ‡è¯†åˆ«æ¼æ´çš„æ½œåœ¨åŸå› ã€‚å³å°† CVE è®°å½•ä¸ CWE æ¡ç›®å…³è”èµ·æ¥ã€‚ç›®å‰ï¼Œæ¼æ´ç®¡ç†ç”Ÿæ€ç³»ç»Ÿå°šæœªåœ¨å¤§è§„æ¨¡ä¸Šå‡†ç¡®åœ°å®Œæˆè¿™é¡¹å·¥ä½œã€‚</p><p>Accurate root cause mapping is valuable because it directly illuminates where investments, policy, and practices can address the root causes responsible for vulnerabilities so that they can be eliminated. This applies to both industry and government decision makers. Additionally, it enables:</p><ol><li>Driving the removal of classes of vulnerabilities: Root cause mapping encourages a valuable feedback loop into a vendorâ€™s SDLC or architecture design planning</li><li>Saving money: the more weaknesses avoided in your product development, the less vulnerabilities to manage after deployment</li><li>Trend analysis (e.g., how big of a problem is memory safety compared to other problems like injection)</li><li>Further insight to potential â€œexploitabilityâ€ based on root cause (e.g., command injection vulnerabilities tend to see increased adversary attention, be targeted by certain actors)</li><li>Organizations demonstrating transparency to customers how they are targeting and tackling problems in their products</li></ol><p>å‡†ç¡®çš„æ ¹æœ¬åŸå› æ˜ å°„å¾ˆæœ‰ä»·å€¼ï¼Œå› ä¸ºå®ƒç›´æ¥æ­ç¤ºäº†åœ¨å“ªäº›æ–¹é¢è¿›è¡ŒæŠ•èµ„ã€åˆ¶å®šæ”¿ç­–å’Œå®è·µå¯ä»¥è§£å†³å¯¼è‡´æ¼æ´çš„æ ¹æœ¬åŸå› ï¼Œä»è€Œæ¶ˆé™¤è¿™äº›æ¼æ´ã€‚è¿™é€‚ç”¨äºè¡Œä¸šæ”¿åºœå†³ç­–è€…å’Œæ”¿åºœå†³ç­–è€…ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜èƒ½å®ç°ï¼š</p><ol><li>æ¨åŠ¨æ¶ˆé™¤æŸäº›ç±»åˆ«çš„æ¼æ´:æ ¹æœ¬åŸå› æ˜ å°„é¼“åŠ±å°†æœ‰ä»·å€¼çš„åé¦ˆçº³å…¥ä¾›åº”å•†çš„è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸæˆ–æ¶æ„è®¾è®¡è§„åˆ’ä¸­</li><li>èŠ‚çœèµ„é‡‘:åœ¨äº§å“å¼€å‘ä¸­é¿å…çš„å¼±ç‚¹è¶Šå¤šï¼Œéƒ¨ç½²åéœ€è¦ç®¡ç†çš„æ¼æ´å°±è¶Šå°‘</li><li>è¶‹åŠ¿åˆ†æ(ä¾‹å¦‚ï¼Œä¸å…¶ä»–é—®é¢˜ç›¸æ¯”ï¼Œå†…å­˜å®‰å…¨é—®é¢˜æœ‰å¤šä¸¥é‡)</li><li>æ ¹æ®æ ¹æœ¬åŸå› è¿›ä¸€æ­¥æ´å¯Ÿæ½œåœ¨çš„â€å¯åˆ©ç”¨æ€§â€(ä¾‹å¦‚ï¼Œå‘½ä»¤æ³¨å…¥æ¼æ´å¾€å¾€ä¼šå¼•èµ·æ›´å¤šæ”»å‡»è€…çš„å…³æ³¨ï¼Œè¢«æŸäº›è¡Œä¸ºè€…é’ˆå¯¹)</li><li>ç»„ç»‡å‘å®¢æˆ·å±•ç¤ºä»–ä»¬å¦‚ä½•é’ˆå¯¹å’Œè§£å†³äº§å“ä¸­çš„é—®é¢˜</li></ol><h2 id="Overview-â€“-What-is-CWE"><a href="#Overview-â€“-What-is-CWE" class="headerlink" title="Overview â€“ What is CWE?"></a>Overview â€“ What is CWE?</h2><p>Common Weakness Enumeration (CWEâ„¢) is a community-developed list of common software and hardware weaknesses. A â€œweaknessâ€ is a condition in a software, firmware, hardware, or service component that, under certain circumstances, could contribute to the introduction of vulnerabilities. Referred to as CWEs, weaknesses are named, defined, and given a unique identifier on the CWE website. Weaknesses can occur in the design, implementation, or other phases of a product lifecycle. Many vulnerabilities have the same CWE as their root cause, independent of vendor, coding language, etc.</p><p>é€šç”¨å¼±ç‚¹åˆ—ä¸¾ (CWEâ„¢) æ˜¯ä¸€ä¸ªç”±ç¤¾åŒºå¼€å‘çš„å¸¸è§è½¯ä»¶å’Œç¡¬ä»¶å¼±ç‚¹åˆ—è¡¨ã€‚â€å¼±ç‚¹â€æ˜¯æŒ‡è½¯ä»¶ã€å›ºä»¶ã€ç¡¬ä»¶æˆ–æœåŠ¡ç»„ä»¶ä¸­çš„ä¸€ç§çŠ¶å†µï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´æ¼æ´çš„äº§ç”Ÿã€‚è¿™äº›è¢«ç§°ä¸º CWE çš„å¼±ç‚¹åœ¨ CWE ç½‘ç«™ä¸Šè¢«å‘½åã€å®šä¹‰å¹¶ç»™äºˆå”¯ä¸€æ ‡è¯†ç¬¦ã€‚å¼±ç‚¹å¯èƒ½å‡ºç°åœ¨äº§å“ç”Ÿå‘½å‘¨æœŸçš„è®¾è®¡ã€å®æ–½æˆ–å…¶ä»–é˜¶æ®µã€‚è®¸å¤šæ¼æ´å…·æœ‰ç›¸åŒçš„ CWE ä½œä¸ºå…¶æ ¹æœ¬åŸå› ï¼Œè¿™ä¸ä¾›åº”å•†ã€ç¼–ç è¯­è¨€ç­‰æ— å…³ã€‚</p><h3 id="Weakness-vs-Vulnerability-Language"><a href="#Weakness-vs-Vulnerability-Language" class="headerlink" title="Weakness vs. Vulnerability Language"></a>Weakness vs. Vulnerability Language</h3><p>As defined by the CVE Program, a vulnerability is an instance of one or more weaknesses in a Product that can be exploited, causing a negative impact to confidentiality, integrity, or availability; a set of conditions or behaviors that allows the violation of an explicit or implicit security policy.</p><p>CVE Record descriptions describe a vulnerability that has occurred in a product, often focusing on the technical impacts of its exploitation or exploitation prerequisites. Examples of technical impact phrases include â€œbypass authorizationâ€, â€œgain privilegesâ€, or â€œexecute malicious codeâ€. They describe the result of the vulnerability and its attack vectors, not the root cause(s).</p><p>æ ¹æ® CVE è®¡åˆ’çš„å®šä¹‰ï¼Œæ¼æ´æ˜¯æŒ‡äº§å“ä¸­å­˜åœ¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªå¼±ç‚¹ï¼Œè¿™äº›å¼±ç‚¹å¯èƒ½è¢«åˆ©ç”¨ï¼Œä»è€Œå¯¹æœºå¯†æ€§ã€å®Œæ•´æ€§æˆ–å¯ç”¨æ€§é€ æˆä¸åˆ©å½±å“ï¼›å®ƒä»¬æ˜¯ä¸€ç»„è¿åäº†æ˜ç¡®æˆ–éšå«å®‰å…¨ç­–ç•¥çš„æ¡ä»¶æˆ–è¡Œä¸ºã€‚CVE è®°å½•è¯¦ç»†æè¿°äº†äº§å“ä¸­å‡ºç°çš„æ¼æ´ï¼Œé€šå¸¸ç€é‡äºå…¶æŠ€æœ¯å½±å“æˆ–åˆ©ç”¨æ¡ä»¶ã€‚ä¾‹å¦‚ï¼ŒæŠ€æœ¯å½±å“å¯èƒ½åŒ…æ‹¬ â€œç»•è¿‡æˆæƒâ€ã€â€œæå‡æƒé™â€ æˆ– â€œæ‰§è¡Œæ¶æ„ä»£ç â€ï¼Œè¿™äº›æè¿°äº†æ¼æ´çš„åæœåŠå…¶æ”»å‡»æ–¹å¼ï¼Œè€Œéæ ¹æœ¬åŸå› ã€‚</p><p>Examples of exploitation prerequisite phrases include â€œunauthorized userâ€, â€œunauthenticated remote attackerâ€, or â€œadmin userâ€. While these phrases could be interpreted as being related to access control CWEs, they are not describing a weakness.</p><p>åˆ©ç”¨æ¡ä»¶å¯èƒ½åŒ…æ‹¬ â€œæœªæˆæƒç”¨æˆ·â€ã€â€œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…â€ æˆ– â€œç®¡ç†å‘˜ç”¨æˆ·â€ã€‚å°½ç®¡è¿™äº›æè¿°å¯èƒ½ä¸è®¿é—®æ§åˆ¶ç›¸å…³ï¼Œä½†å®ƒä»¬å¹¶ä¸ç›´æ¥è¯´æ˜å¼±ç‚¹æœ¬èº«ã€‚</p><p>In contrast, accurately mapping a CVE Record to a CWE requires information describing an issue that led to the vulnerability. Examples of weakness language include â€œmissing authenticationâ€, â€œimproper bounds checkâ€, or â€œstack-based buffer overflowâ€.</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå°† CVE è®°å½•å‡†ç¡®æ˜ å°„åˆ° CWE éœ€è¦è¯¦ç»†æè¿°å¯¼è‡´æ¼æ´çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¼±ç‚¹å¯èƒ½åŒ…æ‹¬ â€œç¼ºä¹èº«ä»½éªŒè¯â€ã€â€œä¸å½“çš„è¾¹ç•Œæ£€æŸ¥â€ æˆ– â€œåŸºäºæ ˆçš„ç¼“å†²åŒºæº¢å‡ºâ€ã€‚</p><blockquote><p><strong>Insecure Direct Object Reference</strong> (weakness)Â in MyProduct 10.1 to 10.6 allows anÂ <strong>unauthenticated attacker</strong> (prerequisite)Â toÂ <strong>read sensitive data and execute specific commands and functions with full admin rights</strong> (technical impact)Â via the page parameter to the &#x2F;api&#x2F;xyz API endpoint.</p></blockquote><h2 id="CWE-Resources-CWE-Entry-Structure"><a href="#CWE-Resources-CWE-Entry-Structure" class="headerlink" title="CWE Resources &amp; CWE Entry Structure"></a>CWE Resources &amp; CWE Entry Structure</h2><p>It is helpful to be familiar with how CWE defines weaknesses before diving into different ways of mapping. Having a clear grasp on these crucial components will help the overall mapping experience.</p><p>åœ¨æ·±å…¥äº†è§£ä¸åŒçš„æ˜ å°„æ–¹æ³•ä¹‹å‰ï¼Œäº†è§£ CWE å¦‚ä½•å®šä¹‰å¼±ç‚¹æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚æ¸…æ¥šåœ°æŒæ¡è¿™äº›å…³é”®ç»„æˆéƒ¨åˆ†å¾ˆæœ‰ç”¨ã€‚</p><h3 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h3><p>To provide a common language, CWE has aÂ <a href="https://cwe.mitre.org/documents/glossary/index.html">glossary of terminology</a>Â derived fromÂ <a href="https://cwe.mitre.org/documents/vulnerability_theory/intro.html">vulnerability theory</a>.</p><p>Terms can often mean different things based on the situation and the context in which they are used, as well as individualsâ€™ skills and experience in vulnerability management, or other related things that introduce subjectivity. Becoming familiar with these terms can help streamline utility of the CWE corpus.</p><p><strong>Common and Widely Used Terms in CWE</strong></p><p>The following highlights some of the most common terms in CWE, which are chosen based on their prevalence within CWE, vulnerability theory, and industry. They are presented here to alleviate confusion surrounding their meanings. This will lead to the selection of accurate, precise CWE(s) for root cause mapping.</p><ul><li>Important characteristics of weaknesses: <a href="https://cwe.mitre.org/documents/glossary/index.html#Behavior">Behavior</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Property">Property</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Technology">Technology</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Resource">Resource</a></li><li>Behavior qualifiers:Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Improper">Improper</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Incorrect">Incorrect</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Missing">Missing</a></li><li>Protection mechanisms: <a href="https://cwe.mitre.org/documents/glossary/index.html#Authentication">Authentication</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Authorization">Authorization</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Neutralization">Neutralization</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Permissions">Permissions</a></li></ul><h3 id="CWE-Relationships"><a href="#CWE-Relationships" class="headerlink" title="CWE Relationships"></a>CWE Relationships</h3><p>CWE contains over 900 weaknesses which range from abstract and conceptual to precise and technology specific. A precise weakness will have a â€œparentâ€ weakness that is more abstract, which may also have â€œparentâ€ weaknesses, and so on.</p><p>CWE åŒ…å«è¶…è¿‡ 900 ä¸ªå¼±ç‚¹ï¼ŒåŒ…å«æŠ½è±¡çš„æ¦‚å¿µæ€§å¼±ç‚¹ã€å…·ä½“çš„æŠ€æœ¯æ€§å¼±ç‚¹ã€‚ä¸€ä¸ªå…·ä½“çš„å¼±ç‚¹ä¼šæœ‰æ›´æŠ½è±¡çš„â€çˆ¶â€å¼±ç‚¹ï¼Œè€Œè¿™ä¸ªâ€çˆ¶â€å¼±ç‚¹å¯èƒ½ä¹Ÿæœ‰â€çˆ¶â€å¼±ç‚¹ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p>There are four types of weakness abstractions:Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Pillar%20Weakness">Pillar</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Class%20Weakness">Class</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Base%20Weakness">Base</a>, andÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Variant%20Weakness">Variant</a>. These abstraction types correlate with the amount of specific information in the CWE. This specific information includes dimensions such asÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Behavior">behavior</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Property">property</a>,Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Resource">resource</a>, coding language, andÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Technology">technology</a>. A set of weaknesses can be grouped into a Category, which is simply a collection of similar weaknesses that share common characteristics, but not the same combination of the dimensions above.</p><p>ä¸€å…±æœ‰å››ç§å¼±ç‚¹æŠ½è±¡ç­‰çº§ï¼šæ”¯æŸ±ã€ç±»ã€åŸºç¡€å’Œå˜ä½“ã€‚è¿™äº›æŠ½è±¡ç±»å‹ä¸ CWE ä¸­ç‰¹å®šä¿¡æ¯çš„æ•°é‡ç›¸å…³ã€‚è¿™äº›ç‰¹å®šä¿¡æ¯åŒ…æ‹¬è¡Œä¸ºã€å±æ€§ã€èµ„æºã€ç¼–ç è¯­è¨€å’ŒæŠ€æœ¯ç­‰ç»´åº¦ã€‚ä¸€ç»„å¼±ç‚¹å¯ä»¥è¢«å½’ç±»ä¸ºä¸€ä¸ªç±»åˆ«ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå…·æœ‰å…±åŒç‰¹å¾çš„ç±»ä¼¼å¼±ç‚¹çš„é›†åˆï¼Œä½†ä¸å…·æœ‰ä¸Šè¿°ç»´åº¦çš„ç›¸åŒç»„åˆã€‚</p><p><img src="/attachments/weakness_abstractions.png"></p><p>For root cause mapping, CWEs at theÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Base">Base</a>Â andÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Variant">Variant</a>Â level should be used whenever possible to ensure providing adequate specificity, actionability, and root cause information for a vulnerability.Â <a href="https://cwe.mitre.org/documents/glossary/index.html#Class">Class</a>Â level CWEs may be used for root cause mapping if there is no accurateÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Base">Base</a>Â orÂ <a href="https://cwe.mitre.org/documents/glossary/index.html#Variant">Variant</a>Â level CWE.</p><p>å¯¹äºæ ¹æœ¬åŸå› æ˜ å°„ï¼Œåº”å°½å¯èƒ½ä½¿ç”¨åŸºç¡€å’Œå˜ä½“çº§åˆ«çš„ CWEï¼Œä»¥ç¡®ä¿ä¸ºæ¼æ´æä¾›è¶³å¤Ÿçš„ç‰¹å¼‚æ€§ã€å¯æ“ä½œæ€§å’Œæ ¹æœ¬åŸå› ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰å‡†ç¡®çš„åŸºç¡€æˆ–å˜ä½“çº§åˆ«çš„ CWEï¼Œå¯ä»¥ä½¿ç”¨ç±»çº§åˆ«çš„ CWE è¿›è¡Œæ ¹æœ¬åŸå› æ˜ å°„ã€‚</p><p>Every CWE contains a Vulnerability Mapping label under its title, as well as Mapping Notes to assist with root cause mapping efforts. The possible labels are provided below:</p><ul><li>ALLOWED: this CWE ID could be used to map to real-world vulnerabilities</li><li>ALLOWED: with careful review of mapping notes</li><li>DISCOURAGED: this CWE ID should not be used to map to real-world vulnerabilities</li><li>PROHIBITED: this CWE ID must not be used to map to real-world vulnerabilities</li></ul><p>æ¯ä¸ª CWE åœ¨å…¶æ ‡é¢˜ä¸‹éƒ½åŒ…å«ä¸€ä¸ªæ¼æ´æ˜ å°„æ ‡ç­¾ï¼Œä»¥åŠå¸®åŠ©è¿›è¡Œæ ¹æœ¬åŸå› æ˜ å°„çš„æ˜ å°„è¯´æ˜ã€‚å¯èƒ½çš„æ ‡ç­¾å¦‚ä¸‹ï¼š</p><ul><li>å…è®¸ï¼šæ­¤ CWE ID å¯ç”¨äºæ˜ å°„åˆ°ç°å®ä¸–ç•Œçš„æ¼æ´</li><li>å…è®¸:ä»”ç»†æŸ¥çœ‹æ˜ å°„è¯´æ˜</li><li>ä¸é¼“åŠ±ï¼šæ­¤ CWE ID ä¸åº”ç”¨äºæ˜ å°„åˆ°ç°å®ä¸–ç•Œçš„æ¼æ´</li><li>ç¦æ­¢ï¼šæ­¤ CWE ID ä¸å¾—ç”¨äºæ˜ å°„åˆ°ç°å®ä¸–ç•Œçš„æ¼æ´</li></ul><p><img src="/attachments/cwe_actionable.png"></p><p>These labels are intended to ensure that root cause mapping provides appropriately precise and actionable correlations between CWE and CVE Records. CWE Mapping Notes â€“ which are linked to under each CWEâ€™s title â€“ provide additional details and helpful considerations with respect to using the CWE for root cause mapping.</p><p>è¿™äº›æ ‡ç­¾æ—¨åœ¨ç¡®ä¿æ ¹æœ¬åŸå› æ˜ å°„åœ¨ CWE å’Œ CVE è®°å½•ä¹‹é—´æä¾›é€‚å½“ç²¾ç¡®å’Œå¯æ“ä½œçš„ç›¸å…³æ€§ã€‚CWE æ˜ å°„è¯´æ˜ï¼ˆé™„åœ¨æ¯ä¸ª CWE æ¡ç›®ä¸‹ï¼‰æä¾›äº†å…³äºä½¿ç”¨ CWE çš„é¢å¤–ç»†èŠ‚ã€‚</p><h2 id="Mapping-Methodologies"><a href="#Mapping-Methodologies" class="headerlink" title="Mapping Methodologies"></a>Mapping Methodologies</h2><p>There are different ways to identify accurate weakness mapping(s) for a CVE Record. While one may be easier for some users versus another, a best practice is to verify your intended mapping with a colleague with slightly different skills and experience than you. Before starting, be sure to review theÂ <a href="https://cwe.mitre.org/documents/cwe_usage/mapping_examples.html">example root cause mappings</a>. Understanding the process and reasoning behind each example will help when using any of the following methods.</p><p>æœ‰ä¸åŒçš„æ–¹æ³•æ¥è¯†åˆ« CVE è®°å½•çš„å‡†ç¡®å¼±ç‚¹æ˜ å°„ã€‚è™½ç„¶æŸäº›ç”¨æˆ·å¯èƒ½è§‰å¾—æŸç§æ–¹æ³•æ›´å®¹æ˜“ï¼Œä½†æœ€ä½³å®è·µæ˜¯ä¸æŠ€èƒ½å’Œç»éªŒç•¥æœ‰ä¸åŒçš„åŒäº‹éªŒè¯ä½ çš„é¢„æœŸæ˜ å°„ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹ç¤ºä¾‹æ ¹æœ¬åŸå› æ˜ å°„ã€‚äº†è§£æ¯ä¸ªç¤ºä¾‹èƒŒåçš„è¿‡ç¨‹å’Œæ¨ç†å°†æœ‰åŠ©äºä½¿ç”¨ä»¥ä¸‹ä»»ä½•æ–¹æ³•ã€‚</p><h3 id="Keyword-Search-Method"><a href="#Keyword-Search-Method" class="headerlink" title="Keyword Search Method"></a>Keyword Search Method</h3><p>CWE has a search feature available on the home page of the CWE website, illustrated below.</p><p>You can search for keywords, or known CWE-IDs, or even a general term in the search box. This will find all matching pages to that term on the CWE web site, as all web pages are indexed.</p><p>CWE åœ¨å…¶ç½‘ç«™ä¸»é¡µä¸Šæä¾›äº†æœç´¢åŠŸèƒ½ã€‚ä½ å¯ä»¥åœ¨æœç´¢æ¡†ä¸­æœç´¢å…³é”®è¯ã€å·²çŸ¥çš„ CWE-IDï¼Œç”šè‡³æ˜¯ä¸€èˆ¬æœ¯è¯­ã€‚</p><blockquote><p>âœ”Â To limit your search to only individual CWE entry pages, include â€œinurl:definitionsâ€ in your query<br>è¦å°†æœç´¢é™åˆ¶ä¸ºä»…åŒ…å«å•ä¸ª CWE æ¡ç›®é¡µé¢ï¼Œè¯·åœ¨æŸ¥è¯¢ä¸­åŒ…å« â€œinurl:definitionsâ€</p></blockquote><h3 id="The-CWE-View-Methods"><a href="#The-CWE-View-Methods" class="headerlink" title="The CWE View Methods"></a>The CWE View Methods</h3><p>A CWE â€œ<a href="https://cwe.mitre.org/documents/glossary/index.html#View">View</a>â€ is a collection of weaknesses organized for a specific purpose or targeted at a specific audience. Most Views are a subset of the overall CWE list, but some Views include all CWE weaknesses. Using a View allows easier navigation of the CWE list according to a specific point of view. Note that a View is not a weakness itself but is a specific grouping of the CWE list. Depending on the View and its purpose, it may contain a flat list of CWE weaknesses, or it could contain a hierarchical view of CWE weaknesses broken into Categories.</p><p>CWE â€œè§†å›¾â€æ˜¯ä¸ºç‰¹å®šç›®çš„æˆ–é’ˆå¯¹ç‰¹å®šå—ä¼—ç»„ç»‡çš„å¼±ç‚¹é›†åˆã€‚å¤§å¤šæ•°è§†å›¾æ˜¯æ•´ä¸ª CWE åˆ—è¡¨çš„å­é›†ï¼Œä½†æœ‰äº›è§†å›¾åŒ…æ‹¬æ‰€æœ‰ CWE å¼±ç‚¹ã€‚ä½¿ç”¨è§†å›¾å¯ä»¥æ ¹æ®ç‰¹å®šè§‚ç‚¹æ›´è½»æ¾åœ°æµè§ˆ CWE åˆ—è¡¨ã€‚è¯·æ³¨æ„ï¼Œè§†å›¾æœ¬èº«ä¸æ˜¯å¼±ç‚¹ï¼Œè€Œæ˜¯ CWE åˆ—è¡¨çš„ç‰¹å®šåˆ†ç»„ã€‚æ ¹æ®è§†å›¾åŠå…¶ç›®çš„ï¼Œå®ƒå¯èƒ½åŒ…å« CWE å¼±ç‚¹çš„å¹³é¢åˆ—è¡¨ï¼Œæˆ–è€…å¯èƒ½åŒ…å«åˆ†ä¸ºç±»åˆ«çš„ CWE å¼±ç‚¹çš„å±‚æ¬¡è§†å›¾ã€‚</p><p><strong>Developer ViewÂ <a href="https://cwe.mitre.org/data/definitions/699.html">(View-699)</a></strong></p><p>This View organizes a subset of ~400 CWEs around concepts that are frequently used or encountered in software development. By design, this view is only 2 levels deep. The top level has categories of developer-friendly concepts to facilitate easier navigation (remember: never map a vulnerability to a CWE Category). The second level contains Base level weaknesses.</p><p>æ­¤è§†å›¾å›´ç»•è½¯ä»¶å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨æˆ–é‡åˆ°çš„æ¦‚å¿µç»„ç»‡äº†çº¦ 400 ä¸ª CWE çš„å­é›†ã€‚è¯¥è§†å›¾è®¾è®¡ä¸ºä»…æœ‰ 2 ä¸ªå±‚çº§ã€‚é¡¶å±‚åŒ…å«å¼€å‘è€…å‹å¥½çš„æ¦‚å¿µç±»åˆ«ï¼Œä»¥ä¾¿äºå¯¼èˆª(è®°ä½:æ°¸è¿œä¸è¦å°†æ¼æ´æ˜ å°„åˆ° CWE ç±»åˆ«)ã€‚ç¬¬äºŒå±‚åŒ…å«åŸºç¡€çº§åˆ«çš„å¼±ç‚¹ã€‚</p><p><strong>Software Assurance Trends ViewÂ <a href="https://cwe.mitre.org/data/definitions/1400.html">(View-1400)</a></strong></p><p>This view contains every CWE. CWEs are organized into 22 high-level categories of interest to large-scale software assurance research to support the elimination of weaknesses using tactics such as secure language development. This view is structured with categories at the top level, with a second level of only weaknesses.</p><p>æ­¤è§†å›¾åŒ…å«æ¯ä¸ª CWEã€‚CWE è¢«ç»„ç»‡æˆ 22 ä¸ªé«˜çº§ç±»åˆ«ï¼Œè¿™äº›ç±»åˆ«ä¸å¤§è§„æ¨¡è½¯ä»¶ä¿éšœç ”ç©¶ç›¸å…³ï¼Œæ—¨åœ¨æ”¯æŒä½¿ç”¨å®‰å…¨è¯­è¨€å¼€å‘ç­‰ç­–ç•¥æ¶ˆé™¤å¼±ç‚¹ã€‚è¯¥è§†å›¾çš„ç»“æ„ä¸ºé¡¶å±‚ç±»åˆ«ï¼Œç¬¬äºŒå±‚ä»…åŒ…å«å¼±ç‚¹ã€‚</p><p><strong>Research ViewÂ <a href="https://cwe.mitre.org/data/definitions/1000.html">(View-1000)</a></strong></p><p>This View also contains every CWE. It has a deep tree structure, beginning with 10 high-level Pillars. It might be especially useful when you are looking for unusual weaknesses, as you could perform a top-down search.</p><p>æ­¤è§†å›¾ä¹ŸåŒ…å«æ¯ä¸ª CWEã€‚å®ƒå…·æœ‰æ·±å±‚æ ‘çŠ¶ç»“æ„ï¼Œä» 10 ä¸ªé«˜çº§æ”¯æŸ±å¼€å§‹ã€‚å½“ä½ åœ¨å¯»æ‰¾ä¸å¸¸è§çš„å¼±ç‚¹æ—¶ï¼Œè¿™å¯èƒ½ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥è¿›è¡Œè‡ªä¸Šè€Œä¸‹çš„æœç´¢ã€‚</p><p><strong>Hardware Design ViewÂ <a href="https://cwe.mitre.org/data/definitions/1194.html">(View-1194)</a></strong></p><p>This View organizes ~100 weaknesses around concepts that are frequently used or encountered in hardware design. Similar to View-699, this View also tries to be only 2 levels deep. The top level has categories of designer&#x2F;architect-friendly concepts to facilitate navigation (remember: never map a vulnerability to a CWE Category). The second level contains Base&#x2F;Class level weaknesses.</p><p>æ­¤è§†å›¾å›´ç»•ç¡¬ä»¶è®¾è®¡ä¸­ç»å¸¸ä½¿ç”¨æˆ–é‡åˆ°çš„æ¦‚å¿µç»„ç»‡äº†çº¦ 100 ä¸ªå¼±ç‚¹ã€‚ä¸è§†å›¾-699 ç±»ä¼¼ï¼Œè¯¥è§†å›¾ä¹Ÿå°è¯•ä»…ä¿æŒ 2 ä¸ªå±‚çº§ã€‚é¡¶å±‚åŒ…å«è®¾è®¡å¸ˆ&#x2F;æ¶æ„å¸ˆå‹å¥½çš„æ¦‚å¿µç±»åˆ«ï¼Œä»¥ä¾¿äºå¯¼èˆª(è®°ä½:æ°¸è¿œä¸è¦å°†æ¼æ´æ˜ å°„åˆ° CWE ç±»åˆ«)ã€‚ç¬¬äºŒå±‚åŒ…å«åŸºç¡€&#x2F;ç±»çº§åˆ«çš„å¼±ç‚¹ã€‚</p><p><strong>NVD ViewÂ <a href="https://cwe.mitre.org/data/definitions/1003.html">(View-1003)</a></strong></p><p>This View organizes a subset of ~130 CWEs most commonly seen in the National Vulnerability Database (NVD).</p><p>æ­¤è§†å›¾ç»„ç»‡äº†åœ¨ NVD ä¸­æœ€å¸¸è§çš„çº¦ 130 ä¸ª CWE å­é›†ã€‚</p><h3 id="If-a-Mapping-Still-Cannot-be-Found"><a href="#If-a-Mapping-Still-Cannot-be-Found" class="headerlink" title="If a Mapping Still Cannot be Found"></a>If a Mapping Still Cannot be Found</h3><p>If youâ€™ve exhausted your search and still canâ€™t find an appropriate weakness to map your vulnerability, you may have found a gap in CWE coverage! Although CWE tries to be comprehensive, we recognize that weâ€™re likely to miss certain areas from time to time. Please see theÂ <a href="https://cwe.mitre.org/community/submissions/overview.html">CWE Submission Information</a>Â and weâ€™ll work with you to create a CWE on that topic.</p><h2 id="Common-Terms-Cheatsheet"><a href="#Common-Terms-Cheatsheet" class="headerlink" title="Common Terms Cheatsheet"></a>Common Terms Cheatsheet</h2><p><strong>Pillar Weakness</strong>: These are the highest-level weaknesses that cannot be made any more abstract. They typically only describe one or two dimensions at a high level of abstraction.</p><p><strong>æ”¯æŸ±å¼±ç‚¹</strong>ï¼š è¿™äº›æ˜¯æœ€é«˜çº§åˆ«çš„å¼±ç‚¹ï¼Œæ— æ³•è¿›ä¸€æ­¥æŠ½è±¡ã€‚å®ƒä»¬é€šå¸¸åªåœ¨é«˜åº¦æŠ½è±¡çš„å±‚é¢ä¸Šæè¿°ä¸€ä¸ªæˆ–ä¸¤ä¸ªç»´åº¦ã€‚</p><p><strong>Class Weakness</strong>: These are weaknesses that can be described abstractly, typically independent of any specific language or technology. They typically describe two dimensions.</p><p><strong>ç±»å¼±ç‚¹</strong>ï¼š è¿™äº›æ˜¯å¯ä»¥æŠ½è±¡æè¿°çš„å¼±ç‚¹ï¼Œé€šå¸¸ç‹¬ç«‹äºä»»ä½•ç‰¹å®šè¯­è¨€æˆ–æŠ€æœ¯ã€‚å®ƒä»¬é€šå¸¸æè¿°ä¸¤ä¸ªç»´åº¦ã€‚</p><p><strong>Base Weakness</strong>: These weaknesses build on a Class weakness by providing lower-abstraction concepts for two to three dimensions, although these concepts are still typically associated with groups of specific languages, technologies, or resources.</p><p><strong>åŸºç¡€å¼±ç‚¹</strong>ï¼š è¿™äº›å¼±ç‚¹å»ºç«‹åœ¨ç±»å¼±ç‚¹çš„åŸºç¡€ä¸Šï¼Œä¸ºä¸¤åˆ°ä¸‰ä¸ªç»´åº¦æä¾›è¾ƒä½æŠ½è±¡æ¦‚å¿µï¼Œå°½ç®¡è¿™äº›æ¦‚å¿µé€šå¸¸ä»ä¸ç‰¹å®šè¯­è¨€ã€æŠ€æœ¯æˆ–èµ„æºç»„ç›¸å…³è”ã€‚</p><p><strong>Variant Weakness</strong>: These weaknesses build on a Base weakness by linking to an individual type of language, technology, or resource. They typically cover three or more dimensions.</p><p><strong>å˜ä½“å¼±ç‚¹</strong>ï¼š è¿™äº›å¼±ç‚¹å»ºç«‹åœ¨åŸºç¡€å¼±ç‚¹ä¹‹ä¸Šï¼Œé“¾æ¥åˆ°å•ä¸ªç±»å‹çš„è¯­è¨€ã€æŠ€æœ¯æˆ–èµ„æºã€‚å®ƒä»¬é€šå¸¸æ¶µç›–ä¸‰ä¸ªæˆ–æ›´å¤šç»´åº¦ã€‚</p><p><strong>Resource</strong>: A vulnerability theory term for an object or entity that is accessed or modified within the operation of the product, such as memory, CPU, files, or sockets. Resources can be system-level (memory or CPU), code-level (function or variable), or application-level (cookie or message).</p><p><strong>èµ„æº</strong>ï¼š æ¼æ´ç†è®ºæœ¯è¯­ï¼ŒæŒ‡åœ¨äº§å“æ“ä½œä¸­è®¿é—®æˆ–ä¿®æ”¹çš„å¯¹è±¡æˆ–å®ä½“ï¼Œå¦‚å†…å­˜ã€CPUã€æ–‡ä»¶æˆ–å¥—æ¥å­—ã€‚èµ„æºå¯ä»¥æ˜¯ç³»ç»Ÿçº§(å†…å­˜æˆ– CPU)ã€ä»£ç çº§(å‡½æ•°æˆ–å˜é‡)æˆ–åº”ç”¨çº§(cookie æˆ–æ¶ˆæ¯)ã€‚</p><p><strong>Information Exposure</strong>: The intentional or unintentional disclosure of information to an actor that is not explicitly authorized to have access to that information.</p><p><strong>ä¿¡æ¯æ³„éœ²</strong>ï¼š æœ‰æ„æˆ–æ— æ„åœ°å‘æœªæ˜ç¡®æˆæƒè®¿é—®è¯¥ä¿¡æ¯çš„è¡Œä¸ºè€…æŠ«éœ²ä¿¡æ¯ã€‚</p><p><strong>Improper</strong>: Used as a catch-all term to cover security behaviors that are either â€œMissingâ€ or â€œIncorrectâ€.</p><p><strong>ä¸å½“</strong>ï¼š ç”¨ä½œæ¶µç›–â€ç¼ºå¤±â€æˆ–â€ä¸æ­£ç¡®â€çš„å®‰å…¨è¡Œä¸ºçš„æ€»ç§°ã€‚</p><p><strong>Missing</strong>: Used to describe a behavior that the developer has not attempted to perform.</p><p><strong>ç¼ºå¤±</strong>ï¼š ç”¨äºæè¿°å¼€å‘äººå‘˜å°šæœªå°è¯•æ‰§è¡Œçš„è¡Œä¸ºã€‚</p><p><strong>Incorrect</strong>: A general term, used to describe when a behavior attempts to do a task but does not do it correctly.</p><p><strong>ä¸æ­£ç¡®</strong>ï¼š ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼Œç”¨äºæè¿°å½“è¡Œä¸ºè¯•å›¾æ‰§è¡Œä»»åŠ¡ä½†æœªæ­£ç¡®æ‰§è¡Œæ—¶çš„æƒ…å†µã€‚</p><p><strong>Authentication</strong>: The process of verifying that an actor has a specific real-world identity, typically by checking for information that the product assumes can only be produced by that actor.</p><p><strong>èº«ä»½éªŒè¯</strong>ï¼š éªŒè¯è¡Œä¸ºè€…å…·æœ‰ç‰¹å®šç°å®ä¸–ç•Œèº«ä»½çš„è¿‡ç¨‹ï¼Œé€šå¸¸é€šè¿‡æ£€æŸ¥äº§å“å‡å®šåªèƒ½ç”±è¯¥è¡Œä¸ºè€…äº§ç”Ÿçš„ä¿¡æ¯æ¥å®Œæˆã€‚</p><p><strong>Authorization</strong>: The process of determining whether an actor with a given identity is allowed to have access to a resource, then granting access to that resource, as defined by the implicit and explicit security policies for the system.</p><p><strong>æˆæƒ</strong>ï¼š ç¡®å®šå…·æœ‰ç»™å®šèº«ä»½çš„è¡Œä¸ºè€…æ˜¯å¦è¢«å…è®¸è®¿é—®èµ„æºï¼Œç„¶åæ ¹æ®ç³»ç»Ÿçš„éšå¼å’Œæ˜¾å¼å®‰å…¨ç­–ç•¥æˆäºˆå¯¹è¯¥èµ„æºçš„è®¿é—®æƒé™çš„è¿‡ç¨‹ã€‚</p><p><strong>Permissions</strong>: The explicit specifications for a resource, or a set of resources, that defines which actors are allowed to access that resource, and which actions may be performed by those actors.</p><p><strong>æƒé™</strong>ï¼š å¯¹èµ„æºæˆ–ä¸€ç»„èµ„æºçš„æ˜ç¡®è§„å®šï¼Œå®šä¹‰äº†å“ªäº›è¡Œä¸ºè€…è¢«å…è®¸è®¿é—®è¯¥èµ„æºï¼Œä»¥åŠè¿™äº›è¡Œä¸ºè€…å¯ä»¥æ‰§è¡Œå“ªäº›æ“ä½œã€‚</p><p><strong>Neutralization</strong>: A general term to describe the process of ensuring that input or output has certain security properties before it is used. This is independent of the specific protection mechanism that performs the neutralization. The term could refer to one or more of the following: filtering&#x2F;cleansing, canonicalization&#x2F;resolution, encoding&#x2F;decoding, escaping&#x2F;unescaping, quoting&#x2F;unquoting, validation, or other mechanisms.</p><p><strong>ä¸­å’Œ</strong>ï¼š ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼Œç”¨äºæè¿°ç¡®ä¿è¾“å…¥æˆ–è¾“å‡ºåœ¨ä½¿ç”¨å‰å…·æœ‰æŸäº›å®‰å…¨å±æ€§çš„è¿‡ç¨‹ã€‚è¿™ä¸æ‰§è¡Œä¸­å’Œçš„å…·ä½“ä¿æŠ¤æœºåˆ¶æ— å…³ã€‚è¯¥æœ¯è¯­å¯èƒ½æŒ‡ä»¥ä¸‹ä¸€é¡¹æˆ–å¤šé¡¹ï¼šè¿‡æ»¤&#x2F;æ¸…ç†ã€è§„èŒƒåŒ–&#x2F;è§£æã€ç¼–ç &#x2F;è§£ç ã€è½¬ä¹‰&#x2F;åè½¬ä¹‰ã€å¼•ç”¨&#x2F;å–æ¶ˆå¼•ç”¨ã€éªŒè¯æˆ–å…¶ä»–æœºåˆ¶ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ— ç—› Python ç¯å¢ƒï¼ˆLinux æœºå™¨ï¼‰</title>
    <link href="/2024/05/29/painless-python-env/"/>
    <url>/2024/05/29/painless-python-env/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Python æ˜¯ä¸€é—¨çµæ´»ã€å¤šç”¨é€”çš„ç¼–ç¨‹è¯­è¨€ï¼Œå‡ ä¹åœ¨æ‰€æœ‰åœºåˆéƒ½æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚ç»è¿‡å¤šå¹´çš„å‘å±•ï¼ŒPython è¯­è¨€æ‹¥æœ‰æ•°é‡åºå¤§çš„å·¥å…·é“¾ï¼Œå…¶â€œé…ç¯å¢ƒâ€çš„è¿‡ç¨‹ç»å¸¸è®©åˆå­¦è€…æ„Ÿåˆ°å¤´ç–¼ã€‚æœ¬æ–‡ä»å¼€å‘å·¥å…·çš„åŸºæœ¬æ¦‚å¿µå…¥æ‰‹ï¼Œå¸Œæœ›å¸®åŠ©å¤§å®¶æ— ç—›è§£å†³ Python é…ç¯å¢ƒé—®é¢˜ã€‚</p><p>åœ¨è¿›è¡Œå®æ“å‰ï¼Œæˆ‘ä»¬å¿«é€Ÿæ‰«ä¸€ä¸‹å‡ ä¸ªå¸¸è§æ¦‚å¿µï¼š</p><ul><li>Python è§£é‡Šå™¨ï¼šè´Ÿè´£è§£ææºä»£ç å¹¶æ‰§è¡Œç›¸åº”åŠŸèƒ½çš„ç¨‹åºï¼Œä¸€å°æœºå™¨ä¸Šå¯èƒ½åŒæ—¶æ‹¥æœ‰å¤šä¸ªè§£é‡Šå™¨ï¼Œå®ƒä»¬å¯èƒ½å¯¹åº”ä¸åŒçš„ç‰ˆæœ¬å’Œä¾èµ–åº“</li><li>Python ç‰ˆæœ¬ï¼šPython ç¼–ç¨‹è¯­è¨€æœ¬èº«çš„ç‰ˆæœ¬ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒPython3 çš„æ–°ç‰ˆæœ¬å¯ä»¥å…¼å®¹æ‰€æœ‰ Python3 è€ç‰ˆæœ¬ä»£ç ï¼Œè€Œè¾ƒè€çš„è§£é‡Šå™¨å¯èƒ½æ— æ³•æ‰§è¡ŒæŸäº›æ–°ç‰¹æ€§ã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°çš„ Python 3.12ï¼Œå°½é‡ä¸è¦ä½¿ç”¨è¿‡è€ç‰ˆæœ¬ï¼Œç”šè‡³æ˜¯ Python2</li><li>Python åŒ…å’Œè™šæ‹Ÿç¯å¢ƒï¼šè¦æƒ³åœ¨ä»£ç ä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…ï¼Œå°±éœ€è¦åœ¨å½“å‰ç¯å¢ƒä¸­å®‰è£…åŒ…ã€‚ç¬¬ä¸‰æ–¹åŒ…ä¹‹é—´ä¼šæœ‰å¤æ‚çš„ç‰ˆæœ¬ä¾èµ–ã€‚ä¸ºäº†åœ¨ä¸åŒé¡¹ç›®ä¸­éš”ç¦»ä¾èµ–ï¼Œè™šæ‹Ÿç¯å¢ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ Python è§£é‡Šå™¨ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</li></ul><p>ä½ å¯èƒ½å¬è¯´è¿‡å¾ˆå¤šå’Œè™šæ‹Ÿç¯å¢ƒç›¸å…³çš„ Python å¼€å‘å·¥å…·ï¼Œæ¯”å¦‚ pip, conda, pipenv, poetry ç­‰ï¼Œå®ƒä»¬å¯èƒ½ä¼šæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>Python ç‰ˆæœ¬ç®¡ç†ï¼šå…è®¸ä½ å®‰è£…å¤šä¸ª Python ç‰ˆæœ¬å¹¶åˆ‡æ¢</li><li>Python åŒ…ç®¡ç†ï¼šè´Ÿè´£ä¸‹è½½ã€å®‰è£…ã€å¸è½½ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶å¦¥å–„å¤„ç†å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li>è™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼šåˆ›å»ºç›¸äº’ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒ</li><li>é¡¹ç›®æ‰“åŒ…ï¼šæ„å»ºã€å‘å¸ƒä½ å¼€å‘çš„ Python åŒ…</li></ul><p><img src="/attachments/py-tools-category.png"></p><p>ä¸Šå›¾æ¥è‡ª <a href="https://alpopkes.com/posts/python/packaging_tools/#categorization">è¿™ç¯‡åšå®¢</a> ï¼Œå®ƒå±•ç¤ºäº†è®¸å¤šå·¥å…·çš„åŠŸèƒ½èŒƒç•´ã€‚ä¾‹å¦‚å¸¸è§çš„ conda å®é™…ä¸ŠåŒæ—¶æä¾›äº†ç‰ˆæœ¬ç®¡ç†ã€åŒ…ç®¡ç†ã€è™šæ‹Ÿç¯å¢ƒç®¡ç†ç­‰åŠŸèƒ½ã€‚</p><p>å“ªä¸ªå·¥å…·æœ€å¥½ï¼Ÿæˆ‘è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿâ€”â€” æ²¡æœ‰æœ€å¥½çš„å·¥å…·ï¼Œåªæœ‰ç¬¦åˆéœ€æ±‚çš„å·¥å…·æ‰æ˜¯æœ€å¥½çš„ã€‚Python è¯­è¨€æœ‰éå¸¸å¤šçš„ç”¨é€”ï¼Œæ¯ç§ç”¨é€”éƒ½å¯èƒ½æœ‰ä¸ä¸€æ ·çš„éœ€è¦ï¼š</p><ul><li><strong>æ•°æ®åˆ†æ&#x2F;å¯è§†åŒ–</strong> é€šå¸¸éœ€è¦ notebook ç¯å¢ƒï¼Œå¹¶ä¸”ä¾èµ–çš„ç¬¬ä¸‰æ–¹åŒ…ç›¸å¯¹å›ºå®š</li><li><strong>æ·±åº¦å­¦ä¹ ç ”ç©¶</strong> å¯èƒ½ä¼šæ¶‰åŠè®¸å¤šä¸æˆç†Ÿçš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒè¾ƒä¸ºé¢‘ç¹</li><li><strong>å·¥ä½œè‡ªåŠ¨åŒ–</strong> ç¼–å†™è„šæœ¬ã€ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œä¸è¿‡åˆ†å¼ºè°ƒä¾èµ–éš”ç¦»ï¼Œåªéœ€è¦ä¸€å®šæ•°é‡çš„ç¬¬ä¸‰æ–¹åŒ…</li><li><strong>Web å¼€å‘</strong> é€šå¸¸éœ€è¦è¾ƒä¸ºä¸¥æ ¼çš„ä¾èµ–ç®¡ç†å’Œé¡¹ç›®æ‰“åŒ…</li></ul><p>æœ¬æ–‡æ¨èä½¿ç”¨ conda å’Œ poetry è¿™ä¸¤ä¸ªä¸»æµå·¥å…·ã€‚ä»¥ Linux æœºå™¨ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼Œé»˜è®¤è¯»è€…æœ‰åŸºæœ¬çš„ Linux çŸ¥è¯†ã€‚</p><h3 id="å®‰è£…-conda"><a href="#å®‰è£…-conda" class="headerlink" title="å®‰è£… conda"></a>å®‰è£… conda</h3><p>conda çš„ä¼˜åŠ¿ï¼š</p><ul><li>èƒ½å¤Ÿæ”¯æŒ Python è¯­è¨€ä»¥å¤–çš„ä¾èµ–ï¼Œç›¸æ¯”äº Python ä¸“ç”¨çš„ pip æ›´å¼ºå¤§</li><li>èƒ½å¾ˆå¥½åœ°å’Œ pip åŒæ—¶ä½¿ç”¨</li><li>åŒæ—¶æä¾› Python ç‰ˆæœ¬ç®¡ç†å’Œè™šæ‹Ÿç¯å¢ƒç®¡ç†</li></ul><p>conda çš„åŠ£åŠ¿ï¼š</p><ul><li>ä¾èµ–è§£æå¯èƒ½æ¯”è¾ƒæ…¢ï¼Œä¾èµ–ç®¡ç†ç›¸å¯¹å®½æ¾</li><li>ä¸æ”¯æŒ <code>pyproject.toml</code> ç›¸å…³åŠŸèƒ½ï¼Œä¸æä¾›æ‰“åŒ…åŠŸèƒ½</li></ul><p>é™¤éä½ å¸Œæœ›ä½ çš„ Python èƒ½å¼€ç®±å³ç”¨ï¼ˆAnaconda æä¸ºè‡ƒè‚¿ï¼‰ï¼Œå¦åˆ™ä¸€å¾‹æ¨è minicondaã€‚å…¶å®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œä¸‹è½½ miniconda3 å®‰è£…æ–‡ä»¶ï¼Œæ­¤å¤„ä½¿ç”¨æ¸…åé•œåƒç«™ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ <code>bash miniconda.sh</code> æ‰§è¡Œå®‰è£…ç¨‹åºï¼Œè¯·æ ¹æ®å‘½ä»¤è¡ŒæŒ‡å¼•ï¼Œé€æ­¥å®‰è£…ã€‚æˆ‘ä»¬å‡è®¾å®‰è£…è·¯å¾„ä¸º <code>~/miniconda3</code>ã€‚å®‰è£…å®Œæˆåè¯¥æ–‡ä»¶å°±æ²¡ç”¨äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>rm miniconda3</code> åˆ é™¤ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œå°† conda ç»‘å®šåˆ°ä½ çš„ shellï¼Œä¾‹å¦‚æˆ‘ä½¿ç”¨ zshï¼Œé‚£ä¹ˆå°±æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯æ·»åŠ ä¸€æ®µè„šæœ¬åˆ° <code>~/.zshrc</code> æ–‡ä»¶ã€‚ç„¶åé‡å¯ shell å³å¯ç”Ÿæ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/miniconda3/bin/conda init zsh<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸå®‰è£…ï¼Œé‡å¯ shell åï¼Œä½ å°†ä¼šåœ¨ shell prompt ä¸­çœ‹åˆ° â€œ(base)â€ çš„æ ‡è¯†ï¼Œè¿™ä»£è¡¨ä½ ç°åœ¨ä½äº conda çš„ base ç¯å¢ƒä¸­ã€‚ç„¶åå°±å¯ä»¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒäº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create -n myenv python=3.10<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ›´å¿«åœ°ä¸‹è½½åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¸…åé•œåƒç«™ï¼š</p><ul><li>ä¿®æ”¹ <code>~/.condarc</code> æ–‡ä»¶ï¼Œå‚è€ƒ <a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/">æ¸…åé•œåƒç«™æŒ‡å¼•</a> æ·»åŠ ç›¸åº”å†…å®¹</li><li>å¯¹äº pipï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥æŒ‡å®š <code>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></li></ul><p>å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>conda æœ¬èº«ä¸ä¾èµ–ç³»ç»Ÿçš„ Pythonï¼Œæ‰€ä»¥ä½ æ— éœ€å®‰è£…å…¶ä»–ä»»ä½• Python å°±èƒ½ç›´æ¥ä½¿ç”¨ conda ç¯å¢ƒã€‚</li><li>é…åˆ IDE (å¦‚ VSCode) ä½¿ç”¨æ—¶ï¼Œè¯·æ³¨æ„åœ¨å·¦ä¸‹è§’é€‰æ‹©æ­£ç¡®çš„ Python è§£é‡Šå™¨ã€‚</li><li>å®‰è£…ä¾èµ–æ—¶ï¼Œè¯·ç¡®è®¤å·²ç»ä½¿ç”¨ <code>conda activate &lt;env&gt;</code> åˆ‡æ¢åˆ°æ­£ç¡®çš„è™šæ‹Ÿç¯å¢ƒã€‚</li><li>conda å¾ˆå®¹æ˜“â€œé‡å¼€â€ï¼Œå¦‚æœç¯å¢ƒæ²¡é…å¥½ï¼Œç›´æ¥åˆ äº†é‡æ–°åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå°±å¯ä»¥äº†ã€‚conda è‡ªèº«çš„é‡è£…ä¹Ÿå¾ˆå®¹æ˜“ï¼Œç›´æ¥åˆ é™¤æ•´ä¸ªå®‰è£…ç›®å½•å³å¯ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚</li></ul><h3 id="å®‰è£…-poetry"><a href="#å®‰è£…-poetry" class="headerlink" title="å®‰è£… poetry"></a>å®‰è£… poetry</h3><p>poetry çš„ä¼˜åŠ¿ï¼š</p><ul><li>ä¸“æ³¨ Python é¡¹ç›®ï¼Œä¸€ä¸ªé¡¹ç›®å¯¹åº”ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¹¶æä¾›æ‰“åŒ…å’Œå‘å¸ƒåŠŸèƒ½ï¼Œå®Œæ•´æ”¯æŒ <code>pyproject.toml</code></li><li>ä¾èµ–è§£æåŠŸèƒ½å¼ºå¤§ï¼Œä¸€è‡´æ€§å¥½</li></ul><p>poetry çš„åŠ£åŠ¿ï¼š</p><ul><li>ä¸èƒ½ç®¡ç† Python åŒ…ä»¥å¤–çš„ä¾èµ–</li><li>ä¸æ¨èå¤ç”¨é¡¹ç›®ç¯å¢ƒ</li></ul><p>æ¨èä½¿ç”¨ pipx æ¥å®‰è£… poetryã€‚è¿™æ˜¯å› ä¸º poetry æœ¬èº«æ˜¯ä¸€ä¸ªåŸºäº Python è¯­è¨€çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œ pipx èƒ½å¤Ÿä¸ºæ¯ä¸ªåº”ç”¨åˆ›é€ ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒã€‚è¦ä½¿ç”¨ pipxï¼Œé¦–å…ˆéœ€è¦ä»¥ root èº«ä»½å®‰è£…ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install pipx<br></code></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ä»¥ç”¨æˆ·èº«ä»½ä¸ºè‡ªå·±å•ç‹¬å®‰è£…åº”ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pipx ensurepath<br>pipx install poetry<br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼Œpoetry ä¹Ÿå¯ä»¥ä½¿ç”¨ pypi æ¸…åé•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">poetry <span class="hljs-built_in">source</span> add --priority=primary mirrors https://pypi.tuna.tsinghua.edu.cn/simple/<br></code></pre></td></tr></table></figure><p>å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ä¸ conda çš„è™šæ‹Ÿç¯å¢ƒä¸åŒçš„æ˜¯ï¼Œpoetry çš„è™šæ‹Ÿç¯å¢ƒå®é™…ä¸Šä¸ <code>pyproject.toml</code> ç»‘å®šã€‚æ‰€ä»¥åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ å¹¶ä¸èƒ½è„±ç¦»ä¸€ä¸ª python é¡¹ç›®åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¹¶å°†è¯¥ç¯å¢ƒåœ¨å¤šä¸ªç›®å½•ä¸­å¤ç”¨ã€‚</li><li>poetry æœ¬èº«ä»¥åŠ poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒéƒ½ä¾èµ–å¤–éƒ¨çš„ Pythonã€‚poetry ä¸æä¾› Python ç‰ˆæœ¬çš„ç®¡ç†å’Œåˆ‡æ¢ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ pyenv ç­‰å·¥å…·ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥æ¨èä½¿ç”¨ pipx å®‰è£… poetryï¼Œæ­£æ˜¯ä¸ºäº†é˜²æ­¢ç³»ç»Ÿ Python çš„ä¾èµ–å½±å“åˆ° poetry è‡ªèº«çš„è¿è¡Œã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>#python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åº”å¯¹ GPU æœåŠ¡å™¨çš„è¿‡çƒ­é—®é¢˜</title>
    <link href="/2024/05/06/gpu-monitoring-management/"/>
    <url>/2024/05/06/gpu-monitoring-management/</url>
    
    <content type="html"><![CDATA[<h2 id="æœ¬æ–‡èƒŒæ™¯"><a href="#æœ¬æ–‡èƒŒæ™¯" class="headerlink" title="æœ¬æ–‡èƒŒæ™¯"></a>æœ¬æ–‡èƒŒæ™¯</h2><p>ä½¿ç”¨è€æ—§çš„ GPU æœºå™¨ï¼Œæ•£çƒ­èƒ½åŠ›ä¸‹é™ï¼Œå½±å“æ€§èƒ½ç”šè‡³å‡ºç°è¿‡çƒ­ç°è±¡ã€‚ç°è±¡åŒ…æ‹¬ï¼š</p><ol><li>é€šè¿‡ <code>nvidia-smi</code> å‘½ä»¤æŸ¥çœ‹ GPU æ¸©åº¦ï¼Œå‘ç°ç©ºè½½æ—¶æ¸©åº¦æ˜¾è‘—é«˜äºç¯å¢ƒæ¸©åº¦ï¼ˆä¾‹å¦‚ 40 åº¦ï¼‰</li><li>è¿è¡Œæ¯”è¾ƒè®¡ç®—å¯†é›†çš„ä»»åŠ¡æ—¶ï¼Œç”±äºæ•£çƒ­è¾ƒå·®ï¼ŒGPU æ¸©åº¦å‹ä¸åˆ°åˆç†åŒºé—´ï¼ˆä¾‹å¦‚è¶…è¿‡ 85 åº¦ï¼‰</li><li>GPU è¿‡çƒ­åä¼šè§¦å‘ç¡¬ä»¶ä¿æŠ¤å¼ºè¡Œåˆ‡æ¢ç”µæºï¼Œè¿›ç¨‹é€€å‡ºä¸”ä¸èƒ½å†ä½¿ç”¨ GPU</li></ol><p>è¿‡çƒ­åå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Unable to determine the device handle for 0000:02:00.0: Unknown Error<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„åºå·æ˜¯æ€»çº¿æ ‡è¯†ç¬¦ï¼Œå’Œ <code>nvidia-smi</code> å‘½ä»¤ä¸­æŸ¥åˆ°çš„ GPU æ˜¯å¯¹åº”çš„ï¼Œä»è¿™é‡Œå¯ä»¥å¾—çŸ¥æ˜¯å“ªå¼  GPU è¿‡çƒ­æ‰ç”µã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä¸´æ—¶è§£å†³æ–¹å¼ï¼šè¿‡çƒ­æ‰ç”µåï¼Œç­‰æ¸©åº¦é™ä¸‹æ¥åé‡å¯æœºå™¨å³å¯æ¢å¤ã€‚</p><p>å¦¥åæ–¹æ¡ˆï¼šè°ƒæ•´ GPU ç”µæºæ¨¡å¼ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ root æƒé™ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nvidia-smi -pm 1<br></code></pre></td></tr></table></figure><p>è¿™å°†å¼€å¯ GPU çš„ â€œpersistence modeâ€ã€‚ç„¶åæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nvidia-smi -pl 100<br></code></pre></td></tr></table></figure><p>è¿™å°†é™åˆ¶ GPU çš„ç”µæºåŠŸç‡ï¼Œä»åŠŸè€—ä¸Šå‡å°‘æ•£çƒ­ï¼Œä»¥è¾¾åˆ°æ§åˆ¶æ¸©åº¦çš„ç›®çš„ã€‚è¿™é‡Œçš„ 100 ä»£è¡¨ç›®æ ‡åŠŸç‡ï¼Œå¯ä»¥éšæ„è°ƒæ•´ï¼ŒåŠŸç‡æœ‰ç‰¹å®šèŒƒå›´ï¼Œä¾‹å¦‚ RTX 3090 çš„åŠŸç‡èŒƒå›´æ˜¯ 100W åˆ° 350Wã€‚å¦‚æœè¾“å…¥äº†ä¸åˆæ³•çš„åŠŸç‡å€¼ï¼Œä¼šæœ‰å‘½ä»¤è¡Œæç¤ºã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœå¤šå¡æœºå™¨ä¸­ä¸åŒ GPU çš„æ•£çƒ­æ¡ä»¶ä¸ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å•ç‹¬ä¿®æ”¹ä¸€å¼ å¡çš„åŠŸç‡ä¸Šé™ã€‚è¿™åœ¨ç‰¹å®šå¡æ•£çƒ­ä¸ä½³ä¸”ä»ç„¶å¸Œæœ›ä½¿ç”¨å¤šå¡è®­ç»ƒæ—¶å¾ˆæœ‰ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nvidia-smi -pl 100 -i 0<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œä¸€åŠ³æ°¸é€¸è§£å†³æ–¹å¼ï¼šèŠ±ç‚¹ w ä¹°æ–°æœºå™¨ã€‚</p><h2 id="GPU-çŠ¶æ€åŠè¿›ç¨‹ç›‘æ§"><a href="#GPU-çŠ¶æ€åŠè¿›ç¨‹ç›‘æ§" class="headerlink" title="GPU çŠ¶æ€åŠè¿›ç¨‹ç›‘æ§"></a>GPU çŠ¶æ€åŠè¿›ç¨‹ç›‘æ§</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>nvidia-smi</code> ç”¨äºæŸ¥çœ‹ GPU è¿è¡Œä¿¡æ¯ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ç¾è§‚ï¼Œè€Œä¸”ä¸èƒ½åŠ¨æ€æ›´æ–°å†…å®¹ï¼Œå¦‚æœæƒ³æŒç»­ç›‘æµ‹ GPU çŠ¶æ€ï¼Œéœ€è¦åå¤æ‰§è¡Œè¯¥å‘½ä»¤ã€‚å› æ­¤ï¼Œæˆ‘ç®€å•åˆ—ä¸¾ä¸¤ä¸ªå°å·¥å…·ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ›¿ä»£ <code>nvidia-smi</code> ã€‚ä»–ä»¬å‡åŸºäº Pythonï¼Œå› æ­¤æ¨èä½¿ç”¨ pipx å®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install pipx<br>pipx ensurepath<br>pipx install gpustat<br>pipx install nvitop<br></code></pre></td></tr></table></figure><p><a href="https://github.com/wookayin/gpustat">gpustat</a> æ˜¯ä¸€æ¬¾è½»é‡å‘½ä»¤è¡Œå·¥å…·ï¼Œå®šä½æ˜¯ <code>nvidia-smi</code> çš„æ›¿ä»£å“ã€‚åœ¨å‘½ä»¤è¡Œç›´æ¥è¿è¡Œ <code>gpustat</code> å³å¯è¾“å…¥ç®€æ´ç‰ˆçš„ GPU çŠ¶æ€ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>gpustat --watch</code> æ¥è‡ªåŠ¨ç›‘æµ‹ã€‚</p><p><a href="https://nvitop.readthedocs.io/en/latest/">nvitop</a> æ˜¯å¦ä¸€æ¬¾å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›ç±»ä¼¼äº htop çš„ç»ˆç«¯ UIï¼ŒåŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ã€‚åŒæ ·åœ°ï¼Œåœ¨å‘½ä»¤è¡Œå¯ä½¿ç”¨ <code>nvitop</code> å¯åŠ¨å®ƒçš„ UIã€‚å®ƒå¾ˆé€‚åˆåœ¨ä¸€æ®µæ—¶é—´èŒƒå›´å†…ç›‘æµ‹ GPU è¿è¡ŒçŠ¶æ€ã€‚</p><h2 id="å…¶ä»–æŠ€å·§"><a href="#å…¶ä»–æŠ€å·§" class="headerlink" title="å…¶ä»–æŠ€å·§"></a>å…¶ä»–æŠ€å·§</h2><p>å¦‚æœå¸Œæœ›å¤šå¡è¿›ç¨‹åªä½¿ç”¨ä¸€å¼ æˆ–å‡ å¼ å¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥è®©è¿›ç¨‹åªä½¿ç”¨ä½ æŒ‡å®šçš„ GPUã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> CUDA_VISIBLE_DEVICES=0,1<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ˜¾å¡å·å°±æ˜¯ <code>nvidia-smi</code> å‘½ä»¤æœ€å·¦ä¾§æ˜¾ç¤ºçš„ GPU IDï¼Œå¯ç”¨é€—å·åˆ†éš”å¤šä¸ªã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å…‰é€Ÿé…ç½®é«˜é¢œå€¼ç»ˆç«¯ï¼ˆWindows æœºï¼‰</title>
    <link href="/2024/04/08/beautiful%20terminal%20on%20windows/"/>
    <url>/2024/04/08/beautiful%20terminal%20on%20windows/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç®€å•è®°å½•ä¸€ä¸‹æˆ‘åœ¨æ–°çš„ Windows æœºå™¨ä¸Šé…ç½®é«˜é¢œå€¼ç»ˆç«¯çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯èƒ½ä¼šåœ¨å¤šå° PC ä¸Šåˆ‡æ¢å·¥ä½œï¼Œå¹¶å¸Œæœ›ä½¿ç”¨çš„å·¥å…·ä¿æŒä¸€è‡´ï¼Œè¿™å…¶ä¸­ â€œé…ç»ˆç«¯â€ å°±æ˜¯ä¸€ä¸ªå¾ˆå¯èƒ½ä¼š â€œæµªè´¹æ—¶é—´â€ çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬çš„ä¸»è¦åŸåˆ™åŒ…æ‹¬ï¼š</p><ul><li>ä½¿ç”¨ä¸»æµæ–¹æ¡ˆå’Œå·¥å…·ï¼Œå‡å°‘é—®é¢˜å‡ºç°æ¦‚ç‡</li><li>å‘½ä»¤è¡Œä¼˜å…ˆï¼ŒåŠ å¿«æ•ˆç‡</li><li>å°½å¯èƒ½ç¾è§‚ã€å¯è¯»æ€§ä½³ï¼ŒåŒæ—¶ä¸è¦æŠ˜è…¾</li></ul><p><img src="/attachments/terminal-demo.png"></p><p>ä½¿ç”¨åˆ°çš„è½¯ä»¶ï¼š</p><ul><li>åŒ…å®‰è£… &amp; ç®¡ç†: <a href="https://github.com/ScoopInstaller/Scoop">Scoop</a></li><li>ç»ˆç«¯æ¨¡æ‹Ÿå™¨ (terminal emulator): <a href="https://github.com/microsoft/terminal">Windows Terminal</a></li><li>ç»ˆç«¯å­—ä½“: <a href="https://www.nerdfonts.com/font-downloads">Cascadia Code Nerd Font</a></li><li>Shell prompt: <a href="https://github.com/starship/starship">Starship.rs</a></li></ul><p>æ¥ä¸‹æ¥æˆ‘å°†ä¸€ä¸€ä»‹ç»ï¼Œå¹¶åœ¨æ–‡ä¸­é™„ä¸Šå¿«é€Ÿä¸Šæ‰‹çš„å‘½ä»¤ã€‚</p><p>æ³¨ï¼šæœ¬æ–‡<strong>ä¸æ¶‰åŠ Shell é…ç½®</strong>ï¼Œè¿™äº›ç»ˆç«¯é…ç½®å¯é€‚ç”¨äºä»»æ„ Shell (Powershell, Bash, Zsh, â€¦)ã€‚</p><h2 id="åŒ…ç®¡ç†å·¥å…·"><a href="#åŒ…ç®¡ç†å·¥å…·" class="headerlink" title="åŒ…ç®¡ç†å·¥å…·"></a>åŒ…ç®¡ç†å·¥å…·</h2><p>æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨ Scoopï¼Ÿ</p><ul><li>GUI å®‰è£…æ–¹å¼<strong>å¤ªè ¢äº†</strong>ï¼šç‚¹æµè§ˆå™¨ï¼Œæœç´¢å¼•æ“ï¼Œæ‰¾åˆ°ä¸‹è½½é“¾æ¥ï¼Œç‚¹å®‰è£…ç¨‹åºï¼Œç‚¹ç‚¹ç‚¹â€¦â€¦</li><li>Scoop æ˜¯çº¯å‘½ä»¤è¡Œæ“ä½œï¼Œè€Œä¸”ç›´è§‚æ˜“æ‡‚ï¼Œæ²¡æœ‰è®°å¿†è´Ÿæ‹…</li><li>Scoop èƒ½è‡ªåŠ¨ç®¡ç†å„ç±»è½¯ä»¶çš„<strong>å®‰è£…</strong>ã€<strong>æ›´æ–°</strong>å’Œ<strong>å¸è½½</strong></li><li>Scoop åœ¨å®¶ç›®å½•ä¸‹å®‰è£…æ‰€æœ‰è½¯ä»¶ï¼Œå¹¶ä¸”å…ç®¡ç†å‘˜æƒé™</li><li>ä¸ä¼šå¾€ PATH é‡Œå¡ä¸€å¤§å †ä¸œè¥¿</li><li>å…¨å¼€æº</li></ul><p>Scoop çš„ç¼ºç‚¹ï¼š</p><ul><li>å¯¹æŸäº›é—­æº GUI åº”ç”¨çš„æ”¯æŒæœ‰é™ï¼Œå¹¶ä¸ä¸‡èƒ½</li><li>å¯¹ç½‘ç»œç¯å¢ƒè¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦è®¿é—® GitHub æ‰èƒ½æµç•…ä½¿ç”¨</li></ul><p><strong>å¿«é€Ÿå®‰è£…</strong> ï¼ˆä½¿ç”¨ Powershellï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Set-ExecutionPolicy</span> <span class="hljs-literal">-ExecutionPolicy</span> RemoteSigned <span class="hljs-literal">-Scope</span> CurrentUser<br><span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> https://get.scoop.sh | <span class="hljs-built_in">Invoke-Expression</span><br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å®‰è£…è¯·å‚é˜… <a href="https://github.com/ScoopInstaller/Install?tab=readme-ov-file#advanced-installation">è¯¥æ–‡æ¡£</a>.</p><p>æ¨èä½¿ç”¨æ–¹å¼ï¼š</p><ol><li>æ‹¿åˆ° scoop ç¬¬ä¸€ä»¶äº‹æ˜¯å®‰è£… git: <code>scoop install git</code>ï¼Œå‘Šåˆ« git bash</li><li>æ·»åŠ è½¯ä»¶ä»“åº“ (buckets)ï¼Œä¾‹å¦‚ <code>scoop bucket add extras</code>ï¼Œè¯¥å®˜æ–¹ä»“åº“æ”¶å½•äº†è®¸å¤šéå‘½ä»¤è¡Œè½¯ä»¶</li><li>å®‰è£…ä¸‹è½½å·¥å…· <code>scoop install aria2</code></li><li>ä»“åº“æ›´æ–°å’Œä¸‹è½½é—®é¢˜ï¼Œè£¸å¥”éå¸¸å®¹æ˜“å¡æ­»ï¼Œå¼€ä»£ç†ä¸€èˆ¬å¯ä»¥è§£å†³</li><li>å…¶ä»–æ¨èå®‰è£…ï¼š<code>7zip aria2 openssh python</code></li></ol><p>æœ¬æ–‡ä»¥ä¸‹æ‰€æœ‰å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨ <code>scoop install</code> ç›´æ¥å®‰è£…ã€‚</p><h2 id="ç»ˆç«¯æ¨¡æ‹Ÿå™¨"><a href="#ç»ˆç«¯æ¨¡æ‹Ÿå™¨" class="headerlink" title="ç»ˆç«¯æ¨¡æ‹Ÿå™¨"></a>ç»ˆç«¯æ¨¡æ‹Ÿå™¨</h2><p>æˆ‘ä½¿ç”¨ Windows Terminalã€‚å†ç»äº”å¹´æ‰“ç£¨ï¼Œå¾®è½¯çš„æ–°ä¸€ä»£ç»ˆç«¯å·¥å…·å·²ç»åœ¨ GitHub ç‹‚æ½è¿‘åä¸‡æ˜Ÿã€‚å¯¹äº Windows æœºå™¨ï¼Œæˆ‘çœŸçš„æƒ³ä¸å‡ºä»€ä¹ˆç†ç”±èƒ½è®©å…¶ä»–ç»ˆç«¯å·¥å…·å®Œç¾æ›¿ä»£ Windows Terminalã€‚è‹¥æœ‰ Linux &#x2F; è·¨å¹³å°éœ€æ±‚å¦è¯´ã€‚</p><p><strong>å¿«é€Ÿå®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">scoop bucket add extras<br>scoop install windows-terminal<br></code></pre></td></tr></table></figure><h2 id="ç»ˆç«¯å­—ä½“"><a href="#ç»ˆç«¯å­—ä½“" class="headerlink" title="ç»ˆç«¯å­—ä½“"></a>ç»ˆç«¯å­—ä½“</h2><p>æˆ‘ä½¿ç”¨ Cascadia Code åœ¨ Nerd Fonts ä¸­çš„ç‰ˆæœ¬ã€‚å¯å‰å¾€ <a href="https://www.nerdfonts.com/font-downloads">Nerd Fonts</a> é€‰æ‹©å…¶ä»–å­—ä½“ã€‚</p><p>ä¸ºä»€ä¹ˆä½¿ç”¨ Nerd Fontsï¼Ÿå› ä¸ºæä¾›äº†æ›´å¤šçš„å›¾æ ‡å’Œå­—å½¢ï¼Œåœ¨ç»ˆç«¯ä¸­æœ‰æ›´ä¸°å¯Œçš„è§†è§‰ä½“éªŒã€‚</p><p><strong>å¿«é€Ÿå®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">scoop bucket add nerd-fonts<br>scoop install CascadiaCode-NF-Mono<br></code></pre></td></tr></table></figure><p>åœ¨ Windows Terminal ä¸­ä¿®æ”¹é…ç½® (è®¾ç½® â†’ é…ç½®æ–‡ä»¶ â†’ é»˜è®¤å€¼ â†’ å¤–è§‚)ï¼Œå³å¯æ›´æ¢ç»ˆç«¯å­—ä½“</p><h2 id="Shell-Prompt"><a href="#Shell-Prompt" class="headerlink" title="Shell Prompt"></a>Shell Prompt</h2><p>Starship æ˜¯ä¸€æ¬¾è½»é‡ã€è¿…é€Ÿã€å®¢åˆ¶åŒ–çš„ cross-shell promptã€‚</p><p>Shell prompt æŒ‡çš„æ˜¯ CLI ç¯å¢ƒä¸­æ˜¾ç¤ºçš„æç¤ºä¿¡æ¯ï¼Œæ¯”å¦‚ Linux ä¸­ç»å…¸çš„ shï¼Œå®ƒåªä¼šæ˜¾ç¤ºä¸€ä¸ª <code>$</code> ç¬¦å·ï¼Œæä¾›çš„ä¿¡æ¯éå¸¸æœ‰é™ã€‚è¯¸å¦‚ Bashï¼ŒPowershell ç­‰ç°ä»£ Shell åˆ™é€šå¸¸ä¼šæ˜¾ç¤ºå½“å‰æ‰€åœ¨çš„è·¯å¾„ï¼Œè¿™æ ·å°±çœå»äº†é¢‘ç¹çš„ <code>pwd</code> æ“ä½œã€‚Starship ä½œä¸ºä¸€æ¬¾ prompt å·¥å…·ï¼Œå®ƒå¯ä»¥æä¾›å…³äºå½“å‰ç¯å¢ƒçš„ä¸°å¯Œä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šå‘½ä»¤æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œå‘½ä»¤æ‰§è¡Œæ—¶é•¿ï¼Œgit ä»“åº“ä¿¡æ¯ï¼Œå¼€å‘ç¯å¢ƒç‰ˆæœ¬ç­‰ç­‰ã€‚æ­¤å¤–ï¼Œstarship è¿˜æ˜¯ â€œcross-shellâ€ çš„ï¼Œå®ƒæ”¯æŒå‡ ä¹æ‰€æœ‰ shellï¼Œæä¾›äº†ç»Ÿä¸€çš„ç»ˆç«¯ä½“éªŒã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>æå‡å¯è¯»æ€§</li><li>èŠ‚çœéƒ¨åˆ†æ“ä½œ</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä¼šè‡ªè¡Œæ‰§è¡ŒæŸ¥çœ‹å½“å‰ç¯å¢ƒä¿¡æ¯ï¼Œå¯èƒ½ä¼šæ‹–æ…¢é€Ÿåº¦ï¼ˆè¯¥å·¥å…·ä½¿ç”¨ Rust å¼€å‘ï¼Œå¯ä»¥è¯´åœ¨æ€§èƒ½æ–¹é¢å·²ç»å¾ˆå°½åŠ›äº†ï¼‰</li></ul><p><strong>å¿«é€Ÿå®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">scoop install starship<br></code></pre></td></tr></table></figure><ul><li>Shell åˆå§‹åŒ–è¯·æŸ¥é˜… <a href="https://starship.rs/guide/#step-2-set-up-your-shell-to-use-starship">å®˜æ–¹æ–‡æ¡£</a></li><li>é…ç½®æ–‡ä»¶é»˜è®¤ä½äº <code>~/.config/starship.toml</code>ï¼Œé…ç½®è¯·æŸ¥é˜… <a href="https://starship.rs/zh-CN/config/">å®˜æ–¹æ–‡æ¡£</a></li></ul><h2 id="è¿œç¨‹ä¸»æœº-SSH-é…ç½®"><a href="#è¿œç¨‹ä¸»æœº-SSH-é…ç½®" class="headerlink" title="è¿œç¨‹ä¸»æœº SSH é…ç½®"></a>è¿œç¨‹ä¸»æœº SSH é…ç½®</h2><p>æœ‰äº† Windows Terminalï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦é¢å¤–çš„ SSH å®¢æˆ·ç«¯ç¨‹åºäº†ã€‚é…ç½®æ–°çš„ SSH è¿æ¥éå¸¸æ–¹ä¾¿ï¼š</p><ol><li>ç¡®è®¤ OpenSSH å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰å°±ç›´æ¥ <code>scoop install openssh</code></li><li>ç¡®è®¤å¯†é’¥å¯¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨å‘½ä»¤ <code>ssh-keygen -t ed25519 -C &quot;your_email@example.com&quot;</code> ç”Ÿæˆæ–°çš„</li><li>å°†å…¬é’¥ (æ–‡ä»¶ä»¥ <code>.pub</code> ç»“å°¾) ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœºï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>ssh-copy-id -i ~/.ssh/id_ed25519.pub user@123.1.2.3</code></li><li>ä¿®æ”¹æ–‡ä»¶ <code>~/.ssh/config</code> æ·»åŠ æ–°ä¸»æœºä¿¡æ¯</li><li>æ‰“å¼€ Windows Terminal æ·»åŠ æ–°çš„ profileï¼Œå¤åˆ¶åŸ PowerShell é…ç½®åå°† â€œå‘½ä»¤è¡Œâ€ æ”¹ä¸º</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">%SystemRoot%\System32\WindowsPowerShell\v1.<span class="hljs-number">0</span>\powershell.exe <span class="hljs-literal">-Command</span> <span class="hljs-string">&quot;ssh serverxyz&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>hostname</code> å°±æ˜¯ä½ åœ¨ config é‡Œå¡«å…¥çš„ä¸»æœºåç§°ã€‚é…ç½®æ–‡ä»¶å¯ä»¥å‚è€ƒè¿™ä¸ªæ¨¡ç‰ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs test">Host serverxyz<br>  HostName 123.45.67.89<br>  User user<br>  Port 22<br>  IdentityFile ~/.ssh/id_ed25519<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šæ­¥éª¤å®Œæˆåï¼Œå°±å¯ä»¥åœ¨ Windows Terminal ä¸­ä¸€é”®è¿æ¥è¿œç¨‹ä¸»æœºäº†ã€‚</p><p>å¦‚æœä¸æƒ³æ¯æ¬¡ç™»å½•éƒ½æ‰‹åŠ¨è¾“å…¥ passphraseï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p><p>é¦–å…ˆç¡®è®¤ ssh-agent å¼€å¯ï¼š&#96;</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Get-Service</span> ssh<span class="hljs-literal">-agent</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> ssh<span class="hljs-literal">-agent</span> | <span class="hljs-built_in">Set-Service</span> <span class="hljs-literal">-StartupType</span> Automatic<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå‘½ä»¤å°†ç§é’¥äº¤ç»™å®ƒæ‰˜ç®¡ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ssh<span class="hljs-literal">-add</span> ~\.ssh\id_ed25519<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>terminal</tag>
      
      <tag>windows</tag>
      
      <tag>scoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆè¯† Kotlin å‡½æ•°å¼ç¼–ç¨‹</title>
    <link href="/2024/03/24/intro%20to%20kotlin%20functional%20programming/"/>
    <url>/2024/03/24/intro%20to%20kotlin%20functional%20programming/</url>
    
    <content type="html"><![CDATA[<p>Kotlin æ˜¯ä¸€é—¨ä¸ Java å…¼å®¹ã€å¯åœ¨ JVM ä¸Šè¿è¡Œçš„ç¼–ç¨‹è¯­è¨€ï¼Œè™½ç„¶ Kotlin æ•´ä½“é£æ ¼æ˜¯ç±»ä¼¼ä¸ Java çš„é¢å‘å¯¹è±¡ï¼Œä½†å®ƒå¯¹å‡½æ•°å¼ç¼–ç¨‹æœ‰éå¸¸å¥½çš„æ”¯æŒã€‚æœ¬æ–‡åˆ†äº«ä¸€äº›ä¸å‡½æ•°å¼ç¼–ç¨‹ç›¸å…³çš„ Kotlin åŸºç¡€çŸ¥è¯†ã€‚å¤§éƒ¨åˆ†å†…å®¹å‡æ¥è‡ª Kotlin å®˜æ–¹æ–‡æ¡£ã€‚</p><h3 id="Lambda-è¡¨è¾¾å¼ä¸åŒ¿åå‡½æ•°"><a href="#Lambda-è¡¨è¾¾å¼ä¸åŒ¿åå‡½æ•°" class="headerlink" title="Lambda è¡¨è¾¾å¼ä¸åŒ¿åå‡½æ•°"></a>Lambda è¡¨è¾¾å¼ä¸åŒ¿åå‡½æ•°</h3><p>åœ¨ Kotlin ä¸­ï¼Œ lambda è¡¨è¾¾å¼çš„è¯­æ³•éå¸¸ç®€æ´ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥å¾ˆå¤šå†—ä½™ä¿¡æ¯ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œè¯¥ lambda è¡¨è¾¾å¼æ¥å—ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›äºŒè€…çš„å’Œã€‚åœ¨è¿™è¡Œä»£ç ä¸­ï¼Œ<code>sum</code> çš„ç±»å‹æ³¨è§£æ˜¯ä¸å¿…è¦çš„ï¼ŒKotlin èƒ½å¤Ÿæ¨æ–­å‡º lambda è¡¨è¾¾å¼çš„è¿”å›ç±»å‹æ˜¯ <code>Int</code>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sum: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = &#123; x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span> -&gt; x + y &#125;<br><span class="hljs-comment">// val sum = &#123;x: Int, y: Int -&gt; x + y&#125; åŒæ ·æ­£ç¡®</span><br><span class="hljs-comment">// println(sum(1, 2)) // 3</span><br></code></pre></td></tr></table></figure><p>Lmabda è¡¨è¾¾å¼å¸¸å¸¸ç”¨ä½œå‚æ•°ï¼Œä¼ é€’ç»™é«˜é˜¶å‡½æ•°ä½¿ç”¨ã€‚å½“ä¸€ä¸ª lambda è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°å®å‚æ—¶ï¼Œå¯ä»¥çœç•¥æ‹¬å·ï¼Œå°†èŠ±æ‹¬å·å†™åœ¨å¤–é¢ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>any()</code> æ¥åˆ¤æ–­ä¸€ç»„æ•´æ•°é‡Œæ˜¯å¦åŒ…å«å¶æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsEven</span><span class="hljs-params">(collection: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> =  <br>        collection.any &#123; num: <span class="hljs-built_in">Int</span> -&gt; (num % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span> &#125;<br></code></pre></td></tr></table></figure><p>è‹¥ lambda è¡¨è¾¾å¼<strong>ä»…æœ‰ä¸€ä¸ªå‚æ•°</strong>ï¼Œé‚£ä¹ˆå‰é¢çš„ <code>-&gt;</code> å¯ä»¥çœç•¥ï¼Œå¹¶ä¸” <code>it</code> å°†æŒ‡ä»£é‚£ä¸ªå‚æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsEven</span><span class="hljs-params">(collection: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> =  <br>        collection.any &#123; (it % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span> &#125;<br></code></pre></td></tr></table></figure><p><strong>åŒ¿åå‡½æ•°</strong>ä¸ lambda è¡¨è¾¾å¼ç±»ä¼¼ï¼Œéƒ½ç”¨æ¥å®šä¹‰ function literalsã€‚äºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äºåŒ¿åå‡½æ•°èƒ½å¤Ÿæ˜¾å¼åœ°æŒ‡å®šè¿”å›ç±»å‹ï¼Œè€Œ lambda è¡¨è¾¾å¼åˆ™ä¸èƒ½ã€‚lambda è¡¨è¾¾å¼çš„è¿”å›ç±»å‹åªèƒ½ä¾é ç¼–è¯‘å™¨æ¨æ–­ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä»ç„¶æ˜¯ <code>containsEven()</code> å‡½æ•°ï¼Œä½¿ç”¨äº†åŒ¿åå‡½æ•°è¯­æ³•ï¼Œä¸è¿‡è¿™é‡Œçš„ <code>Boolean</code> æ³¨è§£ä»ç„¶æ˜¯å¯ä»¥çœç•¥çš„ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsEven</span><span class="hljs-params">(collection: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>    <span class="hljs-keyword">val</span> isEven = <span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(num: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Boolean</span> = (num % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> collection.any(isEven)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‡½æ•°ä½œç”¨åŸŸ"><a href="#å‡½æ•°ä½œç”¨åŸŸ" class="headerlink" title="å‡½æ•°ä½œç”¨åŸŸ"></a>å‡½æ•°ä½œç”¨åŸŸ</h3><p>è®¸å¤šä¼ ç»Ÿ OOP è¯­è¨€è¦æ±‚å‡½æ•°å¿…é¡»åœ¨ç±»å†…å®šä¹‰ï¼Œè€Œ Kotlin åˆ™æ”¯æŒå¤šç§å‡½æ•°å®šä¹‰ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>Top level function: ç›´æ¥åœ¨æ–‡ä»¶å®šä¹‰ï¼Œä¸ä¾é™„äºç±»</li><li>Local function: åœ¨å‡½æ•°å†…å®šä¹‰</li><li>Member function: åœ¨ç±»æˆ–åŒ¿åç±»ä¸­å®šä¹‰</li><li>Extension function &amp; function with receiver: åœ¨ç±»å¤–å®šä¹‰çš„å‡½æ•°ï¼Œå¯ä»¥åƒä½¿ç”¨æˆå‘˜å‡½æ•°ä¸€æ ·è°ƒç”¨</li></ul><p>Local function å°±æ˜¯å‡½æ•°é‡Œçš„å‡½æ•°ã€‚è¿™æ ·çš„å‡½æ•°èƒ½å¤Ÿè®¿é—®å¤–å±‚å‡½æ•°çš„æ‰€æœ‰å±€éƒ¨å˜é‡ã€‚å¦‚æœå°†è¯¥å‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼Œé‚£ä¹ˆå°†å½¢æˆé—­åŒ… (closure)ã€‚è¿™ä¸€ç‰¹æ€§ä¹Ÿé€‚ç”¨äº lambda è¡¨è¾¾å¼å’ŒåŒ¿åå‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> ints = listOf(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, -<span class="hljs-number">1</span>)<br><span class="hljs-keyword">var</span> sum = <span class="hljs-number">0</span><br>ints.filter &#123; it &gt; <span class="hljs-number">0</span> &#125;.forEach &#123; sum += it &#125;<br>print(sum) <span class="hljs-comment">// 5</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åˆ—è¡¨é‡Œæ‰€æœ‰æ­£æ•°æ±‚å’Œã€‚è¿™é‡Œçš„ lambda è¡¨è¾¾å¼ <code>&#123; sum += it &#125;</code> ä½œä¸ºå‚æ•°ä¼ ç»™äº† <code>forEach</code> æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿè®¿é—®å¤–éƒ¨å‡½æ•° <code>foo()</code> çš„ local variableï¼Œå¾—åˆ°æ­£ç¡®çš„æ­£æ•°å’Œã€‚</p><p>å¦ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­æ¥è‡ª Kotlin å®˜æ–¹æ–‡æ¡£ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dfs</span><span class="hljs-params">(graph: <span class="hljs-type">Graph</span>)</span></span> &#123; <br><span class="hljs-keyword">val</span> visited = HashSet&lt;Vertex&gt;() <br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dfs</span><span class="hljs-params">(current: <span class="hljs-type">Vertex</span>)</span></span> &#123; <br><span class="hljs-keyword">if</span> (!visited.add(current)) <span class="hljs-keyword">return</span> <br><span class="hljs-keyword">for</span> (v <span class="hljs-keyword">in</span> current.neighbors)<br>dfs(v) <br>&#125; <br>dfs(graph.vertices[<span class="hljs-number">0</span>]) <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œå†…éƒ¨çš„ <code>dfs()</code> æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œèƒ½å¤Ÿè®¿é—®å¤–éƒ¨å‡½æ•°çš„å‚æ•° <code>graph</code>ï¼Œå¹¶ä¸”å¯ä»¥å¯¹é›†åˆ <code>visited</code> è¿›è¡Œä¿®æ”¹ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œ<strong>Kotlin ä¸­çš„å†…å±‚å‡½æ•°å¯ä»¥è®¿é—®åˆ°å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå¹¶ä¸”å¯ä»¥è·¨è¶Šå¤šå±‚åµŒå¥—è®¿é—®ã€‚</strong></p><h3 id="å‡½æ•°çš„è¿”å›"><a href="#å‡½æ•°çš„è¿”å›" class="headerlink" title="å‡½æ•°çš„è¿”å›"></a>å‡½æ•°çš„è¿”å›</h3><p>Kotlin ä½¿ç”¨ <code>return</code> è¯­å¥æ¥ä»å‡½æ•°è¿”å›ã€‚è¿”å›å€¼å¯ä»¥ç•™ç©ºï¼Œç©ºçš„è¿”å›å€¼å…·æœ‰ç±»å‹ <code>Unit</code>ã€‚åœ¨åµŒå¥—åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ <code>return</code> è¯­å¥çš„ä½œç”¨æ˜¯ â€œreturns from the nearest enclosing function orÂ anonymous functionâ€. ç®€è€Œè¨€ä¹‹ï¼Œå®ƒä¼šä»ç¦»å®ƒæœ€è¿‘çš„ä½¿ç”¨ <code>fun</code> å®šä¹‰çš„å‡½æ•°è¿”å›ã€‚</p><p>å¯¹äº lambda è¡¨è¾¾å¼è€Œè¨€ï¼Œæƒ…å†µåˆ™ç¨æœ‰ä¸åŒã€‚Kotlin ç¼–è¯‘å™¨ä¼šå°è¯•æ¨æ–­ lambda è¡¨è¾¾å¼çš„å‡½æ•°ä½“æ˜¯å¦ä¸è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯è¿”å›å€¼ç±»å‹ä¸º <code>Unit</code>ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå‡½æ•°ä½“ä¸­çš„æœ€åä¸€ä¸ªè¡¨è¾¾å¼ä¼šè¢«è‡ªåŠ¨è¿”å›ã€‚è¯·çœ‹ä¸‹é¢è¿™ä¸¤ä¸ª lambda è¡¨è¾¾å¼ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> func1: () -&gt; <span class="hljs-built_in">Unit</span> = &#123;<br>        println(<span class="hljs-string">&quot;This function returns nothing?&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">val</span> func2: () -&gt; <span class="hljs-built_in">Int</span> = &#123;<br>        println(<span class="hljs-string">&quot;This function return 3&quot;</span>)<br>        <span class="hljs-number">1</span> + <span class="hljs-number">2</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ï¼Œ<code>func1</code> å’Œ <code>func2</code> éƒ½ä¸æ¥å—å‚æ•°ï¼Œ<code>func1</code> ä¸è¿”å›å€¼ï¼Œè€Œ <code>func2</code> å°†è¿”å›æ•´æ•°ã€‚</p><p>ç»§ç»­ä½¿ç”¨ä¾‹å­ <code>containsEven()</code>ï¼Œæˆ‘ä»¬åœ¨ <code>.any()</code> ä¸­çš„ lambda è¡¨è¾¾å¼æ·»åŠ ä¸€è¡Œæ‰“å°è¯­å¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsEven</span><span class="hljs-params">(collection: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> =  <br>        collection.any &#123; num -&gt;<br>            <span class="hljs-keyword">val</span> condition = ((num % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>)<br>            println(<span class="hljs-string">&quot;Number <span class="hljs-variable">$num</span> : <span class="hljs-variable">$condition</span>&quot;</span>)<br>            condition<br>        &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œlambda è¡¨è¾¾å¼çš„æœ€åä¸€è¡Œ <code>condition</code> ä¼šè¢«è¿”å›ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œä½ ä¸èƒ½ç”¨ <code>return condition</code> ä» lambda è¡¨è¾¾å¼è¿”å›ã€‚å› ä¸ºï¼Œåœ¨ lambda è¡¨è¾¾å¼é‡Œä½¿ç”¨ <code>return</code> ä¼šè·³å‡º <code>containsEven()</code> å‡½æ•°ï¼Œè¿™ä¸é¢„æœŸçš„åŠŸèƒ½ä¸ç¬¦ï¼Œè™½ç„¶ä¸ä¼šå¼•èµ·ç¼–è¯‘æŠ¥é”™ã€‚</p><p>ä¸ lambda è¡¨è¾¾å¼ä¸åŒçš„æ˜¯ï¼ŒåŒ¿åå‡½æ•°å¯ä»¥æ­£å¸¸ä½¿ç”¨ <code>return</code> è¯­å¥ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsEven</span><span class="hljs-params">(collection: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>    <span class="hljs-keyword">val</span> isEven = <span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(num: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        println(num)<br>        <span class="hljs-keyword">return</span> (num % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> collection.any(isEven)<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›ä» lambda è¡¨è¾¾å¼<strong>æ˜¾å¼è¿”å›</strong>ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹æ®Šçš„è¯­æ³• â€œreturn to labelsâ€ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ lambda è¡¨è¾¾å¼çš„ä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsEven</span><span class="hljs-params">(collection: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> =  <br>    collection.any &#123; num -&gt;  <br>        <span class="hljs-keyword">val</span> condition = ((num % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>)  <br>        println(<span class="hljs-string">&quot;Number <span class="hljs-variable">$num</span> : <span class="hljs-variable">$condition</span>&quot;</span>)  <br>        <span class="hljs-keyword">return</span><span class="hljs-symbol">@any</span> condition  <br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h3><p><strong>é«˜é˜¶å‡½æ•°</strong> (high-order functions) æ˜¯å°†å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–å°†å‡½æ•°ä½œä¸ºè¿”å›å€¼çš„å‡½æ•°ã€‚</p><p>Kotlin æ ‡å‡†åº“æä¾›äº†ä¼—å¤šé«˜é˜¶å‡½æ•°ï¼Œå®ƒä»¬èƒ½ç®€åŒ–ä»£ç ï¼Œæå‡å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¯è¿­ä»£çš„å®¹å™¨ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå¯¹è±¡ï¼Œä½ å¸Œæœ›æ ¹æ®ä¸€ç³»åˆ—é€»è¾‘ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ã€‚ä½ å¯èƒ½ä¼šå†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> results = ArrayList&lt;Item&gt;()  <br><span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> items) &#123;  <br>    <span class="hljs-keyword">val</span> condition: <span class="hljs-built_in">Boolean</span><br>    <span class="hljs-comment">// è¿›è¡Œä¸€äº›æ“ä½œæ¥æ£€æŸ¥æ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> (condition) results.add(item)  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ ‡å‡†åº“é‡Œçš„ <code>filter</code> å‡½æ•°å¯ä»¥ç®€åŒ–è¿™æ ·çš„ä»£ç ã€‚<code>filter</code> å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼ŒåªåŒ…å«åˆ¤æ–­ä¸º true çš„å‡½æ•°ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> results = items.filter &#123;<br><span class="hljs-comment">// ä½¿ç”¨ it è¿›è¡Œä¸€äº›æ“ä½œæ¥æ£€æŸ¥æ¡ä»¶</span><br>condition<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œè¦ä½¿ç”¨ <code>filter</code> å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·å¿«é€Ÿåˆ›å»ºä¸€ä¸ª lambda è¡¨è¾¾å¼ã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œ<code>it</code> å°†æŒ‡ä»£ lambda è¡¨è¾¾å¼çš„å”¯ä¸€å‚æ•°ï¼Œå¹¶ä¸”æœ€åä¸€è¡Œå°†ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒKotlin è¿˜æœ‰è®¸å¤šé«˜é˜¶å‡½æ•°ï¼ŒåŒ…æ‹¬ <code>map</code>, <code>filter</code>, <code>reduce</code>, <code>fold</code>, <code>forEach</code>, <code>sortedBy</code> ç­‰ç­‰ã€‚é…åˆç®€æ´çš„ lambda è¡¨è¾¾å¼è¯­æ³•ï¼Œå®ƒä»¬èƒ½å¤Ÿç®€åŒ–å„ç±»å¯¹å¯è¿­ä»£å¯¹è±¡çš„æ“ä½œã€‚</p><h3 id="ä½œç”¨åŸŸå‡½æ•°"><a href="#ä½œç”¨åŸŸå‡½æ•°" class="headerlink" title="ä½œç”¨åŸŸå‡½æ•°"></a>ä½œç”¨åŸŸå‡½æ•°</h3><p>ä½œç”¨åŸŸå‡½æ•° (scope functions) æ˜¯ Kotlin æä¾›çš„ä¸€ç»„ç‰¹æ®Šçš„é«˜é˜¶å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨ä»»æ„å¯¹è±¡ä¸Šè°ƒç”¨ä½œç”¨åŸŸå‡½æ•°ï¼Œå°±åƒè°ƒç”¨æˆå‘˜å‡½æ•°ä¸€æ ·ã€‚</p><blockquote><p>Kotlin æ ‡å‡†åº“æä¾›äº†ä¸€äº›å‡½æ•°ï¼Œå®ƒä»¬ç”¨æ¥å›´ç»•ä¸€ä¸ªå¯¹è±¡æ‰§è¡Œä¸€æ®µä»£ç å—ã€‚å½“ä½ åœ¨å¯¹è±¡ä¸Šè°ƒç”¨è¿™æ ·çš„å‡½æ•°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª lambda è¡¨è¾¾å¼æ—¶ï¼Œå®ƒå½¢æˆä¸€ä¸ªä¸´æ—¶ä½œç”¨åŸŸã€‚åœ¨æ­¤ä½œç”¨åŸŸä¸­ï¼Œä½ å¯ä»¥åœ¨ä¸ä½¿ç”¨å¯¹è±¡åç§°çš„æƒ…å†µä¸‹è®¿é—®è¯¥å¯¹è±¡ã€‚æ­¤ç±»å‡½æ•°ç§°ä¸ºä½œç”¨åŸŸå‡½æ•° (scope functions)ã€‚å…±æœ‰äº”ä¸ªä½œç”¨åŸŸå‡½æ•°ï¼šletã€runã€withã€apply å’Œ alsoã€‚</p></blockquote><p>ä¸Šé¢è¿™æ®µè¯æ˜¯ Kotlin å®˜æ–¹å¯¹ scope function çš„ä»‹ç»ï¼ˆä»è‹±æ–‡ç¿»è¯‘ï¼‰ï¼Œæ˜¯ä¸æ˜¯å¾ˆè¿·ç³Šï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¯¥ä¾‹å­ä½¿ç”¨ <code>StringBuilder</code> æ¥æ ¹æ®ä¸€äº›æ•°æ®åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> builder = StringBuilder()<br>    <span class="hljs-comment">// ä» 1 åˆ° 10 çš„å­—ç¬¦ä¸²</span><br>    builder.append(<span class="hljs-string">&quot;Numbers: &quot;</span>)<br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) &#123;<br>        builder.append(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">val</span> resultString = builder.toString()<br>    println(resultString)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª <code>for</code> å¾ªç¯å¯èƒ½ä»£è¡¨å®é™…ä»£ç é‡Œçš„æ•°æ®å¤„ç†ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå±€éƒ¨å˜é‡åç§° <code>builder</code> è¢«é‡å¤äº†å¾ˆå¤šæ¬¡ï¼Œè¿™å¾ˆç¹çä¸”ä¸ç¾è§‚ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹æ¥æ”¹è¿›è¿™æ®µä»£ç çš„å®ç°ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    StringBuilder().apply &#123;<br>        append(<span class="hljs-string">&quot;Numbers: &quot;</span>)<br>        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) &#123; <br>            append(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>) <br>        &#125; <br>    &#125;.toString().let &#123;<br>        println(it)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¿™ä¸ª <code>StringBuilder</code> å¯¹è±¡ä¸Šè°ƒç”¨äº†ä½œç”¨åŸŸå‡½æ•° <code>apply</code>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª lambda è¡¨è¾¾å¼ã€‚åœ¨ lambda è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>this</code> æ¥æŒ‡ä»£åŸå¯¹è±¡ï¼Œæ›´å¯ä»¥çœç•¥ <code>this</code>ã€‚æˆ‘ä»¬åœ¨ç»“æœå­—ç¬¦ä¸²ä¸Šç»§ç»­è°ƒç”¨ä½œç”¨åŸŸå‡½æ•° <code>let</code>ï¼Œå¹¶åœ¨éšåçš„ lambda è¡¨è¾¾å¼ä¸­ç”¨å‚æ•° <code>it</code> æŒ‡ä»£å­—ç¬¦ä¸²å¯¹è±¡ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±é¿å…äº†å±€éƒ¨å˜é‡ <code>builder</code> å’Œ <code>resultString</code>ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€‚</p><p>ä½œç”¨åŸŸå‡½æ•°çš„å®ç°æ–¹å¼ä¹Ÿéå¸¸ç®€å•ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå‡½æ•°å°±å®ç°äº†ç±»ä¼¼äºæ ‡å‡†åº“ <code>apply()</code> çš„åŠŸèƒ½ã€‚å®ƒç”¨åˆ°äº† generic function å’Œ function with receiver è¯­æ³•ï¼Œè¿™æ ·å…è®¸æˆ‘ä»¬åœ¨ä»»ä½•å¯¹è±¡ä¸Šè°ƒç”¨å®ƒã€‚å®ƒæ¥å—çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª function with receiverï¼Œè¿™æ ·å°±å…è®¸æˆ‘ä»¬åœ¨ lambda è¡¨è¾¾å¼é‡Œä½¿ç”¨ <code>this</code> æ¥æŒ‡ä»£åŸå¯¹è±¡ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//                 è¿™é‡Œæ˜¯è¾“å…¥å‡½æ•°çš„ç±»å‹</span><br><span class="hljs-comment">//                   â†“ â†“ â†“ â†“ â†“ â†“</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">myApply</span><span class="hljs-params">(f: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T &#123;<br>    <span class="hljs-keyword">this</span>.f()<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ä¸ºç›¸åƒçš„å››ä¸ªä½œç”¨åŸŸå‡½æ•°æ˜¯ <code>let</code>, <code>run</code>, <code>apply</code>, å’Œ <code>also</code>. ä½œä¸ºæ‰©å±•å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä»»æ„å¯¹è±¡ä¸Šè°ƒç”¨ï¼ŒåŒºåˆ†å®ƒä»¬çš„è¦ç‚¹æ˜¯ï¼š</p><ol><li>æ˜¯å¦éœ€è¦è¿”å›å¯¹è±¡æœ¬èº«ï¼Ÿæ˜¯å¦éœ€è¦è¿”å›å…¶ä»–ä»»æ„å€¼ï¼Ÿ<code>let</code> å’Œ <code>run</code> å‡½æ•°ä¼šè¿”å› lambda è¡¨è¾¾å¼çš„ç»“æœï¼Œè€Œ <code>apply</code> å’Œ <code>also</code> ä¼šè¿”å›å¯¹è±¡æœ¬èº«ã€‚</li><li>ä½¿ç”¨ä»€ä¹ˆå¼•ç”¨å¯¹è±¡ï¼Ÿ<code>let</code> å’Œ <code>also</code> åˆ›é€ çš„ä½œç”¨åŸŸé‡Œä½¿ç”¨ <code>it</code> æŒ‡ä»£å¯¹è±¡ï¼Œè€Œ <code>apply</code> å’Œ <code>run</code> åˆ›é€ çš„ä½œç”¨åŸŸé‡Œä½¿ç”¨ <code>this</code> æŒ‡ä»£å¯¹è±¡ã€‚</li></ol><p>æœ€åï¼Œ<code>with</code> ä¸æ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œä½ éœ€è¦å°†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚</p><p>ä½œç”¨åŸŸå‡½æ•°çš„å¯¹æ¯”è¡¨æ ¼å¦‚ä¸‹ã€‚</p><table><thead><tr><th>Function</th><th>Object reference</th><th>Return value</th><th>Is extension function</th></tr></thead><tbody><tr><td><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/let.html"><code>let</code></a></td><td><code>it</code></td><td>Lambda result</td><td>Yes</td></tr><tr><td><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/run.html"><code>run</code></a></td><td><code>this</code></td><td>Lambda result</td><td>Yes</td></tr><tr><td><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/apply.html"><code>apply</code></a></td><td><code>this</code></td><td>Context object</td><td>Yes</td></tr><tr><td><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/also.html"><code>also</code></a></td><td><code>it</code></td><td>Context object</td><td>Yes</td></tr><tr><td><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/run.html"><code>run</code></a></td><td>-</td><td>Lambda result</td><td>No: called without the context object</td></tr><tr><td><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/with.html"><code>with</code></a></td><td><code>this</code></td><td>Lambda result</td><td>No: takes the context object as an argument</td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Networkx ä¸­ä¸€ä¸ªå¼•èµ·æ­§ä¹‰çš„å‚æ•°</title>
    <link href="/2024/02/21/nbunch%20in%20networkx/"/>
    <url>/2024/02/21/nbunch%20in%20networkx/</url>
    
    <content type="html"><![CDATA[<p>å®‰é™çš„å¤œæ™šï¼Œæ­£å‡†å¤‡æ‹‰æ»¡ç”Ÿäº§åŠ›çš„æˆ‘è¢«ä¸€ä¸ª bug æ— æƒ…æ‰“æ–­ã€‚æˆ‘æ­£åœ¨ç¼–å†™ä¸€äº›å¹³å‡¡çš„æ•°æ®å¤„ç†è„šæœ¬ï¼Œä¸ºäº†<del>å·æ‡’</del>ä¸é‡å¤é€ è½®å­ï¼Œæˆ‘ä½¿ç”¨äº†æˆ‘å¹¶ä¸ç†Ÿæ‚‰çš„ Python åº“ â€”â€” networkx. å½“æˆ‘å‘ç°å¤„ç†åçš„æ•°æ®å’ŒåŸå§‹æ•°æ®æœ‰ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘æ„è¯†åˆ°æˆ‘å†™äº†ä¸€ä¸ª bugã€‚ä¸€ç•ªè°ƒè¯•ä¹‹åï¼Œæˆ‘å‘ç°è¿™ä¸ª bug æ¥è‡ªäºä¸€ä¸ª API æ²¡æœ‰æŒ‰æˆ‘çŒœæµ‹çš„æ–¹å¼å·¥ä½œã€‚</p><p>ä¸‹é¢ç”¨ä¸€ä¸ªå°ä¾‹å­å±•ç¤ºä¸€ä¸‹è¿™ä¸ª API çš„è¡Œä¸ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> networkx <span class="hljs-keyword">as</span> nx<br>test_graph = nx.DiGraph([(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>), (<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>), (<span class="hljs-string">&#x27;100&#x27;</span>, <span class="hljs-string">&#x27;101&#x27;</span>)])<br></code></pre></td></tr></table></figure><p>è¿™ä¸€è¡Œä»£ç ä½¿ç”¨ networkx åº“åˆ›å»ºäº†ä¸€ä¸ªæœ‰å‘å›¾ï¼Œå…¶èŠ‚ç‚¹ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œåˆå§‹åŒ…å«ä¸‰æ¡è¾¹ã€‚</p><p>ç„¶åï¼Œæˆ‘å¸Œæœ›æŸ¥è¯¢æŸä¸ªç‰¹å®šèŠ‚ç‚¹çš„æ‰€æœ‰å‡ºè¾¹ï¼Œé€šè¿‡ç®€å•æŸ¥é˜…æ–‡æ¡£ï¼Œå‘ç°äº† <code>DiGraph</code> å¯¹è±¡æœ‰ä¸€ä¸ªåä¸º <code>edges</code> çš„å±æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(test_graph.edges(<span class="hljs-string">&#x27;100&#x27;</span>)) <span class="hljs-comment"># [(&#x27;100&#x27;, &#x27;101&#x27;)]</span><br><span class="hljs-built_in">print</span>(test_graph.edges(<span class="hljs-string">&#x27;999&#x27;</span>)) <span class="hljs-comment"># []</span><br><span class="hljs-built_in">print</span>(test_graph.edges(<span class="hljs-string">&#x27;129&#x27;</span>)) <span class="hljs-comment"># [(&#x27;1&#x27;, &#x27;2&#x27;), (&#x27;2&#x27;, &#x27;3&#x27;)]</span><br></code></pre></td></tr></table></figure><p>å½“å¡«å…¥å‚æ•° <code>&#39;100&#39;</code> æ—¶ï¼Œæ­£ç¡®è¿”å›äº†é‚£æ¡ä»¥ 100 ä¸ºèµ·å§‹ç‚¹çš„è¾¹ï¼›å½“å¡«å…¥å‚æ•° <code>&#39;999&#39;</code> æ—¶ï¼Œç”±äºå›¾ä¸­æ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿”å›äº†ä¸€ä¸ªç©ºåˆ—è¡¨ï¼›å½“å¡«å…¥å‚æ•° <code>&#39;129&#39;</code> æ—¶ï¼Œå®ƒå´è¿”å›äº†çœ‹ä¼¼ä¸ç›¸å¹²çš„è¾¹ã€‚</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</p><p>ä»”ç»†é˜…è¯» <code>Digraph.edges</code> çš„æ–‡æ¡£ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs text">&quot;&quot;&quot;An OutEdgeView of the DiGraph as G.edges or G.edges().<br><br>        edges(self, nbunch=None, data=False, default=None)<br><br>        The OutEdgeView provides set-like operations on the edge-tuples<br>        as well as edge attribute lookup. When called, it also provides<br>        an EdgeDataView object which allows control of access to edge<br>        attributes (but does not provide set-like operations).<br>        Hence, `G.edges[u, v][&#x27;color&#x27;]` provides the value of the color<br>        attribute for edge `(u, v)` while<br>        `for (u, v, c) in G.edges.data(&#x27;color&#x27;, default=&#x27;red&#x27;):`<br>        iterates through all the edges yielding the color attribute<br>        with default `&#x27;red&#x27;` if no color attribute exists.<br><br>        Parameters<br>        ----------<br>        nbunch : single node, container, or all nodes (default= all nodes)<br>            The view will only report edges from these nodes.<br>        data : string or bool, optional (default=False)<br>            The edge attribute returned in 3-tuple (u, v, ddict[data]).<br>            If True, return edge attribute dict in 3-tuple (u, v, ddict).<br>            If False, return 2-tuple (u, v).<br>        default : value, optional (default=None)<br>            Value used for edges that don&#x27;t have the requested attribute.<br>            Only relevant if data is not True or False.<br><br>        Returns<br>        -------<br>        edges : OutEdgeView<br>            A view of edge attributes, usually it iterates over (u, v)<br>            or (u, v, d) tuples of edges, but can also be used for<br>            attribute lookup as `edges[u, v][&#x27;foo&#x27;]`.<br><br>        See Also<br>        --------<br>        in_edges, out_edges<br><br>        Notes<br>        -----<br>        Nodes in nbunch that are not in the graph will be (quietly) ignored.<br>        For directed graphs this returns the out-edges.<br><br>        Examples<br>        --------<br>        &gt;&gt;&gt; G = nx.DiGraph()  # or MultiDiGraph, etc<br>        &gt;&gt;&gt; nx.add_path(G, [0, 1, 2])<br>        &gt;&gt;&gt; G.add_edge(2, 3, weight=5)<br>        &gt;&gt;&gt; [e for e in G.edges]<br>        [(0, 1), (1, 2), (2, 3)]<br>        &gt;&gt;&gt; G.edges.data()  # default data is &#123;&#125; (empty dict)<br>        OutEdgeDataView([(0, 1, &#123;&#125;), (1, 2, &#123;&#125;), (2, 3, &#123;&#x27;weight&#x27;: 5&#125;)])<br>        &gt;&gt;&gt; G.edges.data(&quot;weight&quot;, default=1)<br>        OutEdgeDataView([(0, 1, 1), (1, 2, 1), (2, 3, 5)])<br>        &gt;&gt;&gt; G.edges([0, 2])  # only edges originating from these nodes<br>        OutEdgeDataView([(0, 1), (2, 3)])<br>        &gt;&gt;&gt; G.edges(0)  # only edges from node 0<br>        OutEdgeDataView([(0, 1)])<br><br>        &quot;&quot;&quot;<br></code></pre></td></tr></table></figure><p>æ–‡æ¡£è¡¨æ˜ï¼Œå½“æˆ‘ä»¬ç»™ <code>edges</code> ä¼  1 ä¸ªå‚æ•°æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯ <code>nbunch</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ª <code>nbunch</code> å°±æ˜¯ a bunch of nodes ä¸€å †èŠ‚ç‚¹ï¼Œå®ƒæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„å®¹å™¨ï¼Œå¦‚æœä¸æä¾›å‚æ•°å®ƒå°†é»˜è®¤ä¸ºæ‰€æœ‰èŠ‚ç‚¹ã€‚åœ¨åé¢çš„ examples ä¸­ï¼Œæ–‡æ¡£å±•ç¤º <code>G.edges([0, 2])</code> å’Œ <code>G.edges(0)</code> ä¸¤ç§ç”¨æ³•ã€‚åœ¨ notes ä¸­ï¼Œæ–‡æ¡£ä¹Ÿæé†’æˆ‘ä»¬ï¼Œä¸å­˜åœ¨çš„èŠ‚ç‚¹ä¼šè¢« quietly ingnoredã€‚</p><p>ä½œä¸ºå†å²æ‚ ä¹…çš„ Python åº“ï¼Œnetworkx è‡ªç„¶æ˜¯å……åˆ†åˆ©ç”¨ Python çš„åŠ¨æ€ç‰¹æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›ä»»ä½•ç±»å‹æ ‡æ³¨ï¼Œç”¨æˆ·å¹¶ä¸çŸ¥é“ä¼ å…¥ <code>edges</code> çš„ <code>nbunch</code> å‚æ•°ä¼šè¢«å½“åšä»€ä¹ˆç±»å‹ã€‚è€Œè¿™ä¸ª bug çš„åŸå› ä¹Ÿéå¸¸ç®€å•ï¼Œnetworkx åº“æŠŠæˆ‘ä»¬ä¼ å…¥çš„ <code>&#39;129&#39;</code> å½“æˆäº†ä¸€ä¸ª iterable çš„å¯¹è±¡ï¼Œå¹¶è¯•å›¾æ‰¾åˆ°èŠ‚ç‚¹ <code>[&#39;1&#39;, &#39;2&#39;, &#39;9&#39;]</code> ä¸ºèµ·å§‹çš„æ‰€æœ‰è¾¹ã€‚</p><p>æŸ¥é˜… networkx çš„æºç ï¼Œä½ ä¼šå‘ç°å®ƒæ²¡æœ‰åšä»»ä½•é”™äº‹ï¼šå‚æ•° <code>nbunch</code> ç»è¿‡ <code>Graph.nbunch_iter()</code> å¤„ç†ä¸ºäº†ä¸€ä¸ª iteratorï¼Œè¯¥å‡½æ•°ç®€å•åœ°åˆ¤æ–­ <code>nbunch</code> æ˜¯ä¸æ˜¯å½“å‰å›¾é‡Œçš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å°±è¿”å› <code>iter([nbunch])</code>ï¼Œå¦‚æœä¸æ˜¯å°±å½“æˆä¸€ä¸ªèŠ‚ç‚¹åºåˆ—å¤„ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">nbunch_iter</span>(<span class="hljs-params">self, nbunch=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> nbunch <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:  <span class="hljs-comment"># include all nodes via iterator</span><br>        bunch = <span class="hljs-built_in">iter</span>(self._adj)<br>    <span class="hljs-keyword">elif</span> nbunch <span class="hljs-keyword">in</span> self:  <span class="hljs-comment"># if nbunch is a single node</span><br>        bunch = <span class="hljs-built_in">iter</span>([nbunch])<br>    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># if nbunch is a sequence of nodes</span><br>        ...<br>    <span class="hljs-keyword">return</span> bunch<br></code></pre></td></tr></table></figure><p>æˆ‘æƒ³ä¸åˆ°è¿™æ®µä»£ç æœ¬èº«æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„èŠ‚ç‚¹åºåˆ—ï¼Œé‚£ä¹ˆè¿™æ ·çš„ API è°ƒç”¨å°±æ˜¯æœ‰æ­§ä¹‰çš„ã€‚ç”šè‡³ï¼Œæœ‰å‘å›¾çš„ç‚¹é›†ä¼šå½±å“è¯¥ API çš„è¡Œä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">test_graph = nx.DiGraph([(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>), (<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)])<br><br><span class="hljs-built_in">print</span>(test_graph.edges(<span class="hljs-string">&#x27;100&#x27;</span>)) <span class="hljs-comment"># [(&#x27;1&#x27;, &#x27;2&#x27;)]</span><br><br>test_graph.add_nodes_from([<span class="hljs-string">&#x27;100&#x27;</span>]) <span class="hljs-comment"># ä»…æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ ä¸æ”¹å˜åŸè¾¹é›†</span><br><span class="hljs-built_in">print</span>(test_graph.edges(<span class="hljs-string">&#x27;100&#x27;</span>)) <span class="hljs-comment"># []</span><br></code></pre></td></tr></table></figure><p>æƒ³è¦ä¿®å¤ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦æ‰‹å·¥ä¼ å…¥ä¸€ä¸ªé•¿åº¦ä¸º 1 çš„åˆ—è¡¨å³å¯é¿å…æ­§ä¹‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">test_graph = nx.DiGraph([(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>), (<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)])<br><span class="hljs-built_in">print</span>(test_graph.edges([<span class="hljs-string">&#x27;100&#x27;</span>])) <span class="hljs-comment"># []</span><br></code></pre></td></tr></table></figure><p>å›é¡¾ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼šnetworkx åœ¨è®¾è®¡ä¹‹åˆå°±å€ŸåŠ© Python çš„åŠ¨æ€ç‰¹æ€§è®©å®ƒä»¬çš„ API å°½å¯èƒ½çµæ´»é€‚åº”ä¸åŒæƒ…å†µï¼Œæ²¡æœ‰å¯¹è¾“å…¥å‚æ•°çš„ç±»å‹è¿›è¡Œé™åˆ¶ã€‚å½“ç”¨æˆ·è°ƒç”¨ <code>DiGraph.edges</code> æ—¶ï¼Œè¯¥ API å°†è¾“å…¥å‚æ•° <code>nbunch</code> è§†ä¸ºä½•ç§æ•°æ®ç±»å‹ç”±æœ‰å‘å›¾çš„èŠ‚ç‚¹é›†å†³å®šï¼ˆå¦‚æœ <code>nbunch</code> ä¸åœ¨ç‚¹é›†ä¸­åˆ™è¢«å°†è§†ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼‰ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒAPI çš„è¡Œä¸ºå’Œç”¨æˆ·çš„é¢„æœŸäº§ç”Ÿäº†åå·®ï¼Œæœ€ç»ˆå¯¼è‡´äº†éšè”½çš„ bugã€‚</p><p>å®é™…ä¸Šï¼Œå…³äº <code>nbunch</code> å‚æ•°çš„æ­§ä¹‰ï¼ŒGitHub ç¤¾åŒºå·²ç»æœ‰å¤šä¸ªè®¨è®ºï¼Œæ¯”å¦‚ <a href="https://github.com/networkx/networkx/issues/4781">#4871</a> ï¼Œ <a href="https://github.com/networkx/networkx/issues/6509">#6509</a> å’Œ <a href="https://github.com/networkx/networkx/issues/6275">#6275</a> ï¼Œç¤¾åŒºè´¡çŒ®è€…ä¹Ÿæ›¾ç§¯æè®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œä½†è‡³ä»Šæ²¡æœ‰å¼•èµ·ä»£ç çš„æ›´æ”¹ã€‚å¦‚æœä½ ä½œä¸º networkx çš„ç†Ÿç»ƒä½¿ç”¨è€…ï¼Œä½ å¾ˆæ¸…æ¥š networkx ä¼šæ€ä¹ˆå¤„ç† <code>nbunch</code> å‚æ•°å€¼ï¼Œä½ è‡ªç„¶ä¸ä¼šå†™å‡ºåƒ <code>test_graph.edges(node)</code> çš„æ­§ä¹‰è¯­å¥ã€‚ä½†å¦‚æœä½ ä½œä¸ºåˆšåˆšæ¥è§¦ networkx çš„äººï¼ˆå°±åƒæˆ‘ä¸€æ ·ï¼‰ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½åƒæˆ‘ä¸€æ ·ç›´æ¥æŠŠèŠ‚ç‚¹å¯¹è±¡ä¼ ç»™è¯¥ APIã€‚åˆ°åº•è¦ä¸è¦ä¸ºäº†è¿™ä¸ªç½•è§é—®é¢˜ä¿®æ”¹ networkx æºç ï¼Œç¤¾åŒºå¼€å‘è€…æœ€ç»ˆé€‰æ‹©äº†ä¿æŒä¸å˜ã€‚</p><p>é‚£ä¹ˆè¿™æ ·çš„ bug è¯¥æ€ä¹ˆé¢„é˜²å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œç©¶ç«Ÿæ€ä¹ˆä¿®æ”¹ networkx çš„ä»£ç æ‰èƒ½é¿å…è¿™æ ·çš„æ½œåœ¨ bug å‘¢ï¼Ÿ</p><ol><li>åŠ å…¥é¢å¤–çš„é€»è¾‘åˆ¤æ–­ä¼ å…¥çš„å‚æ•°åˆ°åº•æ˜¯èŠ‚ç‚¹åºåˆ—è¿˜æ˜¯å•ä¸ªèŠ‚ç‚¹ã€‚ç„¶è€Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º networkx è®¤ä¸ºæ‰€æœ‰ hashable çš„å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºèŠ‚ç‚¹ï¼Œå¹¶ä¸” networkx ä¸æä¾›ä»»ä½•èŠ‚ç‚¹çš„åŸºç±»ï¼Œå¹¶ä¸å­˜åœ¨ <code>isinstance(node, BaseNode)</code> ä¹‹ç±»çš„æ“ä½œã€‚åŒæˆ‘ä»¬æœ€å¼€å§‹å±•ç¤ºçš„ä¾‹å­ï¼Œä¸€ä¸ª string æ—¢æ˜¯ hashable ä¹Ÿæ˜¯ iterableï¼Œä½ æ²¡åŠæ³•ä»…ä»æ•°æ®ç±»å‹è¿›è¡Œåˆ¤æ–­ã€‚</li><li>è®© <code>nbunch_iter</code> åªæ¥å— <code>nbunch</code> æ˜¯ iterable å¯¹è±¡ã€‚è¿™å¹¶ä¸ä¼šç‰ºç‰²çµæ´»æ€§ï¼Œå› ä¸ºå½“ä½ æƒ³ä¼ å…¥å•ä¸ªèŠ‚ç‚¹æ—¶ï¼Œåªéœ€è¦æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ª list é‡Œå°±è¡Œäº†ã€‚ä½†æ˜¯è¿™ä¼šä¿®æ”¹ APIï¼Œå½±å“åˆ° networkx åº“é‡Œå…¶ä»–æ‰€æœ‰ç”¨åˆ° <code>nbunch_iter</code> çš„åœ°æ–¹ã€‚</li></ol><p>æœ€ç»ˆï¼Œç¤¾åŒºå¼€å‘è€…åœ¨ <a href="https://github.com/networkx/networkx/pull/6513">è¿™ä¸ª PR</a> é‡Œä¸ºæ–‡æ¡£å¢åŠ äº†é¢å¤–çš„ä¾‹å­æ¥è§£é‡Š <code>nbunch</code> å¯èƒ½å¼•èµ·çš„æ­§ä¹‰ï¼Œè€Œå¹¶æ²¡æœ‰å¼•èµ·ä»£ç å˜æ›´ã€‚ç„¶è€Œï¼Œå¢åŠ çš„é¢å¤–è§£é‡Šè—åœ¨ <a href="https://networkx.org/documentation/stable/reference/glossary.html#term-nbunch">Glossary æ¿å—é‡Œ</a>ï¼Œæä¸å®¹æ˜“è¢«æ³¨æ„åˆ°â€¦â€¦</p><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>nbunch</code> çš„æ•…äº‹å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç‰ºç‰²å¯é æ€§è·å¾—çµæ´»æ€§çš„ä¾‹å­ï¼Œå¦‚æœ networkx åœ¨è®¾è®¡ä¹‹åˆå°±è€ƒè™‘äº† gradual typingï¼Œé‚£ä¹ˆ <code>nbunch_iter()</code> çš„ä½œè€…è‡ªç„¶ä¸ä¼šå†™å‡ºåƒ <code>Hashable | Iterable[Hashable] | None</code> æˆ–è€…åƒ <code>Optional[Union[Hashable, Iterable[Hashable]]]</code> (Python 3.10 ä¹‹å‰) è¿™ä¹ˆå¥‡æ€ªçš„ç±»å‹æ ‡æ³¨ï¼Œä»è€Œåœ¨æœ€ä¸€å¼€å§‹å°±æŠŠ <code>nbunch</code> è®¾è®¡ä¸ºåªæ¥å—èŠ‚ç‚¹åºåˆ—ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªåŠ¨åŒ–çš„åšå®¢å‘å¸ƒå·¥ä½œæµ</title>
    <link href="/2024/01/12/My%20Blog%20Workflow/"/>
    <url>/2024/01/12/My%20Blog%20Workflow/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>23 å¹´ 10 æœˆä»½ï¼Œæˆ‘å¼€å§‹ä½¿ç”¨ Obsidian ä½œä¸ºç¬”è®°å·¥å…·ï¼Œä»æ­¤ä¸€å‘ä¸å¯æ”¶æ‹¾ã€‚ä¹‹å‰æ°ªé‡‘æ”¯æŒçš„ Typoraï¼Œç°åœ¨å·²æ²¦ä¸º Markdown æœ¬åœ°é¢„è§ˆå™¨ã€‚æˆ‘è¿›ä¸€æ­¥å‘ç°ï¼ŒObsidian é€æ˜å¯å®šåˆ¶çš„è®¾è®¡ç†å¿µï¼Œä½¿å®ƒå¯ä»¥ä¸å…¶ä»–å·¥å…·è¿›è¡Œé›†æˆå’ŒååŒï¼Œå ªç§°æ˜¯ç¬”è®°å±Šçš„ VSCodeã€‚ç»è¿‡ 2 å¤©å·¦å³çš„å°è¯•ï¼Œæˆ‘å°±æå‡ºäº†ä¸€å¥—ä½¿ç”¨ Obsidian æ’°å†™æ–‡ç« å¹¶è‡ªåŠ¨å‘å¸ƒåˆ°ç½‘ç«™çš„å·¥ä½œæµï¼Œæ•´ä¸ªè¿‡ç¨‹é—¨æ§›æä½ï¼Œå¹¶ä¸”æœ‰å¾ˆä¸é”™çš„è‡ªå®šä¹‰ç©ºé—´ï¼ˆå‡è®¾ä½ éå¸¸ç†Ÿæ‚‰å‰ç«¯æŠ€æœ¯ï¼‰ã€‚ç°åœ¨æŠŠè¿™å¥—å·¥å…·å’Œæµç¨‹åˆ†äº«ç»™å¤§å®¶ã€‚</p><p>ç›®å‰æˆ‘ä½¿ç”¨çš„å·¥å…·å¦‚ä¸‹ã€‚</p><ul><li><a href="https://docs.github.com/en/pages/quickstart">GitHub Pages</a>: å…è´¹çš„é™æ€ç½‘ç«™éƒ¨ç½²ï¼Œå¤§é™†å¯è®¿é—®</li><li><a href="https://hexo.io/">Hexo</a>: ä¸€ä¸ªåŸºäº Nodejs çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œæ–‡ç« ä½¿ç”¨ Markdown ä½œä¸ºæºè¯­è¨€</li><li><a href="https://obsidian.md/">Obsidian</a>: é«˜åº¦è‡ªå®šä¹‰çš„ç¬”è®°å·¥å…·ï¼Œå†…å®¹å®Œå…¨åŸºäº Markdown æ–‡ä»¶</li><li><a href="https://github.com/denolehov/obsidian-git">Obsidian-Git</a> æ’ä»¶: å…è´¹çš„äº‘ç«¯å¤‡ä»½å’Œè·¨è®¾å¤‡åŒæ­¥è§£å†³æ–¹æ¡ˆï¼ŒåŸºäº Git</li></ul><div class="note note-info">            <p>è¿™é‡Œä¸€å…±æ¶‰åŠäº†ä¸‰ä¸ªæ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ç¬”è®°å·¥å…· (ç¼–è¾‘ Markdown)ã€é™æ€ç½‘ç«™ç”Ÿæˆå™¨ (å¤„ç† Markdown)ã€ç½‘ç«™éƒ¨ç½²æœåŠ¡ã€‚å®ƒä»¬ç›¸äº’ç‹¬ç«‹ï¼Œåˆ†åˆ«å¯ä»¥ç”¨å…¶ä»–å·¥å…·æ›¿æ¢ã€‚æœ¬æ–‡ä¸»è¦å±•ç¤ºæˆ‘æ¯”è¾ƒå–œæ¬¢çš„è¿™ä¸€ç»„åˆã€‚</p>          </div><p>å€ŸåŠ©è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Obsidian å†…éšå¿ƒç¼–å†™å†…å®¹ï¼Œç„¶åè‡ªåŠ¨åœ°å°†æ–‡ç« å‘å¸ƒè‡³ç½‘ç«™ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿä»»ä½•è´¹ç”¨ã€‚ç»è¿‡å‰æœŸçš„é…ç½®åï¼Œå‘å¸ƒä¸€ç¯‡åšæ–‡çœŸçš„å°±<strong>åªéœ€è¦ä¸‰æ­¥</strong>ï¼š</p><ol><li>åœ¨ Obsidian é‡Œæ–°å»ºæ–‡ä»¶ï¼Œå¡«å…¥æ ‡é¢˜ç­‰ä¿¡æ¯ï¼Œå¹¶åœ¨ Obsidian å†…å®Œæˆæ’°å†™</li><li>æ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œ <code>hexo deploy -g</code></li><li>ç­‰å¾… GitHub Pages éƒ¨ç½²å®Œæˆï¼Œå³å¯åœ¨ç½‘ç«™ä¸Šçœ‹åˆ°ç²¾ç¾çš„æ–‡ç« </li></ol><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ç®€è¦ä»‹ç»ä¸€ä¸‹æˆ‘çš„é…ç½®è¿‡ç¨‹ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>ä¸ºäº†åœ¨æœºå™¨ä¸Šé¡ºåˆ©è¿è¡Œ Hexo å’Œ Git ç­‰å‘½ä»¤è¡Œå·¥å…·ï¼Œéœ€è¦æå‰åšä»¥ä¸‹å‡†å¤‡ï¼š</p><ol><li>Nodejs. ç”±äº Hexo æ˜¯åŸºäº JavaScript çš„å·¥å…·ï¼Œéœ€è¦åœ¨è‡ªå·±çš„æœºå™¨ä¸Šå®‰è£… node å’Œ npm&#x2F;pnpm ç­‰å‘½ä»¤è¡Œå·¥å…·ï¼ŒWindows å¯ä½¿ç”¨ scoop&#x2F;winget (ç±»ä¼¼äº Ubuntu ä¸­çš„ apt) å®‰è£…ã€‚</li><li>Git. é€šè¿‡æœ¬åœ°çš„ Git å‘½ä»¤è¡Œå·¥å…·èƒ½å¤Ÿç›´æ¥ pull&#x2F;push è¿œç¨‹ä»“åº“ï¼Œé¿å…æ‰‹åŠ¨ä¸Šä¼ ä¸‹è½½ã€‚</li><li>GitHub &#x2F; Gitee ç­‰å¹³å°è´¦å·ã€‚<ul><li>æˆ‘ä½¿ç”¨ GitHub Pages ä½œä¸ºé™æ€é¡µé¢éƒ¨ç½²æ–¹æ¡ˆï¼Œ</li><li>æˆ‘ä½¿ç”¨ Gitee ç§æœ‰ä»“æ¥æ‰˜ç®¡æºç é¡¹ç›®ï¼Œå®ƒå…¼å…·äº‘ç«¯å¤‡ä»½å’Œè·¨è®¾å¤‡åŒæ­¥çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¸Œæœ›ç½‘ç»œè¿æ¥é€šç•…ä¸€äº›ï¼Œæ¢æˆ GitHub ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</li></ul></li></ol><h2 id="Hexo-é¡¹ç›®é…ç½®"><a href="#Hexo-é¡¹ç›®é…ç½®" class="headerlink" title="Hexo é¡¹ç›®é…ç½®"></a>Hexo é¡¹ç›®é…ç½®</h2><p>Hexo æ˜¯ä¸€ä¸ªåšå®¢ç«™æ¡†æ¶ï¼Œå‡†ç¡®çš„æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªé™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œç±»ä¼¼äº Jekyllã€‚å®ƒè´Ÿè´£å°†ä¸€ä¸ªæ–‡ä»¶å¤¹ (é»˜è®¤ä¸º <code>source/_posts</code>) ä¸‹çš„æ‰€æœ‰ Markdown æ–‡ä»¶è½¬åŒ–ä¸ºä¸€ä¸ªç½‘ç«™ã€‚å…³äº Hexo çš„ç”¨æ³•ï¼Œå¯ä»¥æŸ¥é˜… <a href="https://hexo.io/docs/">æ–‡æ¡£</a>ã€‚</p><h3 id="åˆ›å»ºç½‘ç«™"><a href="#åˆ›å»ºç½‘ç«™" class="headerlink" title="åˆ›å»ºç½‘ç«™"></a>åˆ›å»ºç½‘ç«™</h3><p>é¦–å…ˆ clone å®˜æ–¹æä¾›çš„é¡¹ç›®æ¨¡æ¿åˆ°æœ¬åœ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/hexojs/hexo-starter blog<br></code></pre></td></tr></table></figure><p>è¿›å…¥è¯¥è·¯å¾„åï¼Œä½ å°†ä¼šçœ‹åˆ°ï¼š</p><ul><li><code>source/</code> æ˜¯å­˜æ”¾ç½‘ç«™æºå†…å®¹çš„ç›®å½•ï¼ŒHexo ä¸ä¼šä¿®æ”¹è¯¥ç›®å½•ä¸‹çš„ä»»ä½•å†…å®¹ã€‚å‡†ç¡®åœ°æ¥è¯´ï¼Œè¯¥ç›®å½•ä¸­çš„ Markdown åç¼€æ–‡ä»¶ä¼šè¢« Hexo è¯†åˆ«å¹¶å¤„ç†ï¼Œå…¶ä½™æ–‡ä»¶å°†ä¼šç…§æ¬è‡³ç½‘ç«™æ–‡ä»¶ä¸­ã€‚<ul><li><code>source/_posts</code> ä¸­çš„æ‰€æœ‰ Markdown æ–‡ä»¶å°†è¢«è§†ä½œæ–‡ç« ï¼Œåœ¨ Obsidian ä¸­ï¼Œæˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶ä¸‹åˆ›å»ºçš„ç¬”è®°å°†è¢«å‘å¸ƒï¼Œå¦åˆ™ä¸ä¼šè¢«å¤„ç†ä¸ºæ–‡ç« ã€‚</li></ul></li><li><code>_config.yml</code> æ˜¯ç½‘ç«™é…ç½®ï¼Œå¯ä»¥æ ¹æ® <a href="https://hexo.io/docs/configuration">æ–‡æ¡£</a> æ¥ä¿®æ”¹ã€‚</li><li><code>themes/</code> æ˜¯å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜çš„åœ°æ–¹ã€‚</li><li><code>.gitignore</code> æŒ‡å®š Git ä¸ä¼šè¿½è¸ªçš„æ–‡ä»¶ã€‚</li></ul><p>è¿™ä¸ªç›®å½•åŒæ—¶ä½œä¸º Hexo é¡¹ç›®å’Œ Obsidian Vaultï¼Œæˆ‘å¸Œæœ›è¿™ä¸ªç›®å½•åœ¨æˆ‘çš„æ‰€æœ‰è®¾å¤‡ä¹‹é—´åŒæ­¥ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ› Git ä¸è¦è¿½è¸ª Node ä¾èµ–ã€Hexo éƒ¨ç½²äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ã€‚è¿™æ˜¯æˆ‘çš„ <code>.gitignore</code> æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs gitignore"># Node<br>*.log<br>*.iml<br>node_modules/<br>package-lock.json<br>*.lock<br>pnpm-lock.yaml<br><br># Obsidian<br>.obsidian/workspace.json<br>.obsidian/workspace-mobile.json<br>.obsidian/community-plugins.json<br>.obsidian/plugins/<br><br># Hexo<br>db.json<br>public/<br>.deploy_git/<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥ç›®å½•ä¸‹ï¼Œä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å·¥å…·å®‰è£…ä¾èµ–ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹ä½¿ç”¨ Hexo å‘½ä»¤è¡Œå·¥å…·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm install<br>npx hexo --version<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œä½ å°±å¯ä»¥éšæ„ä½¿ç”¨ Hexo äº†ã€‚ä¾‹å¦‚ä½ å¯ä»¥ä½¿ç”¨ <code>hexo generate</code> æ¥ç”Ÿæˆæ•´ä¸ªç½‘ç«™ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ <code>hexo server</code> æ¥åœ¨æœ¬åœ°æµè§ˆå™¨æŸ¥çœ‹ç½‘ç«™ã€‚åœ¨æœ¬åœ°æŸ¥çœ‹è¿‡ç¨‹ä¸­ï¼Œä½ åœ¨ <code>source/_posts</code> ä¿®æ”¹çš„æ–‡ç« å†…å®¹éƒ½ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼ˆæµè§ˆå™¨åˆ·æ–°ç½‘é¡µï¼‰ã€‚</p><h3 id="é™æ€ç½‘ç«™éƒ¨ç½²"><a href="#é™æ€ç½‘ç«™éƒ¨ç½²" class="headerlink" title="é™æ€ç½‘ç«™éƒ¨ç½²"></a>é™æ€ç½‘ç«™éƒ¨ç½²</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°† Hexo ç”Ÿæˆçš„ç½‘ç«™éƒ¨ç½²åˆ°ç½‘ä¸Šï¼Œè®©å…¶ä»–äººéƒ½å¯ä»¥çœ‹åˆ°ã€‚ä½¿ç”¨ GitHub Pages éƒ¨ç½²é™æ€ç½‘ç«™éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦æŠŠç½‘ç«™å†…å®¹ä¸Šä¼ åˆ° <code>&lt;username&gt;.github.io</code> è¿™ä¸ªä»“åº“ï¼Œå°±ç­‰åŒäºéƒ¨ç½²åˆ° <code>https://&lt;username&gt;.github.io</code> è¿™ä¸ªç½‘ç«™ã€‚</p><p>æ’ä»¶ hexo-deployer-git å¯ä»¥å°†ä¸Šä¼ çš„æµç¨‹è‡ªåŠ¨åŒ–ã€‚é¦–å…ˆåœ¨è¯¥ç›®å½•ä¸‹å®‰è£… node åŒ…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm install hexo-deployer-git<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>_config.yml</code> ä¸­å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">deploy:</span>  <br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span>  <br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/&lt;username&gt;/&lt;username&gt;.github.io</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">gh-pages</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ„æ€æ˜¯ï¼Œå‘Šè¯‰ Hexo ä½ çš„éƒ¨ç½²æ–¹å¼æ˜¯é€šè¿‡ Git ä¸Šä¼ åˆ°ä¸€ä¸ªä½ æŒ‡å®šçš„è¿œç¨‹ä»“åº“ã€‚</p><p>å‰å¾€ GitHub å®˜ç½‘åˆ›å»ºä¸€ä¸ªåä¸º <code>&lt;username&gt;.github.io</code> çš„å…¬å¼€ä»“åº“ï¼Œå¹¶å‚è€ƒ <a href="https://docs.github.com/en/pages/quickstart">å®˜æ–¹æ•™ç¨‹</a> åœ¨ä»“åº“é‡Œè®¾ç½® Pages æœåŠ¡ï¼Œç„¶åä½ å°±å¯ä»¥ä½¿ç”¨ <code>hexo deploy</code> å‘½ä»¤è‡ªåŠ¨ä¸Šä¼ ã€‚ä¸€æ—¦ä½ æŠŠç½‘ç«™å†…å®¹ä¼ åˆ° GitHubï¼ŒGitHub Pages ä¼šè‡ªåŠ¨åœ°éƒ¨ç½²ä½ çš„å†…å®¹ã€‚</p><h2 id="Obsidian-Vault-é…ç½®"><a href="#Obsidian-Vault-é…ç½®" class="headerlink" title="Obsidian Vault é…ç½®"></a>Obsidian Vault é…ç½®</h2><p>åˆšåˆšè®²åˆ°ï¼ŒHexo æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ <code>source/_posts</code> ä¸‹çš„æ‰€æœ‰ Markdown æ–‡ä»¶å½“åšæ–‡ç« ï¼Œå¹¶æ ¹æ®å®ƒä»¬ç”Ÿæˆç½‘ç«™ã€‚è¿™ä¸ Obsidian çš„ä½¿ç”¨ç†å¿µé«˜åº¦ç»Ÿä¸€ï¼ŒObsidian æœ¬è´¨ä¸Šå°±æ˜¯å¸®åŠ©ä½ ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶å¤¹ (ç§°ä¸º Vault) ä¸‹çš„æ‰€æœ‰ Markdown æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬æ‰“å¼€ Obsidianï¼Œç‚¹å‡» Open Folder as Vault å¹¶é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ç›®å½•ã€‚è¿™æ ·ï¼ŒObsidian ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>.obsidian</code> çš„æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾è¯¥ Vault çš„è®¾ç½®ã€æ’ä»¶ç­‰ä¿¡æ¯ï¼Œç±»ä¼¼äº <code>.idea/</code> å’Œ <code>.vscode/</code>ã€‚æ²¡æœ‰ç‰¹æ®Šæƒ…å†µçš„è¯ï¼Œè¯¥æ–‡ä»¶å¤¹å¯ä»¥è®© Git è¿½è¸ªå¹¶åŒæ­¥ï¼Œä¸è¿‡ä¸ºäº†é˜²æ­¢æ½œåœ¨çš„åˆå¹¶å†²çªï¼Œæˆ‘æ¨èåœ¨ <code>.gitignore</code> é‡Œå¿½ç•¥ä»¥ä¸‹ä¸¤é¡¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gitignore">.obsidian/workspace.json<br>.obsidian/plugins/<br></code></pre></td></tr></table></figure><h3 id="æ–‡ç« æ¨¡ç‰ˆ"><a href="#æ–‡ç« æ¨¡ç‰ˆ" class="headerlink" title="æ–‡ç« æ¨¡ç‰ˆ"></a>æ–‡ç« æ¨¡ç‰ˆ</h3><p>åœ¨ Hexo ä¸­ï¼Œæ¯ä¸ª Markdown æ–‡ä»¶éƒ½éœ€è¦é€šè¿‡ front-matter æ¥æŒ‡å®šæ–‡ç« çš„å…ƒä¿¡æ¯ï¼Œä¸€ä¸ªå…¸å‹çš„ front-matter æ˜¯è¿™ä¸ªæ ·å­çš„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">&quot;æ–‡ç« æ ‡é¢˜&quot;</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2024-01-11 11:22:56</span><br><span class="hljs-attr">updated:</span> <span class="hljs-number">2024-01-11 11:22:56</span><br><span class="hljs-attr">categories:</span> <span class="hljs-string">æ–‡ç« </span><br><span class="hljs-attr">tags:</span><br>Â  <span class="hljs-bullet">-</span> <span class="hljs-string">test</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>è¿™äº›å†…å®¹ä¼šè¢« Hexo è§£æï¼Œç”¨äºç”Ÿæˆç½‘ç«™ã€‚å®Œæ•´çš„è®¾ç½®å­—æ®µè¯·æŸ¥é˜… <a href="https://hexo.io/docs/front-matter">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨ Obsidian ä¸­æ¯åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ï¼Œéƒ½éœ€è¦åœ¨æœ€å¼€å¤´é™„ä¸Šä¸€æ®µè¿™æ ·çš„ä¿¡æ¯ã€‚ä¸ºäº†èŠ‚çœæ“ä½œï¼Œæˆ‘æ¨èä½¿ç”¨æ¨¡ç‰ˆæ’ä»¶æ¥è‡ªåŠ¨ç”Ÿæˆè¿™æ ·çš„å†…å®¹ã€‚</p><p>åœ¨ Obsidian è®¾ç½®ç•Œé¢é‡Œçš„ Community Plugins ä¸­æœç´¢ â€œTemplaterâ€ï¼Œå¹¶å®‰è£…è¯¥æ’ä»¶ã€‚ç„¶ååœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>templater</code> çš„ç©ºæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ’ä»¶è®¾ç½®ä¸­æŒ‡å®šè¯¥è·¯å¾„ä¸ºæ¨¡ç‰ˆæ–‡ä»¶å¤¹ã€‚åœ¨ <code>templater</code> ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆéšä¾¿èµ·åå­—ï¼‰ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹å¹¶æŒ‰éœ€ä¿®æ”¹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">&#x27;&lt;% tp.file.title %&gt;&#x27;</span><br><span class="hljs-attr">date:</span> &lt;%<span class="language-ruby"> tp.date.now(<span class="hljs-string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>) </span>%&gt;<br><span class="hljs-attr">updated:</span> &lt;%<span class="language-ruby"> tp.date.now(<span class="hljs-string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>) </span>%&gt;<br><span class="hljs-attr">categories:</span>  <br><span class="hljs-attr">tags:</span>  <br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œä½ åœ¨ä»»ä½•æ–°ç¬”è®°ä¸­æŒ‰ä¸‹ <code>Alt+E</code> å¿«æ·é”®ï¼Œå°±å¯ä»¥å¾—åˆ°æ‰€éœ€çš„ front-matterã€‚ç±»ä¼¼ä¸‹é¢è¿™æ ·<br><img src="/attachments/20240112145528.png"></p><p>Obsidian ä¹Ÿæ˜¯éå¸¸ç»™åŠ›ï¼Œè¿™æ ·çš„ UI æå¤§å¢å¼ºäº†å¯è¯»æ€§ï¼Œå¹¶æ–¹ä¾¿æˆ‘ä»¬ç¼–è¾‘ç›¸åº”å†…å®¹ã€‚</p><h3 id="æ— ç¼å¤‡ä»½-åŒæ­¥"><a href="#æ— ç¼å¤‡ä»½-åŒæ­¥" class="headerlink" title="æ— ç¼å¤‡ä»½ &amp; åŒæ­¥"></a>æ— ç¼å¤‡ä»½ &amp; åŒæ­¥</h3><p>æˆ‘å¸Œæœ›æˆ‘èƒ½åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½ç¼–è¾‘å¹¶å‘å¸ƒæ–‡ç« ï¼Œè¿™å°±éœ€è¦è®©è¿™æ•´ä¸ªé¡¹ç›®è·¨è®¾å¤‡åŒæ­¥ï¼Œè¿™æ ·ä¸ç®¡æˆ‘ä¿®æ”¹ Hexo è®¾ç½®ï¼Œè¿˜æ˜¯æ·»åŠ æ–°æ–‡ç« å†…å®¹ï¼Œéƒ½æ²¡æœ‰ä»»ä½•é˜»ç¢ã€‚ä¸‹é¢æˆ‘ä»‹ç»æˆ‘çš„æ–¹æ¡ˆï¼Œå®Œå…¨å…è´¹ã€‚</p><p>åœ¨æ–‡ç« çš„æœ€å¼€å§‹ï¼Œæˆ‘ä»¬å…¶å®å°± clone äº†ä¸€ä¸ª Git ä»“ã€‚è¿™ä¸ª Git ä»“æ—¢è¿½è¸ª Hexo é¡¹ç›®æ–‡ä»¶ï¼Œä¹Ÿè¿½è¸ªäº†æ‰€æœ‰ Markdown æºæ–‡ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥å€ŸåŠ© Git æ¥ç®¡ç†ç›®å½•ä¸‹ä¸€åˆ‡æ‰€éœ€çš„ä¸œè¥¿ã€‚</p><p>é¦–å…ˆï¼Œå‰å¾€ Gitee åˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“ï¼Œåå­—æ— æ‰€è°“ã€‚è¿™ä¸ªä»“åº“è´Ÿè´£æ‰˜ç®¡æˆ‘ä»¬æ•´ä¸ªé¡¹ç›®ã€‚</p><p>åœ¨é¡¹ç›®ç›®å½•ä¸‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ æˆ‘ä»¬åˆšåˆšè¿œç¨‹ä»“åº“ï¼ˆå¿…é¡»æ˜¯ Obsidian Vault çš„æ ¹ç›®å½•ï¼Œå¦åˆ™è‡ªåŠ¨åŒæ­¥æ’ä»¶ä¸èƒ½å·¥ä½œï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin https://gitee.com/me/repo_name.git<br></code></pre></td></tr></table></figure><p>å…ˆæ‰‹åŠ¨ç¡®è®¤ä¸€ä¸‹ push æ²¡æœ‰é—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .<br>git commit -m <span class="hljs-string">&quot;message&quot;</span><br>git push --set-upstream origin master<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šè¿‡ç¨‹å¦‚æœè¦æ±‚ä½ åœ¨å‘½ä»¤è¡Œè¾“å¯†ç ï¼Œå°±ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæˆ‘æ¨èä½¿ç”¨ ssh key æˆ– Git Credential Manager ç­‰æ–¹æ¡ˆï¼Œè¿™æ ·ä¹‹åä½¿ç”¨æ’ä»¶è‡ªåŠ¨åŒæ­¥å°±çœå¿ƒäº†ã€‚</p><div class="note note-info">            <p>Tips<br>å¯ä»¥ä½¿ç”¨ <code>git config commit.gpgsign false</code> æ¥å–æ¶ˆ commit ç­¾åï¼Œåæ­£è¿™ä¸ªé¡¹ç›®åªåœ¨ç§æœ‰ä»“é‡Œå¤‡ä»½ï¼Œå¹¶ä¸å¯¹å…¶ä»–äººå¯è§ã€‚</p>          </div><p>ç¡®è®¤ Git å¯ä»¥è¿›è¡Œ push&#x2F;pull æ“ä½œåï¼Œæˆ‘ä»¬ä½¿ç”¨æ’ä»¶æ¥æŠŠåŒæ­¥å…¨è‡ªåŠ¨åŒ–ã€‚å‰å¾€ Obsidian æœç´¢æ’ä»¶ â€œObsidian-gitâ€ å¹¶å®‰è£…ã€‚</p><ul><li>å¦‚æœä½ å¸Œæœ›æ‰‹åŠ¨åŒæ­¥ï¼Œé‚£ä¹ˆç”¨å¿«æ·é”®å”¤èµ· command palette åè¾“å…¥ â€œgitâ€ å°±å¯ä»¥å¿«é€Ÿæ‰§è¡Œå„ç§ git æ“ä½œã€‚å…¶ä¸­ï¼Œâ€Obsidian Git: Create Backupâ€ å‘½ä»¤ä¼šä¿å­˜æ‰€æœ‰ä¿®æ”¹ã€åˆ›å»º commitã€push åˆ°è¿œç¨‹ä»“åº“ï¼Œéå¸¸å®ç”¨ã€‚</li><li>å¦‚æœå¸Œæœ›è‡ªåŠ¨åŒæ­¥ï¼Œå¯ä»¥åœ¨æ’ä»¶è®¾ç½®ä¸­å¼€å¯ â€œAuto backup after stopping file editsâ€ å¹¶è®¾ç½®ä½ å–œæ¬¢çš„ â€œVault backup intervalâ€ã€‚</li><li>æ­¤å¤–ï¼Œâ€Pull updates on startupâ€, â€œPush on backupâ€, å’Œ â€œPull changes before pushâ€ éƒ½æ˜¯å¾ˆå®ç”¨çš„ï¼Œæ¨èå¼€å¯ã€‚</li></ul><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å…ˆå‰é…ç½® Hexo é¡¹ç›®ã€Obsidian Vault éƒ½å¯ä»¥è¿›è¡Œè‡ªåŠ¨å¤‡ä»½å’Œè·¨è®¾å¤‡åŒæ­¥äº†ã€‚åˆ°äº†æ–°çš„è®¾å¤‡ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦å‡†å¤‡å¥½ nodejs, git, ä»¥åŠ Obsidianï¼Œå°±ä¸éœ€è¦å†è¿›è¡Œé…ç½®äº†ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æˆ‘ä½¿ç”¨äº†ä¸‰ä¸ªéå¸¸ amazing çš„å·¥å…·æ¥å¸®æˆ‘è‡ªåŠ¨åŒ–å‘å¸ƒç½‘ç«™ï¼š</p><ul><li>Hexo å¯ä»¥æŠŠä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰ Markdown æ–‡ä»¶è½¬åŒ–ä¸ºç½‘ç«™æ–‡ç« </li><li>GitHub Pages å¯ä»¥å…è´¹éƒ¨ç½²é™æ€ç½‘ç«™</li><li>Obsidian æä¾›äº†å®Œç¾çš„æ’°å†™ä½“éªŒ</li></ul><p>åˆ›å»ºæ–°æ–‡ç« å¹¶å‘å¸ƒçš„å·¥ä½œæµå¦‚ä¸‹ï¼š</p><ol><li>æ‰“å¼€ Obsidianï¼Œåœ¨ <code>source/_posts</code> ä¸‹åˆ›å»ºæ–°ç¬”è®°</li><li>å¡«å†™æ–‡ç« æ ‡é¢˜</li><li>æŒ‰ä¸‹å¿«æ·é”®ï¼Œæ’å…¥ front-matter æ¨¡ç‰ˆï¼Œç„¶åæŒ‰éœ€ç¼–è¾‘</li><li>æ’°å†™å†…å®¹ï¼Œä½¿ç”¨ Markdown ä¹¦å†™</li><li>æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ <code>hexo s</code> é¢„è§ˆæ•ˆæœ</li><li>æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ <code>hexo deploy -g</code> å‘å¸ƒ</li><li>ç¨ç­‰ç‰‡åˆ»ï¼Œå³å¯åœ¨ <code>https://&lt;username&gt;.github.io</code> çœ‹åˆ°æ–°æ–‡ç« ~</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>obsidian</tag>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ‹è¯•æ ·å¼</title>
    <link href="/2024/01/11/Test/"/>
    <url>/2024/01/11/Test/</url>
    
    <content type="html"><![CDATA[<h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><p>Here is a PyTorch implementation of Supervised Contrastive Loss, which is proposed by Khosla et al.<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Supervised Contrastive Learning. [https://arxiv.org/abs/2004.11362](https://arxiv.org/abs/2004.11362)">[1]</span></a></sup>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Author: Yonglong Tian (yonglong@mit.edu)</span><br><span class="hljs-string">Date: May 07, 2020</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SupConLoss</span>(nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot;Supervised Contrastive Learning: https://arxiv.org/pdf/2004.11362.pdf.</span><br><span class="hljs-string">    It also supports the unsupervised contrastive loss in SimCLR&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, temperature=<span class="hljs-number">0.07</span>, contrast_mode=<span class="hljs-string">&#x27;all&#x27;</span>,</span><br><span class="hljs-params">                 base_temperature=<span class="hljs-number">0.07</span></span>):<br>        <span class="hljs-built_in">super</span>(SupConLoss, self).__init__()<br>        self.temperature = temperature<br>        self.contrast_mode = contrast_mode<br>        self.base_temperature = base_temperature<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, features, labels=<span class="hljs-literal">None</span>, mask=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Compute loss for model. If both `labels` and `mask` are None,</span><br><span class="hljs-string">        it degenerates to SimCLR unsupervised loss:</span><br><span class="hljs-string">        https://arxiv.org/pdf/2002.05709.pdf</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Args:</span><br><span class="hljs-string">            features: hidden vector of shape [bsz, n_views, ...].</span><br><span class="hljs-string">            labels: ground truth of shape [bsz].</span><br><span class="hljs-string">            mask: contrastive mask of shape [bsz, bsz], mask_&#123;i,j&#125;=1 if sample j</span><br><span class="hljs-string">                has the same class as sample i. Can be asymmetric.</span><br><span class="hljs-string">        Returns:</span><br><span class="hljs-string">            A loss scalar.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        device = (torch.device(<span class="hljs-string">&#x27;cuda&#x27;</span>)<br>                  <span class="hljs-keyword">if</span> features.is_cuda<br>                  <span class="hljs-keyword">else</span> torch.device(<span class="hljs-string">&#x27;cpu&#x27;</span>))<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(features.shape) &lt; <span class="hljs-number">3</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;`features` needs to be [bsz, n_views, ...],&#x27;</span><br>                             <span class="hljs-string">&#x27;at least 3 dimensions are required&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(features.shape) &gt; <span class="hljs-number">3</span>:<br>            features = features.view(features.shape[<span class="hljs-number">0</span>], features.shape[<span class="hljs-number">1</span>], -<span class="hljs-number">1</span>)<br><br>        batch_size = features.shape[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> labels <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> mask <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Cannot define both `labels` and `mask`&#x27;</span>)<br>        <span class="hljs-keyword">elif</span> labels <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> mask <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            mask = torch.eye(batch_size, dtype=torch.float32).to(device)<br>        <span class="hljs-keyword">elif</span> labels <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            labels = labels.contiguous().view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">if</span> labels.shape[<span class="hljs-number">0</span>] != batch_size:<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Num of labels does not match num of features&#x27;</span>)<br>            mask = torch.eq(labels, labels.T).<span class="hljs-built_in">float</span>().to(device)<br>        <span class="hljs-keyword">else</span>:<br>            mask = mask.<span class="hljs-built_in">float</span>().to(device)<br><br>        contrast_count = features.shape[<span class="hljs-number">1</span>]<br>        contrast_feature = torch.cat(torch.unbind(features, dim=<span class="hljs-number">1</span>), dim=<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">if</span> self.contrast_mode == <span class="hljs-string">&#x27;one&#x27;</span>:<br>            anchor_feature = features[:, <span class="hljs-number">0</span>]<br>            anchor_count = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> self.contrast_mode == <span class="hljs-string">&#x27;all&#x27;</span>:<br>            anchor_feature = contrast_feature<br>            anchor_count = contrast_count<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Unknown mode: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.contrast_mode))<br><br>        <span class="hljs-comment"># compute logits</span><br>        anchor_dot_contrast = torch.div(<br>            torch.matmul(anchor_feature, contrast_feature.T),<br>            self.temperature)<br>        <span class="hljs-comment"># for numerical stability</span><br>        logits_max, _ = torch.<span class="hljs-built_in">max</span>(anchor_dot_contrast, dim=<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>)<br>        logits = anchor_dot_contrast - logits_max.detach()<br><br>        <span class="hljs-comment"># tile mask</span><br>        mask = mask.repeat(anchor_count, contrast_count)<br>        <span class="hljs-comment"># mask-out self-contrast cases</span><br>        logits_mask = torch.scatter(<br>            torch.ones_like(mask),<br>            <span class="hljs-number">1</span>,<br>            torch.arange(batch_size * anchor_count).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(device),<br>            <span class="hljs-number">0</span><br>        )<br>        mask = mask * logits_mask<br><br>        <span class="hljs-comment"># compute log_prob</span><br>        exp_logits = torch.exp(logits) * logits_mask<br>        log_prob = logits - torch.log(exp_logits.<span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>))<br><br>        <span class="hljs-comment"># compute mean of log-likelihood over positive</span><br>        <span class="hljs-comment"># modified to handle edge cases when there is no positive pair</span><br>        <span class="hljs-comment"># for an anchor point. </span><br>        <span class="hljs-comment"># Edge case e.g.:- </span><br>        <span class="hljs-comment"># features of shape: [4,1,...]</span><br>        <span class="hljs-comment"># labels:            [0,1,1,2]</span><br>        <span class="hljs-comment"># loss before mean:  [nan, ..., ..., nan] </span><br>        mask_pos_pairs = mask.<span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span>)<br>        mask_pos_pairs = torch.where(mask_pos_pairs &lt; <span class="hljs-number">1e-6</span>, <span class="hljs-number">1</span>, mask_pos_pairs)<br>        mean_log_prob_pos = (mask * log_prob).<span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span>) / mask_pos_pairs<br><br>        <span class="hljs-comment"># loss</span><br>        loss = - (self.temperature / self.base_temperature) * mean_log_prob_pos<br>        loss = loss.view(anchor_count, batch_size).mean()<br><br>        <span class="hljs-keyword">return</span> loss<br></code></pre></td></tr></table></figure><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>Supervised Contrastive Learning. <a href="https://arxiv.org/abs/2004.11362">https://arxiv.org/abs/2004.11362</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
